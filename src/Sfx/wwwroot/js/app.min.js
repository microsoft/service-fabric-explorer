var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Sfx;!function(e){!function(){angular.module("sfx",["authenticationBootstrap","routes","messages","filters","directives","authenticationService","settingsService","storageService","clusterTreeService","refreshService","telemetryService","themeService","StatusWarningService","dataService","controllerManagerService","authenticationController","treeViewController","navbarController","clusterViewController","nodeViewController","nodesViewController","networksViewController","networkViewController","appTypeViewController","appsViewController","appViewController","actionController","serviceViewController","partitionViewController","replicaViewController","deployedAppViewController","deployedServiceViewController","deployedCodePackageViewController","deployedReplicaViewController","deployedServiceCodePackagesViewController","deployedServiceReplicasViewController","systemAppsViewController","themeController","settingsController","headerAlertController","templates","responseHeadersService","ngAria"]).config(["$rootScopeProvider",function(e){e.digestTtl(20)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.IsPreview=!1,e.Version="5.7",e.Build="[Dev]",e}();e.VersionInfo=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.sfxAppName="sfx",e.FabricPrefix="fabric:/",e.AutoRefreshIntervalStorageKey="sfxAutoRefreshInterval",e.SplitterLeftWidth="sfxSplitterleftWidth",e.ThemeNameStorageKey="sfxThemeName",e.PaginationLimitStorageKey="sfxPaginationLimit",e.AdvancedModeKey="sfxAdvancedMode",e.DefaultThemeName="dark",e.DefaultAutoRefreshInterval=15,e.DefaultSplitterLeftWidth=400,e.DefaultPaginationLimit=100,e.SystemAppId="System",e.SystemAppName="fabric:/System",e.SystemAppTypeName="System",e.SfxVersionMetadataName="SFX-Version",e.SfxBuildMetadataName="SFX-Build",e.SfxTelemetryMetadataName="X-ServiceFabricClientType",e.SfxTelemetryHeaderValue="SFX",e.SfxReadonlyHeaderName="SFX-Readonly",e.SfxClusterNameHeaderName="SFX-ClusterName",e.SfxReadonlyMetadataName="SFXReadonly",e.SfxClusterNameMetadataName="SFXClusterName",e.ThemeSourceQueryStringName="theme_source",e.ThemeNameQueryStringName="theme_name",e.ThemeNameMonitorPropertyName="ThemeName",e.PaginationLimitMin=5,e.PaginationLimitMax=200,e.InvalidTimestamp="N/A",e.DurationInfinity="Infinity",e.ServiceKindStateful="Stateful",e.ServiceKindStateless="Stateless",e.ComposeApplicationDefinitionKind="Compose",e.ContainerHostTypeName="ContainerHost",e.DirectiveNameActionsRow="sfx-actions-row",e.DirectiveNameUpgradeProgress="sfx-upgrade-progress",e.Empty="(empty)",e.SvgTransitionDuration=250,e.SvgTransitionDurationSlow=600,e}();e.Constants=t;var n=function(){function e(){}return e.ServiceCorrelationSchemes=["Invalid","Affinity","AlignedAffinity","NonAlignedAffinity"],e.ServiceLoadMetricWeights=["Zero","Low","Medium","High"],e.PlacementPolicies=["Invalid","InvalidDomain","RequiredDomain","PreferredPrimaryDomain","RequiredDomainDistribution","NonPartiallyPlaceService"],e.ServicePartitionKinds=["Invalid","Singleton","Int64Range","Named"],e.ServicePackageActivationModes=["SharedProcess","ExclusiveProcess"],e}();e.FabricEnumValues=n;var i=function(){function e(){}return e.BadgeOK="badge-ok",e.BadgeError="badge-error",e.BadgeWarning="badge-warning",e.BadgeUnknown="badge-unknown",e}();e.BadgeConstants=i;var r=function(){function e(){}return e.Upgrading="Upgrading",e}();e.AppStatusConstants=r;var a=function(){function e(){}return e.Invalid="Invalid",e.Up="Up",e.Down="Down",e.Enabling="Enabling",e.Disabling="Disabling",e.Disabled="Disabled",e.Unknown="Unknown",e}();e.NodeStatusConstants=a;var o=function(){function e(){}return e.Invalid="Invalid",e.OK="OK",e.Warning="Warning",e.Error="Error",e.Unknown="Unknown",e.Values={Invalid:0,OK:1,Warning:2,Error:3,Unknown:4},e}();e.HealthStateConstants=o;var s=function(){function e(){}return e.ReplicaRolesToSortPriorities={Unknown:0,None:1,Primary:2,ActiveSecondary:3,IdleSecondary:4},e}();e.SortPriorities=s;var c=function(){function e(){}return e.Int64Range=/Int64/i,e.Named=/Named/i,e}();e.ServicePartitionKindRegexes=c;var l=function(){function e(){}return e.Stateless=/Stateless/i,e.Stateful=/Stateful/i,e}();e.ServiceKindRegexes=l;var u=function(){function e(){}return e.InProgress=/In.*Progress/i,e.Completed=/Completed/i,e}();e.UpgradeDomainStateRegexes=u;var p=function(){function e(){}return e.RollingForwardPending="RollingForwardPending",e}();e.ClusterUpgradeStates=p;var d=function(){function e(){}return e.InProgress="InProgress",e.Completed="Completed",e.Pending="Pending",e}();e.UpgradeDomainStateNames=d;var h=function(){function e(){}return e.Warning="warning",e.Error="danger",e.Info="info",e}();e.StatusWarningLevel=h;var f=function(){function e(){}return e.ClusterDegradedState="degradedClusterState",e.OneNodeCluster="oneNodeCluster",e.ExpiringClusterCert="CertificateClusterExpiring",e}();e.BannerWarningID=f;var g=function(){function e(){}return e.Client="Certificate_client",e.Cluster="Certificate_cluster",e.Server="Certificate_server",e}();e.CertExpiraryHealthEventProperty=g}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.observers=[]}return e.prototype.subscribe=function(e){this.observers.push(e)},e.prototype.notify=function(e,t,n){this.observers&&this.observers.length>0&&this.observers.forEach(function(i){i(e,t,n)})},e}();e.Observable=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.prototype.getSuccessMessage=function(e,t){return null},e.prototype.getErrorMessage=function(e,t){return 404===t.status?null:this.getErrorMessageInternal(e,t)},e.prototype.getErrorMessageInternal=function(e,t){var n=e+" failed";return t.data&&t.data.Error?n+=".\r\nCode: "+t.data.Error.Code+"\r\nMessage: "+t.data.Error.Message:t.statusText&&(n+=" ("+t.statusText+")"),n},e}();e.GetResponseMessageHandler=t;var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getSuccessMessage=function(e,t){return e+" started."},t.prototype.getErrorMessage=function(e,t){return this.getErrorMessageInternal(e,t)},t}(t);e.PostResponseMessageHandler=n;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getSuccessMessage=function(e,t){return""+e},t.prototype.getErrorMessage=function(e,t){return this.getErrorMessageInternal(e,t)},t}(t);e.PutResponseMessageHandler=i;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getSuccessMessage=function(e,t){return""+e},t.prototype.getErrorMessage=function(e,t){return this.getErrorMessageInternal(e,t)},t}(t);e.DeleteResponseMessageHandler=r;var a=function(){function e(){}return e.prototype.getSuccessMessage=function(e,t){return null},e.prototype.getErrorMessage=function(e,t){return null},e}();e.SilentResponseMessageHandler=a;var o=function(){function e(){}return e.getResponseMessageHandler=new t,e.postResponseMessageHandler=new n,e.putResponseMessageHandler=new n,e.silentResponseMessageHandler=new a,e.deleteResponseMessageHandler=new r,e}();e.ResponseMessageHandlers=o;var s=function(){function e(e){this.innerHandler=e}return e.prototype.getSuccessMessage=function(e,t){return(this.innerHandler?this.innerHandler:o.getResponseMessageHandler).getSuccessMessage(e,t)},e.prototype.getErrorMessage=function(e,t){return 400===t.status?"Events API is not available on current cluster.":404===t.status&&"FABRIC_E_SERVICE_DOES_NOT_EXIST"===t.statusText?"EventStore system service is not found, please enable it.":404===t.status||503===t.status?"Events storage is not configured for current cluster.":(this.innerHandler?this.innerHandler:o.getResponseMessageHandler).getErrorMessage(e,t)},e}();e.EventsStoreResponseMessageHandler=s}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.isStandalone=function(){return"undefined"!=typeof sfxModuleManager&&null!==sfxModuleManager},Object.defineProperty(e,"clusterUrl",{get:function(){return null==e._clusterUrl&&(e.isStandalone()?e._clusterUrl=e.extractQueryItem(window.location.search,"targetcluster"):e._clusterUrl=""),e._clusterUrl},enumerable:!0,configurable:!0}),e.getHttpClient=function(){if(this.isStandalone())return sfxModuleManager.getComponentAsync("http.http-client.service-fabric")},e.extractQueryItem=function(e,t){if(e)for(var n=window.location.search.split("?")[1],i=n.split("&"),r=0;r<i.length;r++){var a=i[r].split("=");if(a[0]===t)return decodeURIComponent(a[1])}return null},e._clusterUrl=null,e}();e.StandaloneIntegration=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.cluster=function(){return"<cluster>"},e.appGroup=function(){return"<app group>"},e.nodeGroup=function(){return"<node group>"},e.networkGroup=function(){return"<network group>"},e.network=function(e){return e},e.node=function(e){return e},e.app=function(e){return e},e.systemAppGroup=function(){return"<system app group>"},e.appType=function(e){return e},e.service=function(e){return e},e.partition=function(e){return e},e.replica=function(e){return e},e.deployedApp=function(e){return e},e.deployedServicePackage=function(e,t){return t?e+" ("+t+")":e},e.deployedCodePackageGroup=function(){return"<deployed code package group>"},e.deployedReplicaGroup=function(){return"<deployed replica group>"},e.deployedCodePackage=function(e){return e},e.deployedReplica=function(e){return e},e}();e.IdGenerator=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){}return t.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},t.getHttpResponseData=function(e){return e.then(function(e){return e.data})},t.result=function(e,t){var n=e;return _.forEach(t.split("."),function(e){n=_.result(n,e)}),n},t.isBadge=function(e){return e&&e.hasOwnProperty("text")&&e.hasOwnProperty("badgeId")},t.getParsedHealthEvaluations=function(n,i,r,a){void 0===i&&(i=0),void 0===r&&(r=null);var o=new Array(0),s=new Array(0);return n&&n.forEach(function(n){var c=n.HealthEvaluation,l=new e.HealthEvaluation(c,i,r);if(c){var u="";u=r?r.viewPathUrl:"#"+a.$location.url();var p=t.getViewPathUrl(c,a,u);l.viewPathUrl=p.viewPathUrl,l.displayName=p.displayName,o.push(l),o=o.concat(t.getParsedHealthEvaluations(c.UnhealthyEvaluations,i+1,l,a)),s.push(l)}}),r&&(r.children=s),o},t.getViewPathUrl=function(e,n,i){void 0===i&&(i="");var r="",a="";switch(e.Kind){case"Nodes":r=n.routes.getNodesViewPath();break;case"Node":var o=e.NodeName;r=n.routes.getNodeViewPath(o),a=o;break;case"Applications":r=n.routes.getAppsViewPath();break;case"Application":var s=e.ApplicationName,c=s.replace("fabric:/",""),l=n.apps.find(c);if(l){var u=l.raw.TypeName;r+="#/apptype/"+n.routes.doubleEncode(u)+"/app/"+n.routes.doubleEncode(c),a=s}break;case"Service":var p=e.ServiceName.replace("fabric:/","");e.ServiceName.startsWith("fabric:/System")?r="#/apptype/System/app/System/service/"+n.routes.doubleEncode(p):(i+="/service/"+n.routes.doubleEncode(p),r=i),a="fabric:/"+p;break;case"Partition":var d=e.PartitionId;i+="/partition/"+n.routes.doubleEncode(d),a=d,r=i;break;case"Replica":var h=e.ReplicaOrInstanceId;i+="/replica/"+n.routes.doubleEncode(h),a=h,r=i;break;case"Event":i&&(r=i);break;case"DeployedApplication":var o=e.NodeName,s=e.Name,c=s.replace("fabric:/","");r+="#/node/"+n.routes.doubleEncode(o)+"/deployedapp/"+n.routes.doubleEncode(c),a=s;break;case"DeployedServicePackage":var f=e.ServiceManifestName,g=e.ServicePackageActivationId;r=i+"/deployedservice/"+(g?"activationid/"+n.routes.doubleEncode(g):"")+f,a=f;break;default:r=i}return a.length>0&&(e.Description=t.injectLink(e.Description,a,r,a)),{viewPathUrl:r,displayName:a}},t.injectLink=function(e,t,n,i){return e.replace(t,"<a title="+i+' ng-href="'+n+'" ">'+t+"</a>")},t.parseReplicaAddress=function(n){return n?0===n.indexOf("{")?JSON.parse(n,function(n,i){return _.isString(i)&&t.isSingleURL(i)?e.HtmlUtils.getLinkHtml(i,i,!0):i}):t.isSingleURL(n)?e.HtmlUtils.getLinkHtml(n,n):n:null},t.isSingleURL=function(e){return t.SingleUrlRegExp.test(e.toLowerCase())},t.hexToBytes=function(e){for(var t=[],n=0;n<e.length;n+=2){var i=parseInt(e.substr(n,2),16);!_.isNaN(i)&&i>=0&&t.push(i)}return t},t.bytesToHex=function(e,t){void 0===t&&(t=Number.MAX_VALUE);for(var n=e.slice(0,t),i=[],r=0;r<n.length;r++)i.push(e[r].toString(16));return i.join("")+(e.length>t?"...":"")},t.getFriendlyFileSize=function(e){return e<=1024?e+" Bytes":e<1048576?(e/1024).toFixed(2)+" KB":e<1073741824?(e/1048576).toFixed(2)+" MB":e<1099511627776?(e/1073741824).toFixed(2)+" GB":(e/1099511627776).toFixed(2)+" TB"},t.SingleUrlRegExp=new RegExp("^https?://[^;,]+"),t}();e.Utils=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){}return t.AddSeconds=function(e,t){var n=new Date(e.valueOf());return n.setTime(n.getTime()+1e3*t),n},t.AddDays=function(e,t){var n=new Date(e.valueOf());return n.setDate(n.getDate()+t),n},t.getDuration=function(t){var n;return n=_.isFinite(t)?moment.duration(t):e.Utils.isNumeric(t)?moment.duration(parseFloat(t)):moment.duration(t),this.formatDurationAsAspNetTimespan(n)},t.getDurationFromSeconds=function(e){return this.getDuration(1e3*parseFloat(e))},t.datetimeToString=function(e){return moment(e).format("MMM D, YYYY [at] h:mm:ss A (ZZ)")},t.timestampToUTCString=function(t){var n=moment.utc(t);return n.isValid()&&1!==n.year()?n.toDate().toUTCString():e.Constants.InvalidTimestamp},t.formatDurationAsAspNetTimespan=function(n){return n.asMilliseconds()>=t.MaxDurationInMilliseconds?e.Constants.DurationInfinity:Math.floor(n.asDays())+"."+_.padStart(Math.floor(n.hours()).toString(),2,"0")+":"+_.padStart(Math.floor(n.minutes()).toString(),2,"0")+":"+_.padStart(Math.floor(n.seconds()).toString(),2,"0")+"."+Math.ceil(n.milliseconds())},t.MaxDurationInMilliseconds=922337203685477.6,t}();e.TimeUtils=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.EnsureEndsWith=function(e,t){return _.endsWith(e,t)?e:e+t},e}();e.StringUtils=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){}return t.getAppId=function(e){return decodeURIComponent(e.appId)},t.getPartitionId=function(e){return decodeURIComponent(e.partitionId)},t.getReplicaId=function(e){return decodeURIComponent(e.replicaId)},t.getServiceId=function(e){return decodeURIComponent(e.serviceId)},t.getServicePackageActivationId=function(e){return e.activationId?decodeURIComponent(e.activationId):""},t.getAppTypeName=function(e){return decodeURIComponent(e.appTypeName)},t.getCodePackageName=function(e){return decodeURIComponent(e.codePackageName)},t.getContainerLogs=function(e){return decodeURIComponent(e.codePackageName)},t.getNodeName=function(e){return decodeURIComponent(e.nodeName)},t.getBackupPolicyName=function(e){return decodeURIComponent(e.backupPolicyName)},t.getNetworkName=function(e){return decodeURIComponent(e.networkName)},t.idToName=function(t){return e.Constants.FabricPrefix+t},t.nameToId=function(t){return _.startsWith(t,e.Constants.FabricPrefix)?t.substr(e.Constants.FabricPrefix.length):t},t}();e.IdUtils=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){var t=this;this.WarningEventTypes=_.keyBy(["*HealthReportCreated-HealthState:Warning","*NewHealthReport-HealthState:Warning","*UpgradeRollbackStart","*UpgradeRollbackComplete","*UpgradeRollbackStarted","*UpgradeRollbackCompleted","BuildIdleReplicaFailed","PrimaryFaultedSlowSecondary","PrimaryReplicationQueueFull","PrimaryReplicationQueueWarning","ReplicatorFaulted","SecondaryReplicationQueueFull","SecondaryReplicationQueueWarning"],function(e){return e.split("-")[0].replace("*","")}),this.ErrorEventTypes=_.keyBy(["*HealthReportCreated-HealthState:Error","*NewHealthReport-HealthState:Error","NodeDown","NodeOpenFailed","NodeAborted","TStoreError"],function(e){return e.split("-")[0].replace("*","")}),this.ResolvedEventTypes=_.keyBy(["*HealthReportCreated-HealthState:Ok","*NewHealthReport-HealthState:Ok"],function(e){return e.split("-")[0].replace("*","")}),this.warningEventsRegExp=e.constructRegExp(Object.keys(this.WarningEventTypes).map(function(e){return t.WarningEventTypes[e]})),this.errorEventsRegExp=e.constructRegExp(Object.keys(this.ErrorEventTypes).map(function(e){return t.ErrorEventTypes[e]})),this.resolvedEventsRegExp=e.constructRegExp(Object.keys(this.ResolvedEventTypes).map(function(e){return t.ResolvedEventTypes[e]}))}return e.constructRegExp=function(e){var t="^";return e.forEach(function(e){var n=e.split("-")[0];"^"!==t&&(t+="|"),t+="(?:",_.startsWith(n,"*")&&(t+="[a-zA-Z]+",n=n.substr(1)),t+="("+n+")",t+=")"}),t+="$"},e.isEventMatching=function(e,t){var n=new RegExp(t),i=n.exec(e.kind);return i?i.filter(function(e){return e})[1]:null},e.isPropertyMatching=function(e,t){var n=t.split("-");if(n.length>1){var i=n[1].split(":");if(e.eventProperties[i[0]]+""!==i[1])return!1}return!0},e.prototype.isWarning=function(t){var n=e.isEventMatching(t,this.warningEventsRegExp);return!!n&&e.isPropertyMatching(t,this.WarningEventTypes[n])},e.prototype.isError=function(t){var n=e.isEventMatching(t,this.errorEventsRegExp);return!!n&&e.isPropertyMatching(t,this.ErrorEventTypes[n])},e.prototype.isResolved=function(t){var n=e.isEventMatching(t,this.resolvedEventsRegExp);return!!n&&e.isPropertyMatching(t,this.ResolvedEventTypes[n])},e}();e.EventTypesUtil=t;var n=function(){function n(){}return n.repositionContextMenu=function(){_.forEach($(".uib-dropdown-open .dropdown-menu:visible"),function(e){e.offsetLeft+e.offsetWidth>window.innerWidth&&$(e).css("left",window.innerWidth-e.offsetWidth),e.offsetTop+e.offsetHeight>window.innerHeight&&$(e).css("top",e.offsetTop-e.offsetHeight-20)})},n.isHtml=function(e){return/<\/[a-zA-Z]+>/.test(e)},n.getSpanWithCustomClass=function(e,t){return'<span class="'+e+'">'+t+"</span>"},n.getSpanWithLink=function(e,t,i){return i?'<a class="'+e+'" title="'+t+'" ng-href="'+i+'" ">'+t+"</a>":n.getSpanWithCustomClass(e,t)},n.getSpanWithTitleHtml=function(e){return'<span title="'+e+'">'+e+"</span>"},n.getUpgradeProgressHtml=function(t){return"<"+e.Constants.DirectiveNameUpgradeProgress+' upgrade-domains="'+t+'"></'+e.Constants.DirectiveNameUpgradeProgress+">"},n.getLinkHtml=function(e,t,n){return void 0===n&&(n=!1),'<a href="'+t+'"'+(n?' target="_blank"':"")+">"+e+"</a>"},n.getBadgeHtml=function(e){return e.badgeClass?'<div class="badge-container" title="'+e.text+'"><img class="badge-icon" src="images/'+e.badgeClass+'.svg" alt="'+e.text+' badge"></img><span> '+e.text+"</span></div>":this.getSpanWithTitleHtml(e.text)},n.getBadgeOnlyHtml=function(e){return'<div class="badge-container" title="'+e.text+'"><img class="badge-icon" src="images/'+e.badgeClass+'.svg"></img></div>'},n.getEventNameHtml=function(e){var t=null;return n.eventTypesUtil.isResolved(e)?t="#3AA655":n.eventTypesUtil.isWarning(e)?t="#F2C649":n.eventTypesUtil.isError(e)&&(t="#FF5349"),t?'<span style="color:'+t+'">'+e.kind+"</span>":e.kind},n.getEventSecondRowHtml=function(e){var t='EventInstanceId: "'+e.eventInstanceId+'"</br>Additional Properties: '+JSON.stringify(e.eventProperties,null,"&nbsp;");return'<div style="margin-left:20px"><sfx-clip-board text="\''+encodeURI('EventInstanceId: "'+e.eventInstanceId+'"\nAdditional Properties: '+JSON.stringify(e.eventProperties,null,2))+'\'" encoded="true" style="position: absolute; left: 25px;"></sfx-clip-board> '+t.replace(new RegExp("\\n","g"),"<br/>")+"</div>"},n.getEventDetailsViewLinkHtml=function(e){return e.hasCorrelatedEvents?'<a title="Correlated Events" href ng-click="showDetails(\''+e.eventInstanceId+"')\">View</a>":""},n.eventTypesUtil=new t,n}();e.HtmlUtils=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.updateCollection=function(e,t,n,i,r,a,o){void 0===o&&(o=!1);var s=_.keyBy(e,n);if(!o){var c=_.keyBy(t,i);_.remove(e,function(e){return!c[n(e)]})}_.forEach(t,function(t){var n=i(t),o=s[n];o?a(o,t):r&&e.push(r(o,t))})},e.compareCollectionsByKeys=function(e,t,n,i){if(e.length!==t.length)return!1;var r=_.keyBy(e,n);return _.every(t,function(e){var t=i(e);return!!r[t]})},e.updateDataModelCollection=function(t,n,i){void 0===i&&(i=!1),e.updateCollection(t,n,function(e){return e.uniqueId},function(e){return e.uniqueId},function(e,t){return t},function(e,t){return e.update(t.raw)},i)},e}();e.CollectionUtils=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"healthStatuses",{get:function(){return t.healthStatus},enumerable:!0,configurable:!0}),t.prototype.resolveHealthStatus=function(e){return this.resolve(e,t.healthStatus,_.last(t.healthStatus))},t.prototype.resolve=function(t,n,i){if(void 0===i&&(i=null),e.Utils.isNumeric(t)){var r=_.parseInt(t);if(r>=0&&r<n.length)return n[r]}return this.resolveEnumValue(t,n)||i||{badgeId:t,text:t}},t.prototype.resolveEnumValue=function(e,t){return _.isString(e)?_.find(t,function(t){return t.text.toLowerCase()===e.toLowerCase()||t.badgeId.toLowerCase()===e.toLowerCase()}):null},t.unknown={badgeId:"Unknown",text:"Unknown"},t.healthStatus=[{badgeId:e.HealthStateConstants.Invalid,text:e.HealthStateConstants.Invalid,badgeClass:"badge-unknown"},{badgeId:e.HealthStateConstants.OK,text:e.HealthStateConstants.OK,badgeClass:"badge-ok"},{badgeId:e.HealthStateConstants.Warning,text:e.HealthStateConstants.Warning,badgeClass:"badge-warning"},{badgeId:e.HealthStateConstants.Error,text:e.HealthStateConstants.Error,badgeClass:"badge-error"},{badgeId:e.HealthStateConstants.Unknown,text:e.HealthStateConstants.Unknown,badgeClass:"badge-unknown"}],t}();e.ValueResolver=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e,t,n,i,r){this.name=e,this.title=t,this.runningTitle=n,this.execute=i,this.canRun=r,this._running=!1}return Object.defineProperty(e.prototype,"running",{get:function(){return this._running},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayTitle",{get:function(){return this._running?this.runningTitle:this.title},enumerable:!0,configurable:!0}),e.prototype.run=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.runInternal(ng.noop,ng.noop,e)},e.prototype.runWithCallbacks=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this.runInternal(e,t,n)},e.prototype.runInternal=function(e,t){for(var n=this,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(this.canRun())return this._running=!0,this.execute(i).then(e,t).finally(function(){n._running=!1})},e}();e.Action=t;var n=function(e){function t(t,n,i,r,a,o,s,c,l){var u=e.call(this,i,r,a,o,s)||this;return u.$uibModal=t,u.$q=n,u.name=i,u.title=r,u.runningTitle=a,u.execute=o,u.canRun=s,u.modalSettings=c,u.beforeOpen=l,u}return __extends(t,e),t.prototype.runInternal=function(t,n){for(var i=this,r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];if(this.canRun())return this.$q.when(!this.beforeOpen||this.beforeOpen()).then(function(){return i.$uibModal.open(i.modalSettings).result.then(function(){return e.prototype.runInternal.call(i,t,n,r)})})},t}(t);e.ActionWithDialog=n;var i=function(t){function n(n,i,r,a,o,s,c,l,u,p){var d=t.call(this,n,i,r,a,o,s,c,{templateUrl:"partials/action-confirmation-dialog.html",controller:e.ActionController,resolve:{action:function(){return d}}})||this;return d.$uibModal=n,d.$q=i,d.name=r,d.title=a,d.runningTitle=o,d.execute=s,d.canRun=c,d.confirmationDialogTitle=l,d.confirmationDialogMessage=u,d.confirmationKeyword=p,d}return __extends(n,t),n}(n);e.ActionWithConfirmationDialog=i}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e,t){this.telemetry=e,this.$q=t,this.collection=[]}return e.prototype.runWithTelemetry=function(e,t){return!e.canRun||e.running?this.$q.when(!0):this.runInternal(e,t)},Object.defineProperty(e.prototype,"length",{get:function(){return this.collection.length},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this.collection.push(e)},Object.defineProperty(e.prototype,"anyRunning",{get:function(){return _.some(this.collection,"running")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){var e=_.find(this.collection,function(e){return e.running});return e?e.runningTitle:"Actions"},enumerable:!0,configurable:!0}),e.prototype.runInternal=function(e,t){var n=this,i=[function(i){n.telemetry.trackActionEvent(e.name,t,!0)},function(i){var r=i&&i.statusText&&i.status&&i.status+": "+i.statusText||!1;return n.telemetry.trackActionEvent(e.name,t,r),n.$q.reject(i)}];return e.runWithCallbacks.apply(e,i)},e}();e.ActionCollection=t}(Sfx||(Sfx={}));var Sfx;!function(e){!function(e){e[e.Default=0]="Default",e[e.None=1]="None",e[e.Ok=2]="Ok",e[e.Warning=4]="Warning",e[e.Error=8]="Error",e[e.All=65535]="All"}(e.HealthStateFilterFlags||(e.HealthStateFilterFlags={}))}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t,n,i,r,a,o){void 0===i&&(i=[]),void 0===r&&(r=!1),void 0===a&&(a=function(e){return!0}),void 0===o&&(o=!0),this.limit=e,this.defaultSortPropertyPaths=t,this.columnSettings=n,this.secondRowColumnSettings=i,this.secondRowCollapsible=r,this.showSecondRow=a,this.searchable=o,this.sortPropertyPaths=[],this.sortReverse=!1,this._currentPage=1,this._itemCount=0,this.sortPropertyPaths=t}return Object.defineProperty(t.prototype,"count",{get:function(){return this._itemCount},set:function(e){this._itemCount=e,this.currentPage>this.pageCount&&(this.currentPage=this.pageCount)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this._currentPage},set:function(e){e<1?this._currentPage=1:e>this.pageCount?this.pageCount>0?this._currentPage=this.pageCount:this._currentPage=1:this._currentPage=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasEnabledFilters",{get:function(){return _.some(this.columnSettings,function(e){return e.enableFilter})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"begin",{get:function(){return(this.currentPage-1)*this.limit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pageCount",{get:function(){return Math.ceil(this.count/this.limit)},enumerable:!0,configurable:!0}),t.prototype.setPageWithIndex=function(e){this.currentPage=Math.floor(e/this.limit)+1},t.prototype.sort=function(e){this.sortPropertyPaths=e,this.sortReverse=!this.sortReverse},t.prototype.isSortedByColumn=function(e){return _.isEqual(this.sortPropertyPaths,e.sortPropertyPaths)},t.prototype.reset=function(){_.forEach(this.columnSettings,function(e){return e.reset()}),this.search=null,this.sortPropertyPaths=this.defaultSortPropertyPaths,this.sortReverse=!1,this.currentPage=1},t.prototype.getPluckedObject=function(e){if(!_.isEmpty(this.columnSettings)){var t={};return _.forEach(_.union(this.columnSettings,this.secondRowColumnSettings),function(n){return t[n.propertyPath]=n.getTextValue(e)}),t}return e},t.prototype.filterContextMenuToggled=function(t){t&&e.HtmlUtils.repositionContextMenu()},t}();e.ListSettings=t;var n=function(){function e(e){this.value=e,this.isChecked=!0}return e}();e.FilterValue=n;var i=function(){function t(e,t,n,i,r,a,o){void 0===n&&(n=[e]),void 0===a&&(a=1),void 0===o&&(o=function(e){return null}),this.propertyPath=e,this.displayName=t,this.sortPropertyPaths=n,this.enableFilter=i,this.getDisplayHtml=r,this.colspan=a,this.clickEvent=o,this.filterValues=[]}return Object.defineProperty(t.prototype,"hasFilters",{get:function(){return this.enableFilter&&this.filterValues.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasEffectiveFilters",{get:function(){return _.some(this.filterValues,function(e){return!e.isChecked})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortable",{get:function(){return!_.isEmpty(this.sortPropertyPaths)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){_.forEach(this.filterValues,function(e){return e.isChecked=!0})},t.prototype.getProperty=function(t){return this.propertyPath&&_.startsWith(this.propertyPath,"#")?this.propertyPath.substr(1):e.Utils.result(t,this.propertyPath)},t.prototype.isBadge=function(t){return e.Utils.isBadge(t)},t.prototype.getTextValue=function(e){var t=this.getProperty(e);return _.isUndefined(t)||_.isNull(t)?"":t.toString()},t.prototype.getDisplayContentsInHtml=function(e){var t=this.getProperty(e);return this.getDisplayHtml?this.getDisplayHtml(e,t):_.isUndefined(t)||_.isNull(t)?"":t.toString()},t}();e.ListColumnSetting=i;var r=function(t){function n(n,i,r){return void 0===r&&(r=[n+".text"]),t.call(this,n,i,r,!0,function(t,n){return e.HtmlUtils.getBadgeHtml(n)})||this}return __extends(n,t),n.prototype.getTextValue=function(e){var t=this.getProperty(e);return t?t.text:""},n}(i);e.ListColumnSettingForBadge=r;var a=function(e){function t(t,n,i){return void 0===i&&(i=[t]),e.call(this,t,n,i,!0)||this}return __extends(t,e),t}(i);e.ListColumnSettingWithFilter=a;var o=function(t){function n(n,i,r){return t.call(this,n,i,[n],!1,function(t,n){return e.HtmlUtils.getLinkHtml(n,r(t))})||this}return __extends(n,t),n}(i);e.ListColumnSettingForLink=o}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e}();e.IRawReplicatorStatus=t;var n=function(){function e(){}return e}();e.IRawReplicatorQueueStatus=n;var i=function(){function e(){}return e}();e.IRawRemoteReplicatorStatus=i;var r=function(){function t(t){this.warningCount=0,this.errorCount=0,this.totalCount=0,this.nodeType=t,this.statusTypeCounts={},this.statusTypeCounts[e.NodeStatusConstants.Up]=0,this.statusTypeCounts[e.NodeStatusConstants.Down]=0,this.statusTypeCounts[e.NodeStatusConstants.Enabling]=0,this.statusTypeCounts[e.NodeStatusConstants.Disabling]=0,this.statusTypeCounts[e.NodeStatusConstants.Disabled]=0,this.statusTypeCounts[e.NodeStatusConstants.Unknown]=0,this.statusTypeCounts[e.NodeStatusConstants.Invalid]=0}return t.prototype.add=function(t){this.statusTypeCounts[t.raw.NodeStatus]++,this.totalCount++,t.healthState.text===e.HealthStateConstants.Warning&&this.warningCount++,t.healthState.text===e.HealthStateConstants.Error&&this.errorCount++},t}();e.NodeStatusDetails=r}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t,n,i){this.data=t,this.raw=n,this.parent=i,this.valueResolver=new e.ValueResolver,this.data&&(this.actions=new e.ActionCollection(this.data.telemetry,this.data.$q)),this.isInitialized=!_.isEmpty(n)}return Object.defineProperty(t.prototype,"isRefreshing",{get:function(){return!!this.refreshingPromise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.rawAny.Id||this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.rawAny.Name||""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPath",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"healthState",{get:function(){return this.rawAny.HealthState?this.valueResolver.resolveHealthStatus(this.rawAny.HealthState):this.rawAny.AggregatedHealthState?this.valueResolver.resolveHealthStatus(this.rawAny.AggregatedHealthState):e.ValueResolver.unknown},enumerable:!0,configurable:!0}),t.prototype.refresh=function(e){var t=this;return this.refreshingPromise||(this.refreshingPromise=this.retrieveNewData(e).then(function(e){return t.update(e)}).then(function(){return t}).finally(function(){t.refreshingPromise=null})),this.refreshingPromise},t.prototype.update=function(e){return _.isEmpty(e)?this.data.$q.when(!0):(this.isInitialized=!0,this.raw=e,
this.data.$q.when(this.updateInternal()))},t.prototype.ensureInitialized=function(e,t){return!this.isInitialized||e?this.refresh(t):this.data.$q.when(this)},t.prototype.addHealthStateFiltersForChildren=function(e){return null},t.prototype.mergeHealthStateChunk=function(e){return this.rawAny.HealthState?this.rawAny.HealthState=e.HealthState:this.rawAny.AggregatedHealthState&&(this.rawAny.AggregatedHealthState=e.HealthState),this.refreshFromHealthChunkInternal(e)},Object.defineProperty(t.prototype,"rawAny",{get:function(){return this.raw},enumerable:!0,configurable:!0}),t.prototype.retrieveNewData=function(e){return this.data.$q.when(this.raw)},t.prototype.updateInternal=function(){return this.data.$q.when(!0)},t.prototype.refreshFromHealthChunkInternal=function(e){return this.data.$q.when(!0)},t}();e.DataModelBase=t;var n=function(t){function n(e,n){var i=t.call(this,e,{},n)||this;return i.healthEvents=[],i.unhealthyEvaluations=[],i}return __extends(n,t),n.prototype.mergeHealthStateChunk=function(e){return this.raw.AggregatedHealthState=e.HealthState,this.data.$q.when(!0)},n.prototype.updateInternal=function(){this.parseCommonHealthProperties()},n.prototype.parseCommonHealthProperties=function(){var t=this;return this.data.$q(function(n,i){var r=_.map(t.raw.HealthEvents,function(n){return new e.HealthEvent(t.data,n)});e.CollectionUtils.updateDataModelCollection(t.healthEvents,r),t.data.apps.ensureInitialized().then(function(){t.unhealthyEvaluations=e.Utils.getParsedHealthEvaluations(t.raw.UnhealthyEvaluations,null,null,t.data),n()})})},n}(t);e.HealthBase=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),Object.defineProperty(n.prototype,"uniqueId",{get:function(){return this.raw.SourceId+"_"+this.raw.Property+"_"+this.raw.SequenceNumber},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"description",{get:function(){return this.raw.Description.trim()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sourceUtcTimestamp",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.SourceUtcTimestamp)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"TTL",{get:function(){return e.TimeUtils.getDuration(this.raw.TimeToLiveInMilliSeconds)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.HealthEvent=t;var n=function(e){function t(t,n,i,r){void 0===n&&(n=0),void 0===i&&(i=null),void 0===r&&(r="");var a=e.call(this,null,t,i)||this;return a.level=n,a.viewPathUrl="",a.viewPathUrl=r,a}return __extends(t,e),Object.defineProperty(t.prototype,"viewPath",{get:function(){return this.viewPathUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kind",{get:function(){return this.level>0?_.repeat(" ",4*this.level)+this.raw.Kind:this.raw.Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){var e="";return e=this.raw.UnhealthyEvent?(this.raw.Description+"\n"+this.raw.UnhealthyEvent.Description).trim():this.raw.Description.trim(),e.replace("http://aka.ms/sfhealth","<a href='https://aka.ms/sfhealth' target='_blank'>https://aka.ms/sfhealth</a>")},enumerable:!0,configurable:!0}),t}(e.DataModelBase);e.HealthEvaluation=n;var i=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.decorators={showList:["Name","BalancingThreshold","Action","IsBalancedBefore","DeviationBefore","IsBalancedAfter","DeviationAfter"]},i}return __extends(t,e),Object.defineProperty(t.prototype,"minNodeLoadId",{get:function(){return this.raw.MinNodeLoadId.Id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNodeLoadId",{get:function(){return this.raw.MaxNodeLoadId.Id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCapacity",{get:function(){return this.raw.ClusterCapacity&&+this.raw.ClusterCapacity>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isResourceGovernanceMetric",{get:function(){return _.startsWith(this.raw.Name,"servicefabric:/_")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSystemMetric",{get:function(){return _.startsWith(this.raw.Name,"__")&&_.endsWith(this.raw.Name,"__")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoadMetric",{get:function(){return!(this.isResourceGovernanceMetric||this.isSystemMetric)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadCapacityRatio",{get:function(){return this.hasCapacity?this.raw.CurrentClusterLoad/this.raw.ClusterCapacity:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadCapacityRatioString",{get:function(){return(100*this.loadCapacityRatio).toFixed(1)+"%"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this.name.replace(/^servicefabric:\/_/,"Reserved ")},enumerable:!0,configurable:!0}),t}(e.DataModelBase);e.LoadMetricInformation=i;var r=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.decorators={hideList:["Name","TargetApplicationTypeVersion","UpgradeKind","RollingUpgradeMode"]},i.monitoringPolicy=new a(i.data,n.MonitoringPolicy),i}return __extends(t,e),t}(e.DataModelBase);e.UpgradeDescription=r;var a=function(t){function n(n,i){var r=t.call(this,n,i)||this;return r.decorators={decorators:{HealthCheckWaitDurationInMilliseconds:{displayName:function(e){return"Health Check Wait Duration"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}},HealthCheckStableDurationInMilliseconds:{displayName:function(e){return"Health Check Stable Duration"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}},HealthCheckRetryTimeoutInMilliseconds:{displayName:function(e){return"Health Check Retry Timeout"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}},UpgradeTimeoutInMilliseconds:{displayName:function(e){return"Upgrade Timeout"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}},UpgradeDomainTimeoutInMilliseconds:{displayName:function(e){return"Upgrade Domain Timeout"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}}}},r}return __extends(n,t),n}(e.DataModelBase);e.MonitoringPolicy=a;var o=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),Object.defineProperty(n.prototype,"stateName",{get:function(){return e.UpgradeDomainStateRegexes.Completed.test(this.raw.State)?e.UpgradeDomainStateNames.Completed:e.UpgradeDomainStateRegexes.InProgress.test(this.raw.State)?e.UpgradeDomainStateNames.InProgress:e.UpgradeDomainStateNames.Pending},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"badgeClass",{get:function(){return e.UpgradeDomainStateRegexes.Completed.test(this.raw.State)?e.BadgeConstants.BadgeOK:e.UpgradeDomainStateRegexes.InProgress.test(this.raw.State)?e.BadgeConstants.BadgeWarning:e.BadgeConstants.BadgeUnknown},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.UpgradeDomain=o}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e){this.$q=e,this.defer=null}return e.prototype.load=function(e){return this.hasPromise()&&this.cancel(),this.defer=this.$q.defer(),this.executeInternal(e),this.getPromise()},e.prototype.hasPromise=function(){return null!==this.defer},e.prototype.getPromise=function(){return this.hasPromise()?this.defer.promise:null},e.prototype.cancel=function(){this.hasPromise()&&(this.defer.reject({isCanceled:!0}),this.defer=null)},e.prototype.executeInternal=function(e){var t=this,n=this.defer;e().then(function(e){t.defer===n&&t.defer.resolve(e)}).catch(function(e){t.defer===n&&t.defer.reject(e)}).finally(function(){t.defer===n&&(t.defer=null)})},e}();e.CancelablePromise=t;var n=function(){function n(n,i,r){void 0===r&&(r=!1),this.data=n,this.isInitialized=!1,this.collection=[],this.valueResolver=new e.ValueResolver,this.parent=i,this.appendOnly=r,this.refreshingLoadPromise=new t(this.data.$q)}return Object.defineProperty(n.prototype,"viewPath",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"length",{get:function(){return this.collection.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isRefreshing",{get:function(){return!!this.refreshingPromise},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"indexPropery",{get:function(){return"uniqueId"},enumerable:!0,configurable:!0}),n.prototype.refresh=function(e){var t=this;return this.refreshingPromise||(this.refreshingPromise=this.refreshingLoadPromise.load(function(){return t.retrieveNewCollection(e)}).catch(function(e){if(e&&!0!==e.isCanceled)throw e;return t.data.$q.when(null)}).then(function(e){if(e)return t.update(e)}).then(function(){return t}).finally(function(){t.refreshingPromise=null})),this.refreshingPromise},n.prototype.clear=function(){var e=this;return this.cancelLoad(),this.data.$q.when(!this.refreshingPromise||this.refreshingPromise).then(function(){e.collection=[],e.isInitialized=!1})},n.prototype.cancelLoad=function(){this.refreshingLoadPromise.hasPromise()&&this.refreshingLoadPromise.cancel()},n.prototype.update=function(t){return this.isInitialized=!0,e.CollectionUtils.updateDataModelCollection(this.collection,t,this.appendOnly),this.hash=_.keyBy(this.collection,this.indexPropery),this.data.$q.when(this.updateInternal())},n.prototype.ensureInitialized=function(e,t){return!this.isInitialized||e?this.refresh(t):this.data.$q.when(this)},n.prototype.find=function(e){return this.hash?this.hash[e]:null},n.prototype.mergeClusterHealthStateChunk=function(e){return this.data.$q.when(!0)},n.prototype.retrieveNewCollection=function(e){return this.data.$q.reject()},n.prototype.updateInternal=function(){return this.data.$q.when(!0)},n.prototype.updateCollectionFromHealthChunkList=function(t,n){var i=this;if(!e.CollectionUtils.compareCollectionsByKeys(this.collection,t.Items,function(e){return e[i.indexPropery]},n))return this.isRefreshing?this.data.$q.when(!0):this.refresh();var r=[];return e.CollectionUtils.updateCollection(this.collection,t.Items,function(e){return e[i.indexPropery]},n,null,function(e,t){r.push(e.mergeHealthStateChunk(t))}),this.data.$q.all(r)},n.prototype.getDetailsList=function(e){return null},n}();e.DataModelCollectionBase=n;var i=function(t){function n(e){return t.call(this,e)||this}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getNodesViewPath()},enumerable:!0,configurable:!0}),n.prototype.mergeClusterHealthStateChunk=function(t){var n=this;return this.updateCollectionFromHealthChunkList(t.NodeHealthStateChunks,function(t){return e.IdGenerator.node(t.NodeName)}).then(function(){n.updateNodesHealthState()})},n.prototype.getNodeStateCounts=function(){var t={},n=new e.NodeStatusDetails("All nodes"),i=new e.NodeStatusDetails("Seed Nodes");return this.collection.forEach(function(r){r.raw.IsSeedNode&&i.add(r),r.raw.Type in t||(t[r.raw.Type]=new e.NodeStatusDetails(r.raw.Type)),t[r.raw.Type].add(r),n.add(r)}),[n,i].concat(Object.keys(t).map(function(e){return t[e]}))},n.prototype.setAdvancedMode=function(e){this.collection.forEach(function(t){t.removeAdvancedActions(),e&&t.setAdvancedActions()})},Object.defineProperty(n.prototype,"indexPropery",{get:function(){return"name"},enumerable:!0,configurable:!0}),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getNodes(t).then(function(t){return _.map(t,function(t){return new e.Node(n.data,t)})})},n.prototype.updateInternal=function(){this.updateNodesHealthState(),this.faultDomains=_.map(this.collection,function(e){return e.raw.FaultDomain}),this.faultDomains=_.uniq(this.faultDomains).sort(),this.upgradeDomains=_.map(this.collection,function(e){return e.raw.UpgradeDomain}),this.upgradeDomains=_.uniq(this.upgradeDomains).sort();var t=_.filter(this.collection,function(e){return e.raw.IsSeedNode}),n=_.filter(t,function(t){return t.healthState.text===e.HealthStateConstants.OK}),i=0,r=0;this.collection.forEach(function(t){t.raw.NodeStatus===e.NodeStatusConstants.Disabled&&i++,t.raw.NodeStatus===e.NodeStatusConstants.Disabling&&r++}),this.disabledNodes=i+"/"+r,this.seedNodeCount=t.length,this.checkOneNodeScenario(),this.healthySeedNodes=t.length.toString()+" ("+Math.round(n.length/t.length*100).toString()+"%)"},n.prototype.checkSeedNodeCount=function(t){this.seedNodeCount<t&&1!==this.seedNodeCount?this.data.warnings.addOrUpdateNotification({message:'This cluster is currently running on the bronze reliability tier. For production workloads, only a reliability level of silver or greater is supported \n                    <br>See <a href="https://aka.ms/servicefabric/reliability" target="_black">( link )</a> for more details',level:e.StatusWarningLevel.Warning,priority:2,id:e.BannerWarningID.ClusterDegradedState,confirmText:"This cluster is currently running on the bronze reliability tier which indicates a test/staging environment. For production workloads, only a reliability\n                    level of silver or greater is supported. For more information on the reliability characteristics of a cluster, please see https://aka.ms/sfreliabilitytiers"}):this.data.warnings.removeNotificationById(e.BannerWarningID.ClusterDegradedState)},n.prototype.checkOneNodeScenario=function(){n.checkedOneNodeScenario||1!==this.collection.length||this.data.warnings.addOrUpdateNotification({message:"One node cluster is considered a test cluster and cannot perform cluster upgrades.",level:e.StatusWarningLevel.Info,priority:1,id:e.BannerWarningID.OneNodeCluster,link:"https://aka.ms/servicefabric/durability"}),n.checkedOneNodeScenario=!0},n.prototype.updateNodesHealthState=function(){this.healthState=this.valueResolver.resolveHealthStatus(_.max(_.map(this.collection,function(t){return e.HealthStateConstants.Values[t.healthState.text]})))},n.checkedOneNodeScenario=!1,n}(n);e.NodeCollection=i;var r=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getBackupPolicies(t).then(function(t){return _.map(t,function(t){return new e.BackupPolicy(n.data,t)})})},n}(n);e.BackupPolicyCollection=r;var a=function(t){function n(e){return t.call(this,e)||this}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getNetworksViewPath()},enumerable:!0,configurable:!0}),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getNetworks(t).then(function(t){return _.map(t,function(t){return new e.Network(n.data,t)})})},n}(n);e.NetworkCollection=a;var o=function(t){function n(e,n){var i=t.call(this,e)||this;return i.appId=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this,i=[];return this.data.restClient.getNetworksOnApp(this.appId,t).then(function(t){var r=_.map(t,function(t){var r=new e.NetworkOnApp(n.data,t);return r.refresh().then(function(){return i.push(r)})});return n.data.$q.all(r).then(function(){return i})})},n}(n);e.NetworkOnAppCollection=o;var s=function(t){function n(e,n){var i=t.call(this,e)||this;return i.nodeName=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this,i=[];return this.data.restClient.getNetworksOnNode(this.nodeName,t).then(function(t){var r=_.filter(t,function(e){return"servicefabric_network"!==e.NetworkName}),a=_.map(r,function(t){var r=new e.NetworkOnNode(n.data,t);return r.refresh().then(function(){return i.push(r)})});return n.data.$q.all(a).then(function(){return i})})},n}(n);e.NetworkOnNodeCollection=s;var c=function(t){function n(e,n){var i=t.call(this,e)||this;return i.networkName=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this,i=[];return this.data.restClient.getAppsOnNetwork(this.networkName,t).then(function(t){var r=_.map(t,function(t){var r=new e.AppOnNetwork(n.data,t);return r.refresh().then(function(){return i.push(r)})});return n.data.$q.all(r).then(function(){return i})})},n}(n);e.AppOnNetworkCollection=c;var l=function(t){function n(e,n){var i=t.call(this,e)||this;return i.networkName=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this,i=[];return this.data.restClient.getNodesOnNetwork(this.networkName,t).then(function(t){var r=_.map(t,function(t){var r=new e.NodeOnNetwork(n.data,t);return r.refresh().then(function(){i.push(r)})});return n.data.$q.all(r).then(function(){return i})})},n}(n);e.NodeOnNetworkCollection=l;var u=function(t){function n(e,n){var i=t.call(this,e)||this;return i.networkName=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getNodesOnNetwork(this.networkName,t).then(function(i){var r=new Array,a=[];return _.each(i,function(i){a.push(n.data.restClient.getDeployedContainersOnNetwork(n.networkName,i.nodeName,t).then(function(t){_.each(t,function(t){r.push(new e.DeployedContainerOnNetwork(n.data,i.nodeName,t))})}))}),n.data.$q.all(a).then(function(e){return r})})},n}(n);e.DeployedContainerOnNetworkCollection=u;var p=function(t){function n(e){var n=t.call(this,e)||this;return n.upgradingAppCount=0,n}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getAppsViewPath()},enumerable:!0,configurable:!0}),n.prototype.mergeClusterHealthStateChunk=function(t){var n=this;return this.updateCollectionFromHealthChunkList(t.ApplicationHealthStateChunks,function(t){return e.IdGenerator.app(e.IdUtils.nameToId(t.ApplicationName))}).then(function(){return n.updateAppsHealthState(),n.refreshAppTypeGroups()})},n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getApplications(t).then(function(t){return _.map(t,function(t){return new e.Application(n.data,t)})})},n.prototype.updateInternal=function(){return this.upgradingAppCount=_.filter(this.collection,function(e){return e.isUpgrading}).length,this.updateAppsHealthState(),this.refreshAppTypeGroups()},n.prototype.updateAppsHealthState=function(){this.healthState=this.length>0?this.valueResolver.resolveHealthStatus(_.max(_.map(this.collection,function(t){return e.HealthStateConstants.Values[t.healthState.text]}))):e.ValueResolver.healthStatuses[1]},n.prototype.refreshAppTypeGroups=function(){var e=this;return this.data.getAppTypeGroups(!1).then(function(t){_.each(t.collection,function(t){return t.refreshAppTypeApps(e)})})},n}(n);e.ApplicationCollection=p;var d=function(t){function n(e){return t.call(this,e)||this}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getAppTypesViewPath()},enumerable:!0,configurable:!0}),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getApplicationTypes(null,t).then(function(t){var i=_.map(t.data,function(t){return new e.ApplicationType(n.data,t)}),r=_.groupBy(i,function(e){return e.raw.Name});return _.map(r,function(t){return new e.ApplicationTypeGroup(n.data,t)})})},n}(n);e.ApplicationTypeGroupCollection=d;var h=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getApplicationBackupConfigurationInfoCollection(this.parent.id,t).then(function(t){return _.map(t,function(t){return new e.ApplicationBackupConfigurationInfo(n.data,t,n.parent)})})},n}(n);e.ApplicationBackupConfigurationInfoCollection=h;var f=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getServiceBackupConfigurationInfoCollection(this.parent.id,t).then(function(t){return _.map(t,function(t){return new e.ServiceBackupConfigurationInfo(n.data,t,n.parent)})})},n}(n);e.ServiceBackupConfigurationInfoCollection=f;var g=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i.startDate=null,i.endDate=null,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getPartitionBackupList(this.parent.parent.id,t,this.startDate,this.endDate).then(function(t){return _.map(t,function(t){return new e.PartitionBackup(n.data,t,n.parent)})})},n}(n);e.PartitionBackupCollection=g;var m=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getLatestPartitionBackup(this.parent.parent.id,t).then(function(t){return _.map(t,function(t){return new e.PartitionBackup(n.data,t,n.parent)})})},n}(n);e.SinglePartitionBackupCollection=m;var v=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewCollection=function(t){var n=this,i=null,r=null;return this.parent instanceof e.ApplicationType?(i=this.parent.raw.Name,r=this.parent.raw.Version):(i=this.parent.raw.TypeName,r=this.parent.raw.TypeVersion),this.data.restClient.getServiceTypes(i,r,t).then(function(t){return _.map(t.data,function(t){return new e.ServiceType(n.data,t,n.parent)})})},n}(n);e.ServiceTypeCollection=v;var y=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.mergeClusterHealthStateChunk=function(t){var n=this,i=null;if(this.parent.name===e.Constants.SystemAppName)i=t.SystemApplicationHealthStateChunk.ServiceHealthStateChunks;else{var r=_.find(t.ApplicationHealthStateChunks.Items,function(e){return e.ApplicationName===n.parent.name});r&&(i=r.ServiceHealthStateChunks)}return i?this.updateCollectionFromHealthChunkList(i,function(t){return e.IdGenerator.service(e.IdUtils.nameToId(t.ServiceName))}):this.data.$q.when(!0)},n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getServices(this.parent.id,t).then(function(t){return _.map(t,function(t){return new e.Service(n.data,t,n.parent)})})},n}(n);e.ServiceCollection=y;var S=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.mergeClusterHealthStateChunk=function(t){var n=this,i=_.find(t.ApplicationHealthStateChunks.Items,function(e){return e.ApplicationName===n.parent.parent.name});if(i){var r=_.find(i.ServiceHealthStateChunks.Items,function(e){return e.ServiceName===n.parent.name});if(r)return this.updateCollectionFromHealthChunkList(r.PartitionHealthStateChunks,function(t){return e.IdGenerator.partition(t.PartitionId)})}return this.data.$q.when(!0)},n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getPartitions(this.parent.parent.id,this.parent.id,t).then(function(t){return _.map(t,function(t){return new e.Partition(n.data,t,n.parent)})})},n}(n);e.PartitionCollection=S;var w=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),Object.defineProperty(n.prototype,"isStatefulService",{get:function(){return this.parent.parent.isStatefulService},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStatelessService",{get:function(){return this.parent.isStatelessService},enumerable:!0,configurable:!0}),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getReplicasOnPartition(this.parent.parent.parent.id,this.parent.parent.id,this.parent.id,t).then(function(t){return _.map(t,function(t){return new e.ReplicaOnPartition(n.data,t,n.parent)})})},n}(n);e.ReplicaOnPartitionCollection=w;var C=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.mergeClusterHealthStateChunk=function(t){var n=this,i=_.find(t.NodeHealthStateChunks.Items,function(e){return e.NodeName===n.parent.name});if(i)return this.updateCollectionFromHealthChunkList(i.DeployedApplicationHealthStateChunks,function(t){return e.IdGenerator.deployedApp(e.IdUtils.nameToId(t.ApplicationName))})},n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getDeployedApplications(this.parent.name,t).then(function(t){var i=t.data;return _.map(i,function(t){return new e.DeployedApplication(n.data,t,n.parent)})})},n.prototype.updateInternal=function(){var e=this;if(this.length>0){var t=this.data.getInitialClusterHealthChunkQueryDescription();return this.parent.addHealthStateFiltersForChildren(t),this.data.getClusterHealthChunk(t).then(function(t){return e.mergeClusterHealthStateChunk(t)})}},n}(n);e.DeployedApplicationCollection=C;var b=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.mergeClusterHealthStateChunk=function(t){var n=this,i=_.find(t.ApplicationHealthStateChunks.Items,function(e){return e.ApplicationName===n.parent.name});if(i){var r=_.find(i.DeployedApplicationHealthStateChunks.Items,function(e){return e.NodeName===n.parent.parent.name});if(r)return this.updateCollectionFromHealthChunkList(r.DeployedServicePackageHealthStateChunks,function(t){return e.IdGenerator.deployedServicePackage(t.ServiceManifestName,t.ServicePackageActivationId)})}return this.data.$q.when(!0)},n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getDeployedServicePackages(this.parent.parent.name,this.parent.id,t).then(function(t){var i=t.data;return _.map(i,function(t){return new e.DeployedServicePackage(n.data,t,n.parent)})})},n.prototype.updateInternal=function(){var e=this;if(this.length>0){var t=this.data.getInitialClusterHealthChunkQueryDescription();return this.parent.addHealthStateFiltersForChildren(t),this.data.getClusterHealthChunk(t).then(function(t){return e.mergeClusterHealthStateChunk(t)})}},n}(n);e.DeployedServicePackageCollection=b;var I=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getDeployedCodePackagesViewPath(this.parent.parent.parent.name,this.parent.parent.id,this.parent.id,this.parent.servicePackageActivationId)},enumerable:!0,configurable:!0}),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getDeployedCodePackages(this.parent.parent.parent.name,this.parent.parent.id,this.parent.name,t).then(function(t){return _.map(_.filter(t.data,function(e){return e.ServicePackageActivationId===n.parent.servicePackageActivationId}),function(t){return new e.DeployedCodePackage(n.data,t,n.parent)})})},n}(n);e.DeployedCodePackageCollection=I;var P=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.parent=n,i}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getDeployedReplicasViewPath(this.parent.parent.parent.name,this.parent.parent.id,this.parent.id,this.parent.servicePackageActivationId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStatefulService",{get:function(){return this.length>0&&_.first(this.collection).isStatefulService},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStatelessService",{get:function(){return this.length>0&&_.first(this.collection).isStatelessService},enumerable:!0,configurable:!0}),n.prototype.retrieveNewCollection=function(t){var n=this;return this.data.restClient.getDeployedReplicas(this.parent.parent.parent.name,this.parent.parent.id,this.parent.name,t).then(function(t){return _.map(_.filter(t.data,function(e){return e.ServicePackageActivationId===n.parent.servicePackageActivationId}),function(t){return new e.DeployedReplica(n.data,t,n.parent)})})},n}(n);e.DeployedReplicaCollection=P;var N=function(t){function n(n,i,r){var a=t.call(this,n,null,!0)||this;a.minimumRefreshTimeInSecs=10,a.pageSize=15,a.defaultDateWindowInDays=7,a.latestRefreshPeriodInSecs=3600,a.optionalColsStartIndex=2,a.settings=a.createListSettings(),a.detailsSettings=a.createListSettings();var o=new e.ListColumnSetting("#CorrelatedEvents","",[],null,function(t){return e.HtmlUtils.getEventDetailsViewLinkHtml(t.raw)});return o.fixedWidthPx=40,a.settings.columnSettings.splice(1,0,o),a.setNewDateWindowInternal(i,r),a}return __extends(n,t),Object.defineProperty(n.prototype,"startDate",{get:function(){return new Date(this._startDate.valueOf())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endDate",{get:function(){var e=new Date(this._endDate.valueOf()),t=new Date;return e>t&&(e=t),e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"queryStartDate",{get:function(){return this.isInitialized&&(this.endDate.getTime()-this.startDate.getTime())/1e3>this.latestRefreshPeriodInSecs?e.TimeUtils.AddSeconds(this.endDate,-1*this.latestRefreshPeriodInSecs):this.startDate},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"queryEndDate",{get:function(){return this.endDate},enumerable:!0,configurable:!0}),n.prototype.setDateWindow=function(e,t){return this.setNewDateWindowInternal(e,t)},n.prototype.resetDateWindow=function(){return this.setDateWindow(null,null)},n.prototype.reload=function(e){var t=this;return this.lastRefreshTime=null,this.clear().then(function(){return t.refresh(e)})},n.prototype.retrieveNewCollection=function(e){return this.lastRefreshTime&&(new Date).getTime()-this.lastRefreshTime.getTime()<1e3*this.minimumRefreshTimeInSecs?this.data.$q.when(this.collection):(this.lastRefreshTime=new Date,this.retrieveEvents(e))},n.prototype.getDetailsList=function(e){return this.data.createCorrelatedEventList(e.raw.eventInstanceId)},n.prototype.retrieveEvents=function(e){return this.data.$q.when([])},n.prototype.createListSettings=function(){var t=new e.ListSettings(this.pageSize,["raw.timeStamp"],[new e.ListColumnSetting("raw.kind","Type",["raw.kind"],!0,function(t){return e.HtmlUtils.getEventNameHtml(t.raw)}),new e.ListColumnSetting("raw.category","Event Category",["raw.category"],!0,function(e){return e.raw.category?e.raw.category:"Operational"}),new e.ListColumnSetting("raw.timeStampString","Timestamp")],[new e.ListColumnSetting("raw.eventInstanceId","",[],null,function(t){return e.HtmlUtils.getEventSecondRowHtml(t.raw)},-1)],!0,function(e){return Object.keys(e.raw.eventProperties).length>0},!0);return t.columnSettings[0].fixedWidthPx=320,t.columnSettings[1].fixedWidthPx=200,t.sortReverse=!0,t},n.prototype.setNewDateWindowInternal=function(t,n){return t||(t=e.TimeUtils.AddDays(n||new Date,-1*this.defaultDateWindowInDays)),n||(n=e.TimeUtils.AddDays(t,this.defaultDateWindowInDays)),(!this._startDate||this._startDate.getTime()!==t.getTime()||!this._endDate||this._endDate.getTime()!==n.getTime())&&(this._startDate=t,this._endDate=n,!0)},n}(n);e.EventListBase=N;var k=function(t){function n(e,n){return t.call(this,e)||this}return __extends(n,t),n.prototype.retrieveEvents=function(t){var n=this;return this.data.restClient.getClusterEvents(this.queryStartDate,this.queryEndDate,t).then(function(t){return t.map(function(t){return new e.FabricEventInstanceModel(n.data,t)})})},n}(N);e.ClusterEventList=k;var D=function(t){function n(n,i){var r=t.call(this,n)||this;return r.nodeName=i,r.nodeName||r.settings.columnSettings.splice(r.optionalColsStartIndex,0,new e.ListColumnSettingWithFilter("raw.nodeName","Node Name")),r}return __extends(n,t),n.prototype.retrieveEvents=function(t){var n=this;return this.data.restClient.getNodeEvents(this.queryStartDate,this.queryEndDate,this.nodeName,t).then(function(t){return t.map(function(t){return new e.FabricEventInstanceModel(n.data,t)})})},n}(N);e.NodeEventList=D;var A=function(t){function n(n,i){var r=t.call(this,n)||this;return i&&(r.applicationId=i.replace(new RegExp("/","g"),"~")),r.applicationId||r.settings.columnSettings.splice(r.optionalColsStartIndex,0,new e.ListColumnSettingWithFilter("raw.applicationId","Application Id")),r}return __extends(n,t),
n.prototype.retrieveEvents=function(t){var n=this;return this.data.restClient.getApplicationEvents(this.queryStartDate,this.queryEndDate,this.applicationId,t).then(function(t){return t.map(function(t){return new e.FabricEventInstanceModel(n.data,t)})})},n}(N);e.ApplicationEventList=A;var x=function(t){function n(n,i){var r=t.call(this,n)||this;return i&&(r.serviceId=i.replace(new RegExp("/","g"),"~")),r.serviceId||r.settings.columnSettings.splice(r.optionalColsStartIndex,0,new e.ListColumnSettingWithFilter("raw.serviceId","Service Id")),r}return __extends(n,t),n.prototype.retrieveEvents=function(t){var n=this;return this.data.restClient.getServiceEvents(this.queryStartDate,this.queryEndDate,this.serviceId,t).then(function(t){return t.map(function(t){return new e.FabricEventInstanceModel(n.data,t)})})},n}(N);e.ServiceEventList=x;var R=function(t){function n(n,i){var r=t.call(this,n)||this;return r.partitionId=i,r.partitionId||r.settings.columnSettings.splice(r.optionalColsStartIndex,0,new e.ListColumnSettingWithFilter("raw.partitionId","Partition Id")),r}return __extends(n,t),n.prototype.retrieveEvents=function(t){var n=this;return this.data.restClient.getPartitionEvents(this.queryStartDate,this.queryEndDate,this.partitionId,t).then(function(t){return t.map(function(t){return new e.FabricEventInstanceModel(n.data,t)})})},n}(N);e.PartitionEventList=R;var T=function(t){function n(n,i,r){var a=t.call(this,n)||this;return a.partitionId=i,a.replicaId=r,a.replicaId||a.settings.columnSettings.splice(a.optionalColsStartIndex,0,new e.ListColumnSettingWithFilter("raw.replicaId","Replica Id")),a}return __extends(n,t),n.prototype.retrieveEvents=function(t){var n=this;return this.data.restClient.getReplicaEvents(this.queryStartDate,this.queryEndDate,this.partitionId,this.replicaId,t).then(function(t){return t.map(function(t){return new e.FabricEventInstanceModel(n.data,t)})})},n}(N);e.ReplicaEventList=T;var $=function(t){function n(e,n){var i=t.call(this,e)||this;return i.eventInstanceId=n,i}return __extends(n,t),n.prototype.retrieveEvents=function(t){var n=this;return this.data.restClient.getCorrelatedEvents(this.eventInstanceId,t).then(function(t){return t.map(function(t){return new e.FabricEventInstanceModel(n.data,t)})})},n}(N);e.CorrelatedEventList=$}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(i,a){var o=t.call(this,i,a)||this;return o.decorators={decorators:{NodeUpTimeInSeconds:{displayName:function(e){return"Node Up Time"},displayValueInHtml:function(e){return o.nodeUpTime}}}},o.expectedNodeStatus=e.NodeStatus.Invalid,o.deployedApps=new e.DeployedApplicationCollection(o.data,o),o.loadInformation=new n(o.data,o),o.health=new r(o.data,o,e.HealthStateFilterFlags.Default),o.data.actionsEnabled()&&o.setUpActions(),o.data.actionsAdvancedEnabled()&&o.setAdvancedActions(),o}return __extends(i,t),Object.defineProperty(i.prototype,"nodeStatus",{get:function(){return this.raw.IsStopped?"Down (Stopped)":this.raw.NodeStatus},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nodeUpTime",{get:function(){return e.TimeUtils.getDurationFromSeconds(this.raw.NodeUpTimeInSeconds)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.raw.Id.Id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewPath",{get:function(){return this.data.routes.getNodeViewPath(this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tooltip",{get:function(){return this.name+"\nType: "+this.raw.Type+"\nStatus: "+this.raw.NodeStatus+"\nHealth State: "+this.healthState.text},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"upgradeDomain",{get:function(){return this.raw.UpgradeDomain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"faultDomain",{get:function(){return this.raw.FaultDomain},enumerable:!0,configurable:!0}),i.prototype.addHealthStateFiltersForChildren=function(e){var t=this;return _.forEach(e.ApplicationFilters,function(e){_.isEmpty(e.DeployedApplicationFilters)&&(e.DeployedApplicationFilters=[]),e.DeployedApplicationFilters.push({NodeNameFilter:t.name})}),null},i.prototype.removeAdvancedActions=function(){this.actions.collection=this.actions.collection.filter(function(e){return-1===["activateNode","removeNodeState","deactivePauseNode","deactiveRestartNode","deactiveRemoveNodeData"].indexOf(e.name)})},i.prototype.setAdvancedActions=function(){var t=this;this.actions.add(new e.Action("activateNode","Activate","Activating",function(){return t.activate()},function(){return t.expectedNodeStatus!==e.NodeStatus.Invalid?t.expectedNodeStatus===e.NodeStatus.Disabled:t.raw.NodeStatus===e.NodeStatusConstants.Down||t.raw.NodeStatus===e.NodeStatusConstants.Disabling||t.raw.NodeStatus===e.NodeStatusConstants.Disabled})),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"removeNodeState","Remove node state","Removing",function(){return t.removeNodeState()},function(){return t.raw.NodeStatus===e.NodeStatusConstants.Down},"Confirm Node Removal","Data about node "+this.name+" will be completely erased from the cluster "+this.data.$location.host()+". All data stored on the node will be lost permanently. Are you sure to continue?",this.name)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"deactivePauseNode","Deactivate (pause)","Deactivating",function(){return t.deactivate(1)},function(){return t.raw.NodeStatus!==e.NodeStatusConstants.Down},"Confirm Node Deactivation","Deactivate node '"+this.name+"' from cluster '"+this.data.$location.host()+"'? This node will not become operational again until it is manually reactivated. WARNING: Deactivating nodes can cause data loss if not used with caution. For more information see: https://go.microsoft.com/fwlink/?linkid=825861",this.name)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"deactiveRestartNode","Deactivate (restart)","Deactivating",function(){return t.deactivate(2)},function(){return t.raw.NodeStatus!==e.NodeStatusConstants.Down},"Confirm Node Deactivation","Deactivate node '"+this.name+"' from cluster '"+this.data.$location.host()+"'? This node will not become operational again until it is manually reactivated. WARNING: Deactivating nodes can cause data loss if not used with caution. For more information see: https://go.microsoft.com/fwlink/?linkid=825861",this.name)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"deactiveRemoveNodeData","Deactivate (remove data)","Deactivating",function(){return t.deactivate(3)},function(){return t.raw.NodeStatus!==e.NodeStatusConstants.Down},"Confirm Node Deactivation","Deactivate node '"+this.name+"' from cluster '"+this.data.$location.host()+"'? This node will not become operational again until it is manually reactivated. WARNING: Deactivating nodes can cause data loss if not used with caution. For more information see: https://go.microsoft.com/fwlink/?linkid=825861",this.name))},i.prototype.retrieveNewData=function(t){var n=this;return this.data.restClient.getNode(this.name,t).then(function(t){return n.expectedNodeStatus=e.NodeStatus.Invalid,t.data})},i.prototype.setUpActions=function(){var t=this;this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"restartNode","Restart","Restarting",function(){return t.restart()},function(){return!0},"Confirm Node Restart","Restart node "+this.name+" from the cluster "+this.data.$location.host()+"?",this.name))},i.prototype.activate=function(){var t=this;return this.data.restClient.activateNode(this.name).then(function(){t.expectedNodeStatus=e.NodeStatus.Up})},i.prototype.deactivate=function(t){var n=this;return this.data.restClient.deactivateNode(this.name,t).then(function(){n.expectedNodeStatus=e.NodeStatus.Disabled})},i.prototype.removeNodeState=function(){return this.data.restClient.removeNodeState(this.name)},i.prototype.restart=function(){return this.data.restClient.restartNode(this.name,this.raw.InstanceId)},i}(e.DataModelBase);e.Node=t;var n=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i.decorators={hideList:["NodeName"]},i.nodeLoadMetricInformation=[],i}return __extends(n,t),Object.defineProperty(n.prototype,"name",{get:function(){return this.raw.NodeName},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getNodeLoadInformation(this.parent.name,t))},n.prototype.updateInternal=function(){var t=this;e.CollectionUtils.updateDataModelCollection(this.nodeLoadMetricInformation,_.map(this.raw.NodeLoadMetricInformation,function(e){return new i(t.data,e,t)}))},n}(e.DataModelBase);e.NodeLoadInformation=n;var i=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.parent=i,r}return __extends(t,e),Object.defineProperty(t.prototype,"hasCapacity",{get:function(){return this.raw.NodeCapacity&&+this.raw.NodeCapacity>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSystemMetric",{get:function(){return _.startsWith(this.raw.Name,"__")&&_.endsWith(this.raw.Name,"__")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadCapacityRatio",{get:function(){return this.hasCapacity?this.raw.NodeLoad/this.raw.NodeCapacity:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadCapacityRatioString",{get:function(){return(100*this.loadCapacityRatio).toFixed(1)+"%"},enumerable:!0,configurable:!0}),t}(e.DataModelBase);e.NodeLoadMetricInformation=i;var r=function(t){function n(e,n,i){var r=t.call(this,e,n)||this;return r.parent=n,r.eventsHealthStateFilter=i,r}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getNodeHealth(this.parent.name,this.eventsHealthStateFilter,t))},n}(e.HealthBase);e.NodeHealth=r}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function a(a,o,s){var c=t.call(this,a,o,s)||this;return c.parent=s,c.partitionInformation=new i(c.data,o.PartitionInformation),c.replicas=new e.ReplicaOnPartitionCollection(c.data,c),c.loadInformation=new r(c.data,c),c.health=new n(c.data,c,e.HealthStateFilterFlags.Default,e.HealthStateFilterFlags.None),c.partitionBackupInfo=new e.PartitionBackupInfo(c.data,c),c.data.actionsAdvancedEnabled()&&c.setAdvancedActions(),c}return __extends(a,t),Object.defineProperty(a.prototype,"isStatefulService",{get:function(){return e.ServiceKindRegexes.Stateful.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isStatelessService",{get:function(){return e.ServiceKindRegexes.Stateless.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"id",{get:function(){return this.partitionInformation.id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this.raw.PartitionInformation.Name||this.raw.PartitionInformation.Id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"viewPath",{get:function(){return this.data.routes.getPartitionViewPath(this.parent.parent.raw.TypeName,this.parent.parent.id,this.parent.id,this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsStatefulServiceAndSystemService",{get:function(){return this.isStatefulService&&"System"!==this.parent.parent.raw.TypeName},enumerable:!0,configurable:!0}),a.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getPartition(this.parent.parent.id,this.parent.id,this.id,t))},a.prototype.removeAdvancedActions=function(){this.actions.collection=this.actions.collection.filter(function(e){return-1===["enablePartitionBackup","disablePartitionBackup","suspendPartitionBackup","resumePartitionBackup","triggerPartitionBackup","restorePartitionBackup"].indexOf(e.name)})},a.prototype.setAdvancedActions=function(){var t=this;this.isStatelessService||this.parent.parent.raw.TypeName===e.Constants.SystemAppTypeName||(this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"enablePartitionBackup","Enable/Update Partition Backup","Enabling Partition Backup",function(){return t.data.restClient.enablePartitionBackup(t).then(function(){t.partitionBackupInfo.partitionBackupConfigurationInfo.refresh()})},function(){return!0},{templateUrl:"partials/enableBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)),this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"disablePartitionBackup","Disable Partition Backup","Disabling Partition Backup",function(){return t.data.restClient.disablePartitionBackup(t).then(function(){t.partitionBackupInfo.partitionBackupConfigurationInfo.refresh()})},function(){return t.partitionBackupInfo.partitionBackupConfigurationInfo.raw&&"Partition"===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.Kind&&"Partition"===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.PolicyInheritedFrom},{templateUrl:"partials/disableBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"suspendPartitionBackup","Suspend Partition Backup","Suspending...",function(){return t.data.restClient.suspendPartitionBackup(t.id).then(function(){t.partitionBackupInfo.partitionBackupConfigurationInfo.refresh()})},function(){return t.partitionBackupInfo.partitionBackupConfigurationInfo.raw&&"Partition"===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.Kind&&"Partition"===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.PolicyInheritedFrom&&!1===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.SuspensionInfo.IsSuspended},"Confirm Partition Backup Suspension","Suspend partition backup for "+this.name+" ?",this.name)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"resumePartitionBackup","Resume Partition Backup","Resuming...",function(){return t.data.restClient.resumePartitionBackup(t.id).then(function(){t.partitionBackupInfo.partitionBackupConfigurationInfo.refresh()})},function(){return t.partitionBackupInfo.partitionBackupConfigurationInfo.raw&&"Partition"===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.Kind&&"Partition"===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.PolicyInheritedFrom&&!0===t.partitionBackupInfo.partitionBackupConfigurationInfo.raw.SuspensionInfo.IsSuspended},"Confirm Partition Backup Resumption","Resume partition backup for "+this.name+" ?",this.name)),this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"triggerPartitionBackup","Trigger Partition Backup","Triggering Partition Backup",function(){return t.data.restClient.triggerPartitionBackup(t)},function(){return!0},{templateUrl:"partials/triggerPartitionBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)),this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"restorePartitionBackup","Restore Partition Backup","Restoring Partition Backup",function(){return t.data.restClient.restorePartitionBackup(t)},function(){return!0},{templateUrl:"partials/restorePartitionBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)))},a}(e.DataModelBase);e.Partition=t;var n=function(t){function n(e,n,i,r){var a=t.call(this,e,n)||this;return a.parent=n,a.eventsHealthStateFilter=i,a.replicasHealthStateFilter=r,a}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getPartitionHealth(this.parent.parent.parent.id,this.parent.parent.id,this.parent.id,this.eventsHealthStateFilter,this.replicasHealthStateFilter,t))},n}(e.HealthBase);e.PartitionHealth=n;var i=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),Object.defineProperty(n.prototype,"isPartitionKindInt64Range",{get:function(){return e.ServicePartitionKindRegexes.Int64Range.test(this.raw.ServicePartitionKind)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isPartitionKindNamed",{get:function(){return e.ServicePartitionKindRegexes.Named.test(this.raw.ServicePartitionKind)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.PartitionInformation=i;var r=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i.decorators={hideList:["PartitionId"]},i.primaryLoadMetricReports=[],i.secondaryLoadMetricReports=[],i}return __extends(n,t),Object.defineProperty(n.prototype,"isValid",{get:function(){return this.isInitialized&&(this.primaryLoadMetricReports.length>0||this.secondaryLoadMetricReports.length>0)},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getPartitionLoadInformation(this.parent.parent.parent.id,this.parent.parent.id,this.parent.id,t))},n.prototype.updateInternal=function(){var e=this;this.primaryLoadMetricReports=_.map(this.raw.PrimaryLoadMetricReports,function(t){return new a(e.data,t)}),this.secondaryLoadMetricReports=_.map(this.raw.SecondaryLoadMetricReports,function(t){return new a(e.data,t)})},n}(e.DataModelBase);e.PartitionLoadInformation=r;var a=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),Object.defineProperty(n.prototype,"lastReportedUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastReportedUtc)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.LoadMetricReport=a}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,r){var s=t.call(this,n,r)||this;return s.decorators={decorators:{TypeName:{displayValueInHtml:function(t){return e.HtmlUtils.getLinkHtml(t,s.appTypeViewPath)}}}},s.services=new e.ServiceCollection(n,s),s.health=new i(n,s,e.HealthStateFilterFlags.Default,e.HealthStateFilterFlags.None,e.HealthStateFilterFlags.Default),s.manifest=new a(n,s),s.serviceTypes=new e.ServiceTypeCollection(n,s),s.upgradeProgress=new o(n,s),s.applicationBackupConfigurationInfoCollection=new e.ApplicationBackupConfigurationInfoCollection(n,s),s.cleanBackup=!1,s.data.actionsEnabled()&&s.setUpActions(),s.data.actionsAdvancedEnabled()&&s.setAdvancedActions(),s}return __extends(n,t),Object.defineProperty(n.prototype,"isUpgrading",{get:function(){return this.raw.Status===e.AppStatusConstants.Upgrading},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getAppViewPath(this.raw.TypeName,this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"appTypeViewPath",{get:function(){return this.raw.TypeName===e.Constants.SystemAppTypeName?this.data.routes.getSystemAppsViewPath():this.data.routes.getAppTypeViewPath(this.raw.TypeName)},enumerable:!0,configurable:!0}),n.prototype.delete=function(){var t=this;return(this.raw.ApplicationDefinitionKind===e.Constants.ComposeApplicationDefinitionKind?this.data.restClient.deleteComposeApplication(this.id):this.data.restClient.deleteApplication(this.id)).then(function(){t.cleanUpApplicationReplicas()})},n.prototype.addHealthStateFiltersForChildren=function(t){var n=this,i=_.find(t.ApplicationFilters,function(e){return e.ApplicationNameFilter===n.name});return i||(i={ApplicationNameFilter:this.name,ServiceFilters:[]},t.ApplicationFilters.push(i)),_.isEmpty(i.ServiceFilters)&&(i.ServiceFilters=[{HealthStateFilter:e.HealthStateFilterFlags.All}]),i},n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getApplication(this.id,t))},n.prototype.removeAdvancedActions=function(){this.actions.collection=this.actions.collection.filter(function(e){return-1===["enableApplicationBackup","disableApplicationBackup","suspendApplicationBackup","suspendApplicationBackup"].indexOf(e.name)})},n.prototype.setUpActions=function(){var t=this;this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"deleteApplication","Delete Application","Deleting...",function(){return t.delete()},function(){return!0},"Confirm Application Deletion","Delete application "+this.name+" from cluster "+this.data.$location.host()+"?",this.name))},n.prototype.setAdvancedActions=function(){var t=this;this.raw.TypeName!==e.Constants.SystemAppTypeName&&(this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"enableApplicationBackup","Enable/Update Application Backup","Enabling Application Backup",function(){return t.data.restClient.enableApplicationBackup(t).then(function(){t.applicationBackupConfigurationInfoCollection.refresh()})},function(){return!0},{templateUrl:"partials/enableBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)),this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"disableApplicationBackup","Disable Application Backup","Disabling Application Backup",function(){return t.data.restClient.disableApplicationBackup(t).then(function(){t.applicationBackupConfigurationInfoCollection.refresh()})},function(){return t.applicationBackupConfigurationInfoCollection.collection.length&&t.applicationBackupConfigurationInfoCollection.collection[0].raw&&"Application"===t.applicationBackupConfigurationInfoCollection.collection[0].raw.Kind&&"Application"===t.applicationBackupConfigurationInfoCollection.collection[0].raw.PolicyInheritedFrom},{templateUrl:"partials/disableBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"suspendApplicationBackup","Suspend Application Backup","Suspending...",function(){return t.data.restClient.suspendApplicationBackup(t.id).then(function(){t.applicationBackupConfigurationInfoCollection.refresh()})},function(){return t.applicationBackupConfigurationInfoCollection.collection.length&&t.applicationBackupConfigurationInfoCollection.collection[0].raw&&"Application"===t.applicationBackupConfigurationInfoCollection.collection[0].raw.Kind&&"Application"===t.applicationBackupConfigurationInfoCollection.collection[0].raw.PolicyInheritedFrom&&!1===t.applicationBackupConfigurationInfoCollection.collection[0].raw.SuspensionInfo.IsSuspended},"Confirm Application Backup Suspension","Suspend application backup for "+this.name+" ?",this.name)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"resumeApplicationBackup","Resume Application Backup","Resuming...",function(){return t.data.restClient.resumeApplicationBackup(t.id).then(function(){t.applicationBackupConfigurationInfoCollection.refresh()})},function(){return t.applicationBackupConfigurationInfoCollection.collection.length&&t.applicationBackupConfigurationInfoCollection.collection[0].raw&&"Application"===t.applicationBackupConfigurationInfoCollection.collection[0].raw.Kind&&"Application"===t.applicationBackupConfigurationInfoCollection.collection[0].raw.PolicyInheritedFrom&&!0===t.applicationBackupConfigurationInfoCollection.collection[0].raw.SuspensionInfo.IsSuspended},"Confirm Application Backup Resumption","Resume application backup for "+this.name+" ?",this.name)))},n.prototype.cleanUpApplicationReplicas=function(){var t=this;this.data.getNodes(!0).then(function(n){var i=[],r=_.map(n.collection,function(e){return t.data.restClient.getReplicasOnNode(e.name,t.id).then(function(t){return _.forEach(t.data,function(t){i.push({Replica:t,NodeName:e.name})})})});t.data.$q.all(r).then(function(){return _.forEach(i,function(n){return t.data.restClient.deleteReplica(n.NodeName,n.Replica.PartitionId,n.Replica.ReplicaId,!0,e.ResponseMessageHandlers.silentResponseMessageHandler)})})})},n}(e.DataModelBase);e.Application=t;var n=function(t){function n(n){var i=t.call(this,n,{Id:e.Constants.SystemAppId,Name:e.Constants.SystemAppName,TypeName:e.Constants.SystemAppTypeName,TypeVersion:"",Parameters:[],Status:"-1",HealthState:"0",ApplicationDefinitionKind:""})||this;return i.isInitialized=!1,i}return __extends(n,t),Object.defineProperty(n.prototype,"status",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getSystemAppsViewPath()},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(e){var t=this;return this.health.refresh(e).then(function(e){return t.raw.HealthState=e.raw.AggregatedHealthState,t.raw})},n}(t);e.SystemApplication=n;var i=function(t){function n(e,n,i,r,a){var o=t.call(this,e,n)||this;return o.parent=n,o.eventsHealthStateFilter=i,o.servicesHealthStateFilter=r,o.deployedApplicationsHealthStateFilter=a,o.deployedApplicationHealthStates=[],o}return __extends(n,t),Object.defineProperty(n.prototype,"deploymentsHealthState",{get:function(){var t=this,n=_.map(this.raw.DeployedApplicationHealthStates,function(e){return t.valueResolver.resolveHealthStatus(e.AggregatedHealthState)});return this.valueResolver.resolveHealthStatus(_.max(_.map(n,function(t){return e.HealthStateConstants.Values[t.text]})))},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getApplicationHealth(this.parent.id,this.eventsHealthStateFilter,this.servicesHealthStateFilter,this.deployedApplicationsHealthStateFilter,t))},n.prototype.updateInternal=function(){var e=this;t.prototype.updateInternal.call(this),this.deployedApplicationHealthStates=_.map(this.raw.DeployedApplicationHealthStates,function(t){return new r(e.data,t,e)})},n}(e.HealthBase);e.ApplicationHealth=i;var r=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.parent=i,r}return __extends(t,e),Object.defineProperty(t.prototype,"viewPath",{get:function(){return this.data.routes.getDeployedAppViewPath(this.raw.NodeName,this.parent.parent.id)},enumerable:!0,configurable:!0}),t}(e.DataModelBase);e.DeployedApplicationHealthState=r;var a=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getApplicationManifestForApplicationType(this.parent.raw.TypeName,this.parent.raw.TypeVersion,t))},n}(e.DataModelBase);e.ApplicationManifest=a;var o=function(t){function n(n,i){var r=t.call(this,n,null,i)||this;return r.parent=i,r.decorators={hideList:["UnhealthyEvaluations"],decorators:{UpgradeDurationInMilliseconds:{displayName:function(e){return"Upgrade Duration"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}},UpgradeDomainDurationInMilliseconds:{displayName:function(e){return"Upgrade Domain Duration"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}}}},r.unhealthyEvaluations=[],r.upgradeDomains=[],r}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.parent.viewPath},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"uniqueId",{get:function(){return this.name+"/"+this.raw.TypeName+"/"+this.raw.TargetApplicationTypeVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"startTimestampUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.StartTimestampUtc)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"failureTimestampUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.FailureTimestampUtc)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"upgradeDuration",{get:function(){return e.TimeUtils.getDuration(this.raw.UpgradeDurationInMilliseconds)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"upgradeDomainDuration",{get:function(){return e.TimeUtils.getDuration(this.raw.UpgradeDomainDurationInMilliseconds)},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getApplicationUpgradeProgress(this.parent.id,t))},n.prototype.updateInternal=function(){var t=this;this.unhealthyEvaluations=e.Utils.getParsedHealthEvaluations(this.raw.UnhealthyEvaluations,0,null,this.data);var n=_.map(this.raw.UpgradeDomains,function(n){return new e.UpgradeDomain(t.data,n)}),i=_.filter(n,function(t){return t.stateName===e.UpgradeDomainStateNames.Completed}).concat(_.filter(n,function(t){return t.stateName===e.UpgradeDomainStateNames.InProgress})).concat(_.filter(n,function(e){return e.name===t.raw.NextUpgradeDomain})).concat(_.filter(n,function(n){return n.stateName===e.UpgradeDomainStateNames.Pending&&n.name!==t.raw.NextUpgradeDomain}));this.upgradeDomains=i,this.raw.UpgradeDescription&&(this.upgradeDescription=new e.UpgradeDescription(this.data,this.raw.UpgradeDescription))},n}(e.DataModelBase);e.ApplicationUpgradeProgress=o;var s=function(t){function n(n,i,r){var a=t.call(this,n,i,r)||this;return a.parent=r,a.decorators={hideList:["action.Name"]},a.action=new e.ActionWithDialog(n.$uibModal,n.$q,i.PolicyName,i.PolicyName,"Creating",function(){return a.data.restClient.deleteBackupPolicy(a.raw.PolicyName)},function(){return!0},{templateUrl:"partials/backupPolicy.html",controller:e.ActionController,resolve:{action:function(){return a.data.getBackupPolicy(a.raw.PolicyName)}}},null),a}return __extends(n,t),n}(e.DataModelBase);e.ApplicationBackupConfigurationInfo=s}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(i,r,a){var o=t.call(this,i,r,a)||this;return o.parent=a,o.decorators={decorators:{TypeName:{displayValueInHtml:function(t){return e.HtmlUtils.getLinkHtml(t,o.appTypeViewPath)}}}},o.deployedServicePackages=new e.DeployedServicePackageCollection(o.data,o),o.health=new n(o.data,o,e.HealthStateFilterFlags.Default,e.HealthStateFilterFlags.None),o}return __extends(i,t),Object.defineProperty(i.prototype,"viewPath",{get:function(){return this.data.routes.getDeployedAppViewPath(this.parent.name,this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"appTypeViewPath",{get:function(){return this.data.routes.getAppTypeViewPath(this.raw.TypeName)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"diskLocation",{get:function(){return this.raw.WorkDirectory?this.raw.WorkDirectory.substring(0,this.raw.WorkDirectory.lastIndexOf("\\")):this.raw.WorkDirectory},enumerable:!0,configurable:!0}),i.prototype.addHealthStateFiltersForChildren=function(t){var n=this,i=_.find(t.ApplicationFilters,function(e){return e.ApplicationNameFilter===n.name});i||(i={ApplicationNameFilter:this.name,DeployedApplicationFilters:[]},t.ApplicationFilters.push(i));var r=_.find(i.DeployedApplicationFilters,function(e){return e.NodeNameFilter===n.parent.name});return r||(r={NodeNameFilter:this.parent.name,DeployedServicePackageFilters:[]},i.DeployedApplicationFilters.push(r)),_.isEmpty(r.DeployedServicePackageFilters)&&(r.DeployedServicePackageFilters=[{HealthStateFilter:e.HealthStateFilterFlags.All}]),r},i.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getDeployedApplication(this.parent.name,this.id,t))},i.prototype.refreshFromHealthChunkInternal=function(e){return this.health.mergeHealthStateChunk(e)},i}(e.DataModelBase);e.DeployedApplication=t;var n=function(t){function n(e,n,i,r){var a=t.call(this,e,n)||this;return a.parent=n,a.eventsHealthStateFilter=i,a.deployedServicePackagesHealthFilter=r,a}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getDeployedApplicationHealth(this.parent.parent.name,this.parent.id,this.eventsHealthStateFilter,this.deployedServicePackagesHealthFilter,t))},n}(e.HealthBase);e.DeployedApplicationHealth=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(e,i,r){var a=t.call(this,e,i,r)||this;return a.parent=r,a.decorators={decorators:{LastInBuildDurationInSeconds:{displayName:function(e){return"Last In Build Duration"},displayValueInHtml:function(e){return a.lastInBuildDuration}}}},
a.detail=new n(a.data,a),a.updateInternal(),a.data.actionsEnabled()&&a.setUpActions(),a}return __extends(i,t),Object.defineProperty(i.prototype,"servicePackageActivationId",{get:function(){return this.raw.ServicePackageActivationId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"serviceViewPath",{get:function(){return this.data.routes.getServiceViewPath(this.parent.parent.raw.TypeName,this.parent.parent.raw.Id,e.IdUtils.nameToId(this.raw.ServiceName))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isStatefulService",{get:function(){return e.ServiceKindRegexes.Stateful.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isStatelessService",{get:function(){return e.ServiceKindRegexes.Stateless.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return this.raw.PartitionId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.raw.ReplicaId||this.raw.InstanceId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"role",{get:function(){return this.partition&&"Reconfiguring"===this.partition.PartitionStatus?"Reconfiguring - Target Role: "+this.raw.ReplicaRole:this.raw.ReplicaRole},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewPath",{get:function(){return this.data.routes.getDeployedReplicaViewPath(this.parent.parent.parent.name,this.parent.parent.id,this.parent.id,this.parent.servicePackageActivationId,this.raw.PartitionId,this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastInBuildDuration",{get:function(){return e.TimeUtils.getDurationFromSeconds(this.raw.LastInBuildDurationInSeconds)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"replicaRoleSortPriority",{get:function(){return e.SortPriorities.ReplicaRolesToSortPriorities[this.raw.ReplicaRole]||0},enumerable:!0,configurable:!0}),i.prototype.restartReplica=function(){return this.data.restClient.restartReplica(this.parent.parent.parent.raw.Name,this.raw.PartitionId,this.raw.ReplicaId)},i.prototype.retrieveNewData=function(t){var n=this,i=[this.data.restClient.getPartitionById(this.raw.PartitionId,e.ResponseMessageHandlers.silentResponseMessageHandler).then(function(e){return n.partition=e.data}),this.data.restClient.getDeployedReplica(this.parent.parent.parent.name,this.parent.parent.id,this.parent.name,this.raw.PartitionId,t).then(function(e){return _.first(e.data)})];return this.data.$q.all(i).then(function(e){return e[1]})},i.prototype.updateInternal=function(){this.address=e.Utils.parseReplicaAddress(this.raw.Address)},i.prototype.setUpActions=function(){var t=this,n=this.parent.parent.raw.Name;this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"Restart Replica","Restart Replica","Restarting",function(){return t.restartReplica()},function(){return!0},"Confirm Replica Restart","Restart Replica for "+n,"confirm"))},i}(e.DataModelBase);e.DeployedReplica=t;var n=function(n){function r(e,t){var i=n.call(this,e,null,t)||this;return i.parent=t,i.decorators={hideList:["ServiceKind","InstanceId","ReplicaId"]},i}return __extends(r,n),Object.defineProperty(r.prototype,"currentServiceOperationStartTimeUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.CurrentServiceOperationStartTimeUtc)},enumerable:!0,configurable:!0}),r.prototype.retrieveNewData=function(n){var i=null;if(this.parent instanceof t){var r=this.parent;i=this.data.restClient.getDeployedReplicaDetail(r.parent.parent.parent.name,r.raw.PartitionId,r.id,n)}else{var a=this.parent;i=this.data.restClient.getDeployedReplicaDetail(a.raw.NodeName,a.parent.id,a.id,n)}return e.Utils.getHttpResponseData(i)},r.prototype.updateInternal=function(){var t=this;this.reportedLoad=_.map(this.raw.ReportedLoad,function(n){return new e.LoadMetricReport(t.data,n)}),this.raw.ReplicatorStatus&&(this.replicatorStatus=new i(this.data,this.raw.ReplicatorStatus))},r}(e.DataModelBase);e.DeployedReplicaDetail=n;var i=function(t){function n(e,n){var i=t.call(this,e,n)||this;return n.RemoteReplicators&&(i.remoteReplicators=_.map(n.RemoteReplicators,function(e){return new r(i.data,e)})),i}return __extends(n,t),Object.defineProperty(n.prototype,"LastCopyOperationReceivedTimeUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastCopyOperationReceivedTimeUtc)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"LastReplicationOperationReceivedTimeUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastReplicationOperationReceivedTimeUtc)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"LastAcknowledgementSentTimeUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastAcknowledgementSentTimeUtc)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.ReplicatorStatus=i;var r=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),Object.defineProperty(n.prototype,"lastAcknowledgementProcessedTimeUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastAcknowledgementProcessedTimeUtc)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.RemoteReplicatorStatus=r}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(i,r,a){var o=t.call(this,i,r,a)||this;return o.parent=a,o.decorators={decorators:{LastInBuildDurationInSeconds:{displayName:function(e){return"Last In Build Duration"},displayValueInHtml:function(e){return o.lastInBuildDuration}},NodeName:{displayValueInHtml:function(t){return e.HtmlUtils.getLinkHtml(t,o.nodeViewPath)}},ReplicaRole:{displayValueInHtml:function(e){return o.role}}}},o.health=new n(o.data,o,e.HealthStateFilterFlags.Default),o.detail=new e.DeployedReplicaDetail(o.data,o),o.updateInternal(),o.data.actionsEnabled()&&o.setUpActions(),o}return __extends(i,t),i.prototype.restartReplica=function(){return this.data.restClient.restartReplica(this.raw.NodeName,this.parent.raw.PartitionInformation.Id,this.raw.ReplicaId)},i.prototype.deleteInstance=function(){return this.data.restClient.deleteReplica(this.raw.NodeName,this.parent.raw.PartitionInformation.Id,this.raw.InstanceId)},Object.defineProperty(i.prototype,"isStatefulService",{get:function(){return e.ServiceKindRegexes.Stateful.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isStatelessService",{get:function(){return e.ServiceKindRegexes.Stateless.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.raw.ReplicaId||this.raw.InstanceId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"role",{get:function(){return"Reconfiguring"===this.parent.raw.PartitionStatus?"Reconfiguring - Target Role: "+this.raw.ReplicaRole:this.raw.ReplicaRole},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewPath",{get:function(){return this.data.routes.getReplicaViewPath(this.parent.parent.parent.raw.TypeName,this.parent.parent.parent.id,this.parent.parent.id,this.parent.id,this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nodeViewPath",{get:function(){return this.data.routes.getNodeViewPath(this.raw.NodeName)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastInBuildDuration",{get:function(){return e.TimeUtils.getDurationFromSeconds(this.raw.LastInBuildDurationInSeconds)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"replicaRoleSortPriority",{get:function(){return e.SortPriorities.ReplicaRolesToSortPriorities[this.raw.ReplicaRole]||0},enumerable:!0,configurable:!0}),i.prototype.retrieveNewData=function(t){var n=this;return this.parent.refresh().then(function(){return e.Utils.getHttpResponseData(n.data.restClient.getReplicaOnPartition(n.parent.parent.parent.id,n.parent.parent.id,n.parent.id,n.id,t))})},i.prototype.updateInternal=function(){this.address=e.Utils.parseReplicaAddress(this.raw.Address)},i.prototype.setUpActions=function(){var t=this,n=this.parent.parent.raw.Name;this.isStatefulService?this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"Restart Replica","Restart Replica","Restarting",function(){return t.restartReplica()},function(){return!0},"Confirm Replica Restart","Restart Replica for "+n,"confirm")):this.isStatelessService&&this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"Delete Instance","Delete Instance","Deleting",function(){return t.deleteInstance()},function(){return!0},"Confirm Instance Delete","Delete Instance for "+n,"confirm"))},i}(e.DataModelBase);e.ReplicaOnPartition=t;var n=function(t){function n(e,n,i){var r=t.call(this,e,n)||this;return r.parent=n,r.eventsHealthStateFilter=i,r}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getReplicaHealth(this.parent.parent.parent.parent.id,this.parent.parent.parent.id,this.parent.parent.id,this.parent.id,this.eventsHealthStateFilter,t))},n}(e.HealthBase);e.ReplicaHealth=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(i,r,a){var o=t.call(this,i,r,a)||this;return o.parent=a,o.deployedCodePackages=new e.DeployedCodePackageCollection(o.data,o),o.deployedReplicas=new e.DeployedReplicaCollection(o.data,o),o.health=new n(o.data,o,e.HealthStateFilterFlags.Default),o.manifest=new e.ServiceManifest(o.data,o),o}return __extends(i,t),Object.defineProperty(i.prototype,"servicePackageActivationId",{get:function(){return this.raw.ServicePackageActivationId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return e.IdGenerator.deployedServicePackage(this.name,this.servicePackageActivationId)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewPath",{get:function(){return this.data.routes.getDeployedServiceViewPath(this.parent.parent.name,this.parent.id,this.id,this.servicePackageActivationId)},enumerable:!0,configurable:!0}),i.prototype.retrieveNewData=function(e){var t=this;return this.data.restClient.getDeployedServicePackage(this.parent.parent.name,this.parent.id,this.name,e).then(function(e){return t.servicePackageActivationId?_.find(e.data,function(e){return t.servicePackageActivationId===e.ServicePackageActivationId}):_.first(e.data)})},i.prototype.refreshFromHealthChunkInternal=function(e){return this.health.mergeHealthStateChunk(e)},i}(e.DataModelBase);e.DeployedServicePackage=t;var n=function(t){function n(e,n,i){var r=t.call(this,e,n)||this;return r.parent=n,r.eventsHealthStateFilter=i,r}return __extends(n,t),Object.defineProperty(n.prototype,"servicePackageActivationId",{get:function(){return this.parent.servicePackageActivationId},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getDeployedServicePackageHealth(this.parent.parent.parent.name,this.parent.parent.id,this.parent.name,this.servicePackageActivationId,this.eventsHealthStateFilter,t))},n}(e.HealthBase);e.DeployedServicePackageHealth=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(e,n,i){var r=t.call(this,e,n,i)||this;return r.parent=i,r.containerLogsTail="100",r.updateInternal(),r.data.actionsEnabled()&&r.setUpActions(),r}return __extends(i,t),Object.defineProperty(i.prototype,"servicePackageActivationId",{get:function(){return this.raw.ServicePackageActivationId},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"uniqueId",{get:function(){return e.IdGenerator.deployedCodePackage(this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewPath",{get:function(){return this.data.routes.getCodePackageViewPath(this.parent.parent.parent.name,this.parent.parent.id,this.parent.id,this.parent.servicePackageActivationId,this.name)},enumerable:!0,configurable:!0}),i.prototype.retrieveNewData=function(e){var t=this;return this.data.restClient.getDeployedCodePackage(this.parent.parent.parent.name,this.parent.parent.id,this.parent.name,this.name,e).then(function(e){return _.find(e.data,function(e){return e.ServicePackageActivationId===t.parent.servicePackageActivationId})})},i.prototype.updateInternal=function(){this.mainEntryPoint=new n(this.data,this.raw.MainEntryPoint,this),this.setupEntryPoint=new n(this.data,this.raw.SetupEntryPoint,this),this.containerLogs=new r(this.data,this)},i.prototype.restart=function(){return this.data.restClient.restartCodePackage(this.parent.parent.parent.name,this.parent.parent.id,this.raw.ServiceManifestName,this.name,this.raw.MainEntryPoint.InstanceId,this.servicePackageActivationId)},i.prototype.setUpActions=function(){var t=this;this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"restartCodePackage","Restart","Restarting",function(){return t.restart()},function(){return!0},"Confirm Code Package Restart","Restart code package "+this.name+"?",this.name))},i}(e.DataModelBase);e.DeployedCodePackage=t;var n=function(t){function n(e,n,r){var a=t.call(this,e,n,r)||this;return a.parent=r,a.codePackageEntryPointStatistics=new i(e,a.raw.CodePackageEntryPointStatistics,a),a}return __extends(n,t),Object.defineProperty(n.prototype,"nextActivationTime",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.NextActivationTime)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.CodePackageEntryPoint=n;var i=function(t){function n(e,n,i){var r=t.call(this,e,n,i)||this;return r.parent=i,r}return __extends(n,t),Object.defineProperty(n.prototype,"lastActivationTime",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastActivationTime)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastExitTime",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastExitTime)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastSuccessfulActivationTime",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastSuccessfulActivationTime)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastSuccessfulExitTime",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastSuccessfulExitTime)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.CodePackageEntryPointStatistics=i;var r=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewData=function(t){var n=this.parent;return e.Utils.getHttpResponseData(this.data.restClient.getDeployedContainerLogs(n.parent.parent.parent.name,n.parent.parent.id,n.parent.name,n.name,n.servicePackageActivationId,n.containerLogsTail,t))},n}(e.DataModelBase);e.ContainerLogs=r}(Sfx||(Sfx={}));var Sfx;!function(e){var t;!function(e){e[e.Node=0]="Node",e[e.Application=1]="Application",e[e.Service=2]="Service",e[e.Partition=3]="Partition",e[e.Replica=4]="Replica",e[e.DeployedApplication=5]="DeployedApplication",e[e.DepoyedServicePackage=6]="DepoyedServicePackage"}(t=e.HealthStatisticsEntityKind||(e.HealthStatisticsEntityKind={}));var n=function(n){function i(e,t,i,r){var a=n.call(this,e)||this;return a.eventsHealthStateFilter=t,a.nodesHealthStateFilter=i,a.applicationsHealthStateFilter=r,a.emptyHealthStateCount={OkCount:0,ErrorCount:0,WarningCount:0},a}return __extends(i,n),i.prototype.checkExpiredCertStatus=function(){var t=this;try{i.certExpirationChecked||this.ensureInitialized().then(function(n){n=t,n.healthState.text!==e.HealthStateConstants.Warning&&n.healthState.text!==e.HealthStateConstants.Error||t.data.getNodes(!0).then(function(e){var n=_.filter(e.collection,function(e){return e.raw.IsSeedNode});t.checkNodesContinually(0,n)})})}catch(e){}},i.prototype.getHealthStateCount=function(e){if(this.raw){var n=_.find(this.raw.HealthStatistics.HealthStateCountList,function(n){return n.EntityKind===t[e]});if(n)return n.HealthStateCount}return this.emptyHealthStateCount},i.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getClusterHealth(this.eventsHealthStateFilter,this.nodesHealthStateFilter,this.applicationsHealthStateFilter,t))},i.prototype.setMessage=function(t){var n=t.raw.Description.indexOf("thumbprint = "),r=t.raw.Description.substr(n+"thumbprint = ".length).split(",")[0],a=t.raw.Description.indexOf("expiration = "),o=t.raw.Description.substring(a+"expiration = ".length).split(",")[0];this.data.warnings.addOrUpdateNotification({message:"A cluster certificate is set to expire soon. Replace it as soon as possible to avoid catastrophic failure. <br> Thumbprint : "+r+"    Expiration: "+o,level:e.StatusWarningLevel.Error,priority:5,id:e.BannerWarningID.ExpiringClusterCert,link:"https://aka.ms/sfrenewclustercert/",linkText:"Read here for more guidance"}),i.certExpirationChecked=!0},i.prototype.containsCertExpiringHealthEvent=function(t){return t.filter(function(t){return 0===t.raw.Description.indexOf("Certificate expiration")&&t.raw.Property===e.CertExpiraryHealthEventProperty.Cluster&&(t.raw.HealthState===e.HealthStateConstants.Warning||t.raw.HealthState===e.HealthStateConstants.Error)})},i.prototype.checkNodesContinually=function(t,n){var r=this;if(t<n.length){var a=n[t];a.healthState.text===e.HealthStateConstants.Error||a.healthState.text===e.HealthStateConstants.Warning?a.health.ensureInitialized().then(function(){var e=r.containsCertExpiringHealthEvent(a.health.healthEvents);0===e.length?r.checkNodesContinually(t+1,n):r.setMessage(e[0])}):this.checkNodesContinually(t+1,n)}else i.certExpirationChecked=!0},i.certExpirationChecked=!1,i}(e.HealthBase);e.ClusterHealth=n;var i=function(t){function n(e){var n=t.call(this,e)||this;return n.isSfrpCluster=!1,n.isBRSEnabled=!1,n._isNetworkInventoryManagerEnabled=!1,n}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getClusterManifest(t))},n.prototype.updateInternal=function(){var e=$($.parseXML(this.raw.Manifest)),t=e.find("ClusterManifest")[0];this.clusterManifestName=t.getAttribute("Name");var n=$("Section[Name='Management'] > Parameter[Name='ImageStoreConnectionString']",t);n.length>0&&(this._imageStoreConnectionString=n.attr("Value"));var i=$("Section[Name=NetworkInventoryManager] > Parameter[Name='IsEnabled']",t);i.length>0&&(this._isNetworkInventoryManagerEnabled="true"===i.attr("Value").toLowerCase());try{var r=$("Section[Name='UpgradeService']",t);this.isSfrpCluster=r.length>0}catch(e){}try{var a=$("Section[Name='BackupRestoreService']",t);this.isBRSEnabled=a.length>0}catch(e){}},Object.defineProperty(n.prototype,"isNetworkInventoryManagerEnabled",{get:function(){return this._isNetworkInventoryManagerEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageStoreConnectionString",{get:function(){return this._imageStoreConnectionString},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.ClusterManifest=i;var r=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.decorators={hideList:["UnhealthyEvaluations"],decorators:{UpgradeDurationInMilliseconds:{displayName:function(e){return"Upgrade Duration"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}},UpgradeDomainDurationInMilliseconds:{displayName:function(e){return"Upgrade Domain Duration"},displayValueInHtml:function(t){return e.TimeUtils.getDuration(t)}}}},n.unhealthyEvaluations=[],n.upgradeDomains=[],n}return __extends(n,t),Object.defineProperty(n.prototype,"isUpgrading",{get:function(){return e.UpgradeDomainStateRegexes.InProgress.test(this.raw.UpgradeState)||this.raw.UpgradeState===e.ClusterUpgradeStates.RollingForwardPending},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"startTimestampUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.StartTimestampUtc)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"failureTimestampUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.FailureTimestampUtc)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"upgradeDuration",{get:function(){return e.TimeUtils.getDuration(this.raw.UpgradeDurationInMilliseconds)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"upgradeDomainDuration",{get:function(){return e.TimeUtils.getDuration(this.raw.UpgradeDomainDurationInMilliseconds)},enumerable:!0,configurable:!0}),n.prototype.getCompletedUpgradeDomains=function(){return _.filter(this.upgradeDomains,function(t){return t.stateName===e.UpgradeDomainStateNames.Completed}).length},n.prototype.retrieveNewData=function(t){var n=this;return this.data.$q(function(i,r){e.Utils.getHttpResponseData(n.data.restClient.getClusterUpgradeProgress(t)).then(function(t){"0.0.0.0"===t.CodeVersion?e.Utils.getHttpResponseData(n.data.restClient.getClusterVersion()).then(function(e){t.CodeVersion=e.Version}).finally(function(){i(t)}):i(t)}).catch(function(e){r(e)})})},n.prototype.updateInternal=function(){var t=this;this.unhealthyEvaluations=e.Utils.getParsedHealthEvaluations(this.raw.UnhealthyEvaluations,null,null,this.data);var n=_.map(this.raw.UpgradeDomains,function(n){return new e.UpgradeDomain(t.data,n)}),i=_.filter(n,function(t){return t.stateName===e.UpgradeDomainStateNames.Completed}).concat(_.filter(n,function(t){return t.stateName===e.UpgradeDomainStateNames.InProgress})).concat(_.filter(n,function(e){return e.name===t.raw.NextUpgradeDomain})).concat(_.filter(n,function(n){return n.stateName===e.UpgradeDomainStateNames.Pending&&n.name!==t.raw.NextUpgradeDomain}));this.upgradeDomains=i,this.raw.UpgradeDescription&&(this.upgradeDescription=new e.UpgradeDescription(this.data,this.raw.UpgradeDescription))},n}(e.DataModelBase);e.ClusterUpgradeProgress=r;var a=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadMetricInformation=[],e}return __extends(n,t),Object.defineProperty(n.prototype,"lastBalancingStartTimeUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastBalancingStartTimeUtc)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastBalancingEndTimeUtc",{get:function(){return e.TimeUtils.timestampToUTCString(this.raw.LastBalancingEndTimeUtc)},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getClusterLoadInformation(t))},n.prototype.updateInternal=function(){var t=this;e.CollectionUtils.updateDataModelCollection(this.loadMetricInformation,_.map(this.raw.LoadMetricInformation,function(n){return new e.LoadMetricInformation(t.data,n)}))},n}(e.DataModelBase);e.ClusterLoadInformation=a;var o=function(t){function n(n,i){var r=t.call(this,n,i)||this;return r.decorators={hideList:["Name"]},r.action=new e.ActionWithDialog(n.$uibModal,n.$q,"deleteBackupPolicy","Delete Backup Policy","Deleting",function(){return n.restClient.deleteBackupPolicy(r.raw.Name)},function(){return!0},{templateUrl:"partials/backupPolicy.html",controller:e.ActionController,resolve:{action:function(){return r}}},null),r.updatePolicy=new e.ActionUpdateBackupPolicy(n,i),r}return __extends(n,t),n.prototype.updateBackupPolicy=function(){this.updatePolicy.runWithCallbacks.apply(this.updatePolicy)},n.prototype.retrieveNewData=function(e){return this.data.restClient.getBackupPolicy(this.name,e).then(function(e){return e.data})},n}(e.DataModelBase);e.BackupPolicy=o}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function r(r,a,o){var s=t.call(this,r,a,o)||this;return s.parent=o,s.decorators={hideList:["IsServiceGroup"]},s.partitions=new e.PartitionCollection(s.data,s),s.health=new n(s.data,s,e.HealthStateFilterFlags.Default,e.HealthStateFilterFlags.None),s.description=new i(s.data,s),s.serviceBackupConfigurationInfoCollection=new e.ServiceBackupConfigurationInfoCollection(r,s),s.data.actionsEnabled()&&s.setUpActions(),s.data.actionsAdvancedEnabled()&&s.setAdvancedActions(),s.cleanBackup=!1,s}return __extends(r,t),Object.defineProperty(r.prototype,"isStatefulService",{get:function(){return e.ServiceKindRegexes.Stateful.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isStatelessService",{get:function(){return e.ServiceKindRegexes.Stateless.test(this.raw.ServiceKind)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"serviceKindInNumber",{get:function(){return this.raw.ServiceKind===e.Constants.ServiceKindStateful?2:1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"viewPath",{get:function(){return this.data.routes.getServiceViewPath(this.parent.raw.TypeName,this.parent.id,this.id)},enumerable:!0,configurable:!0}),r.prototype.addHealthStateFiltersForChildren=function(t){var n=this,i=this.parent.addHealthStateFiltersForChildren(t),r=_.find(i.ServiceFilters,function(e){return e.ServiceNameFilter===n.name});return r||(r={ServiceNameFilter:this.name,PartitionFilters:[]},i.ServiceFilters.push(r)),_.isEmpty(r.PartitionFilters)&&(r.PartitionFilters=[{HealthStateFilter:e.HealthStateFilterFlags.All}]),r},r.prototype.updateService=function(e){return this.data.restClient.updateService(this.parent.id,this.id,e)},r.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getService(this.parent.id,this.id,t))},r.prototype.removeAdvancedActions=function(){this.actions.collection=this.actions.collection.filter(function(e){return-1===["enableServiceBackup","disableServiceBackup","suspendServiceBackup","resumeServiceBackup"].indexOf(e.name)})},r.prototype.setUpActions=function(){var t=this;this.parent.raw.TypeName!==e.Constants.SystemAppTypeName&&(this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"deleteService","Delete Service","Deleting",function(){return t.delete()},function(){return!0},"Confirm Service Deletion","Delete service "+this.name+" from cluster "+this.data.$location.host()+"?",this.name)),this.isStatelessService&&this.actions.add(new c(this.data.$uibModal,this.data.$q,this)))},r.prototype.setAdvancedActions=function(){var t=this;this.parent.raw.TypeName===e.Constants.SystemAppTypeName||this.isStatelessService||(this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"enableServiceBackup","Enable/Update Service Backup","Enabling Service Backup",function(){return t.data.restClient.enableServiceBackup(t).then(function(){t.serviceBackupConfigurationInfoCollection.refresh()})},function(){return!0},{templateUrl:"partials/enableBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)),this.actions.add(new e.ActionWithDialog(this.data.$uibModal,this.data.$q,"disableServiceBackup","Disable Service Backup","Disabling Service Backup",function(){return t.data.restClient.disableServiceBackup(t).then(function(){t.serviceBackupConfigurationInfoCollection.refresh()})},function(){return t.serviceBackupConfigurationInfoCollection.collection.length&&t.serviceBackupConfigurationInfoCollection.collection[0].raw&&"Service"===t.serviceBackupConfigurationInfoCollection.collection[0].raw.Kind&&"Service"===t.serviceBackupConfigurationInfoCollection.collection[0].raw.PolicyInheritedFrom},{templateUrl:"partials/disableBackup.html",controller:e.ActionController,resolve:{action:function(){return t}}},null)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"suspendServiceBackup","Suspend Service Backup","Suspending...",function(){return t.data.restClient.suspendServiceBackup(t.id).then(function(){t.serviceBackupConfigurationInfoCollection.refresh()})},function(){return t.serviceBackupConfigurationInfoCollection.collection.length&&t.serviceBackupConfigurationInfoCollection.collection[0].raw&&"Service"===t.serviceBackupConfigurationInfoCollection.collection[0].raw.Kind&&"Service"===t.serviceBackupConfigurationInfoCollection.collection[0].raw.PolicyInheritedFrom&&!1===t.serviceBackupConfigurationInfoCollection.collection[0].raw.SuspensionInfo.IsSuspended},"Confirm Service Backup Suspension","Suspend service backup for "+this.name+" ?",this.name)),this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"resumeServiceBackup","Resume Service Backup","Resuming...",function(){return t.data.restClient.resumeServiceBackup(t.id).then(function(){t.serviceBackupConfigurationInfoCollection.refresh()})},function(){return t.serviceBackupConfigurationInfoCollection.collection.length&&t.serviceBackupConfigurationInfoCollection.collection[0].raw&&"Service"===t.serviceBackupConfigurationInfoCollection.collection[0].raw.Kind&&"Service"===t.serviceBackupConfigurationInfoCollection.collection[0].raw.PolicyInheritedFrom&&!0===t.serviceBackupConfigurationInfoCollection.collection[0].raw.SuspensionInfo.IsSuspended},"Confirm Service Backup Resumption","Resume service backup for "+this.name+" ?",this.name)))},r.prototype.delete=function(){return this.data.restClient.deleteService(this.parent.id,this.id)},r}(e.DataModelBase);e.Service=t;var n=function(t){function n(e,n,i,r){var a=t.call(this,e,n)||this;return a.parent=n,a.eventsHealthStateFilter=i,a.partitionsHealthStateFilter=r,a}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getServiceHealth(this.parent.parent.id,this.parent.id,this.eventsHealthStateFilter,this.partitionsHealthStateFilter,t))},n}(e.HealthBase);e.ServiceHealth=n;var i=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i.decorators={hideList:["ServiceKind","ServiceName","ServiceTypeName","HasPersistedState","IsDefaultMoveCostSpecified","Flags"],decorators:{DefaultMoveCost:{displayName:function(e){return"Move Cost"}}}},i}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getServiceDescription(this.parent.parent.id,this.parent.id,t))},n}(e.DataModelBase);e.ServiceDescription=i;var r=function(t){function n(e,n,i){var r=t.call(this,e,n,i)||this;return r.parent=i,r.manifest=new a(r.data,r),r.data.actionsEnabled()&&r.setUpActions(),r}return __extends(n,t),Object.defineProperty(n.prototype,"serviceKind",{get:function(){return this.raw.ServiceTypeDescription.IsStateful?e.Constants.ServiceKindStateful:e.Constants.ServiceKindStateless},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"serviceKindInNumber",{get:function(){return this.serviceKind===e.Constants.ServiceKindStateful?2:1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this.raw.ServiceTypeDescription.ServiceTypeName},enumerable:!0,configurable:!0}),n.prototype.createService=function(e){return e.createFromTemplate?this.data.restClient.createServiceFromTemplate(e.application.id,e.createFromTemplateDescription):this.data.restClient.createService(e.application.id,e.createDescription)},n.prototype.setUpActions=function(){this.parent instanceof e.Application&&this.actions.add(new s(this.data.$uibModal,this.data.$q,this))},n}(e.DataModelBase);e.ServiceType=r;var a=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i.packages=[],i}return __extends(n,t),n.prototype.retrieveNewData=function(e){var t=this;if(this.parent instanceof r){var n=this.parent,i=n.parent;return this.getServiceManifest(n.parent.name,i.raw.Version,n.raw.ServiceManifestName,e)}var a=this.parent;return this.data.getApp(a.parent.raw.Id,!1,e).then(function(n){return t.getServiceManifest(n.raw.TypeName,n.raw.TypeVersion,a.name,e)})},n.prototype.updateInternal=function(){var e=this,t=$($.parseXML(this.raw.Manifest)),n=t.find("CodePackage"),i=[];_.forEach(n,function(t){i.push(new o(e.data,"Code",t.getAttribute("Name"),t.getAttribute("Version")))}),
n=t.find("ConfigPackage"),_.forEach(n,function(t){i.push(new o(e.data,"Config",t.getAttribute("Name"),t.getAttribute("Version")))}),this.packages=i},n.prototype.getServiceManifest=function(t,n,i,r){return e.Utils.getHttpResponseData(this.data.restClient.getServiceManifest(t,n,i,r))},n}(e.DataModelBase);e.ServiceManifest=a;var o=function(e){function t(t,n,i,r){var a=e.call(this,t,n)||this;return a.Type=n,a.Name=i,a.Version=r,a}return __extends(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.Type+" "+this.Name+" "+this.Version},enumerable:!0,configurable:!0}),t}(e.DataModelBase);e.ServiceTypePackage=o;var s=function(t){function n(n,i,r){var a=t.call(this,n,i,"createService","Create","Creating",function(){return r.createService(a.description).then(function(){a.description&&a.description.reset()})},function(){return!0},{templateUrl:"partials/create-service-dialog.html",controller:e.ActionController,size:"lg",backdrop:"static",resolve:{action:function(){return a}}})||this;return a.serviceType=r,a.description=new l(r,r.parent),a}return __extends(n,t),n}(e.ActionWithDialog);e.ActionCreateService=s;var c=function(t){function n(n,i,r){var a=t.call(this,n,i,"scaleService","Scale Service","Scaling Service",function(){return r.updateService(a.updateServiceDescription)},function(){return r.isStatelessService},{templateUrl:"partials/scale-service-dialog.html",controller:e.ActionController,resolve:{action:function(){return a}}},function(){return r.description.ensureInitialized().then(function(){a.updateServiceDescription.InstanceCount=r.description.raw.InstanceCount})})||this;return a.updateServiceDescription={ServiceKind:r.serviceKindInNumber,Flags:1,InstanceCount:0},a}return __extends(n,t),n}(e.ActionWithDialog);e.ActionScaleService=c;var l=function(){function t(e,t){this.serviceType=e,this.application=t,this.reset()}return Object.defineProperty(t.prototype,"createDescription",{get:function(){var t=_.cloneDeep(this.raw),n=0;return null!==this.raw.ReplicaRestartWaitDurationSeconds?n^=1:delete t.ReplicaRestartWaitDurationSeconds,null!==this.raw.QuorumLossWaitDurationSeconds?n^=2:delete t.QuorumLossWaitDurationSeconds,null!==this.raw.StandByReplicaKeepDurationSeconds?n^=4:delete t.StandByReplicaKeepDurationSeconds,t.Flags=n,t.InitializationData=e.Utils.hexToBytes(this.initializationData),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"createFromTemplateDescription",{get:function(){return{ApplicationName:this.raw.ApplicationName,ServiceName:this.raw.ServiceName,ServiceTypeName:this.raw.ServiceTypeName,ServicePackageActivationMode:this.raw.ServicePackageActivationMode,InitializationData:e.Utils.hexToBytes(this.initializationData)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"servicePartitionKinds",{get:function(){return e.FabricEnumValues.ServicePartitionKinds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"servicePackageActivationModes",{get:function(){return e.FabricEnumValues.ServicePackageActivationModes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"placementPolicies",{get:function(){return e.FabricEnumValues.PlacementPolicies},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serviceCorrelationSchemes",{get:function(){return e.FabricEnumValues.ServiceCorrelationSchemes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serviceLoadMetricWeights",{get:function(){return e.FabricEnumValues.ServiceLoadMetricWeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serviceNamePattern",{get:function(){return"^"+_.escapeRegExp(this.raw.ApplicationName)+".+"},enumerable:!0,configurable:!0}),t.prototype.toggleAdvancedOptions=function(){this.createFromTemplate||(this.isAdvancedOptionCollapsed=!this.isAdvancedOptionCollapsed)},t.prototype.addName=function(){this.raw.PartitionDescription.Names.push("")},t.prototype.addPlacementPolicy=function(){this.raw.ServicePlacementPolicies.push({Type:"1"})},t.prototype.addServiceCorrelation=function(){this.raw.CorrelationScheme.push({ServiceName:"",Scheme:"1"})},t.prototype.addLoadMetric=function(){this.raw.ServiceLoadMetrics.push({Name:"",Weight:"1",PrimaryDefaultLoad:null,SecondaryDefaultLoad:null})},t.prototype.reset=function(){this.initializationData="",this.createFromTemplate=!1,this.isAdvancedOptionCollapsed=!0,this.raw={ServiceKind:this.serviceType.serviceKindInNumber,ApplicationName:this.application.name,ServiceName:this.application.name+"/"+this.serviceType.name,ServiceTypeName:this.serviceType.name,InitializationData:[],PartitionDescription:{PartitionScheme:"1",Count:1,Names:[],LowKey:"",HighKey:""},Flags:0,ReplicaRestartWaitDurationSeconds:null,QuorumLossWaitDurationSeconds:null,StandByReplicaKeepDurationSeconds:null,TargetReplicaSetSize:1,MinReplicaSetSize:1,HasPersistedState:this.serviceType.raw.ServiceTypeDescription.HasPersistedState,InstanceCount:1,PlacementConstraints:"",CorrelationScheme:[],ServiceLoadMetrics:[],ServicePlacementPolicies:[],ServicePackageActivationMode:"0",ServiceDnsName:""}},t}();e.CreateServiceDescription=l;var u=function(t){function n(n,i,r){var a=t.call(this,n,i,r)||this;return a.parent=r,a.decorators={hideList:["action.Name"]},a.action=new e.ActionWithDialog(n.$uibModal,n.$q,i.PolicyName,i.PolicyName,"Creating",function(){return a.data.restClient.deleteBackupPolicy(a.raw.PolicyName)},function(){return!0},{templateUrl:"partials/backupPolicy.html",controller:e.ActionController,resolve:{action:function(){return a.data.getBackupPolicy(a.raw.PolicyName)}}},null),a}return __extends(n,t),n}(e.DataModelBase);e.ServiceBackupConfigurationInfo=u}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,i)||this;return r.serviceTypes=new e.ServiceTypeCollection(r.data,r),r.data.actionsEnabled()&&r.setUpActions(),r}return __extends(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this.raw.Name+" "+this.raw.Version},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getAppTypeViewPath(this.name)},enumerable:!0,configurable:!0}),n.prototype.unprovision=function(){return this.data.restClient.unprovisionApplicationType(this.name,this.raw.Version)},n.prototype.createInstance=function(e){return this.data.restClient.provisionApplication(e,this.raw.Name,this.raw.Version)},n.prototype.setUpActions=function(){var t=this;this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"unprovisionAppType","Unprovision","Unprovisioning",function(){return t.unprovision()},function(){return!0},"Confirm Type Unprovision","Unprovision application type "+this.name+"@"+this.raw.Version+" from cluster "+this.data.$location.host()+"?",this.name+"@"+this.raw.Version)),this.actions.add(new i(this.data.$uibModal,this.data.$q,this))},n}(e.DataModelBase);e.ApplicationType=t;var n=function(n){function i(e,t){var i=n.call(this,e,t[0].raw)||this;return i.apps=[],i.appTypes=[],i.appTypes=t,i.data.actionsEnabled()&&i.setUpActions(),i}return __extends(i,n),Object.defineProperty(i.prototype,"viewPath",{get:function(){return this.data.routes.getAppTypeViewPath(this.name)},enumerable:!0,configurable:!0}),i.prototype.refreshAppTypeApps=function(t){var n=this;this.apps=_.filter(t.collection,function(e){return e.raw.TypeName===n.name}),this.apps.length>0?this.appsHealthState=this.valueResolver.resolveHealthStatus(_.max(_.map(this.apps,function(t){return e.HealthStateConstants.Values[t.healthState.text]}))):this.appsHealthState=e.ValueResolver.healthStatuses[1]},i.prototype.retrieveNewData=function(n){var i=this;return this.data.restClient.getApplicationTypes(this.name,n).then(function(n){return e.CollectionUtils.updateDataModelCollection(i.appTypes,_.map(n.data,function(e){return new t(i.data,e)})),_.first(n.data)})},i.prototype.setUpActions=function(){var t=this;this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"unprovisionType","Unprovision Type","Unprovisioning",function(){return t.unprovision()},function(){return!0},"Confirm Type Unprovision","Unprovision all versions of application type "+this.name+" from cluster "+this.data.$location.host()+"?",this.name))},i.prototype.unprovision=function(){var e=this;return this.data.getAppTypeGroup(this.name,!0).then(function(t){var n=[];return _.each(t.appTypes,function(e){n.push(e.unprovision())}),e.data.$q.all(n)})},i}(e.DataModelBase);e.ApplicationTypeGroup=n;var i=function(t){function n(n,i,r){var a=t.call(this,n,i,"createAppInstance","Create app instance","Creating",function(){return r.createInstance(a.newInstanceUri)},function(){return!0},{templateUrl:"partials/create-application-dialog.html",controller:e.ActionController,resolve:{action:function(){return a}}},function(){return a.newInstanceUri=e.Constants.FabricPrefix+r.name,i.when(!0)})||this;return a.appType=r,a}return __extends(n,t),Object.defineProperty(n.prototype,"typeName",{get:function(){return this.appType.raw.Name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"typeVersion",{get:function(){return this.appType.raw.Version},enumerable:!0,configurable:!0}),n}(e.ActionWithDialog);e.ActionCreateAppInstance=i}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.GetAadMetadataUriPart="/$/GetAadMetadata?api-version=1.0",e.AadAuthType="aad",e.AdalCacheType="localStorage",e}();e.AuthenticationBootstrapConstants=t;var n=function(e){function n(t){return e.call(this,null,t)||this}return __extends(n,e),Object.defineProperty(n.prototype,"metadata",{get:function(){return this.raw?this.raw.metadata:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isAadAuthType",{get:function(){return this.raw&&this.raw.type===t.AadAuthType},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.AadMetadata=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){this.raw={},this._eventProperties={}}return Object.defineProperty(t.prototype,"kind",{get:function(){return this._kind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"category",{get:function(){return this._category},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventInstanceId",{get:function(){return this._eventInstanceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeStamp",{get:function(){return this._timeStamp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeStampString",{get:function(){return e.TimeUtils.datetimeToString(this._timeStamp)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasCorrelatedEvents",{get:function(){return this._hasCorrelatedEvents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventProperties",{get:function(){return this._eventProperties},enumerable:!0,configurable:!0}),t.prototype.fillFromJSON=function(e){this.raw=e;for(var t in e)this.extractField(t,e[t])||(this.eventProperties[t]=e[t])},t.prototype.extractField=function(e,t){switch(e){case"Kind":return this._kind=t,!0;case"Category":return this._category=t,!0;case"EventInstanceId":return this._eventInstanceId=t,!0;case"TimeStamp":return this._timeStamp=t,!0;case"HasCorrelatedEvents":return this._hasCorrelatedEvents=t,!0}return!1},t}();e.FabricEventBase=t;var n=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.isSecondRowCollapsed=!0,i}return __extends(t,e),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this.raw.kind+this.raw.eventInstanceId+this.raw.timeStamp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.raw.eventInstanceId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.raw.kind+" ("+this.raw.eventInstanceId+")"},enumerable:!0,configurable:!0}),t}(e.DataModelBase);e.FabricEventInstanceModel=n;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t);e.FabricEvent=i;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t);e.ClusterEvent=r;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"nodeName",{get:function(){return this._nodeName},enumerable:!0,configurable:!0}),t.prototype.extractField=function(t,n){if(e.prototype.extractField.call(this,t,n))return!0;switch(t){case"NodeName":return this._nodeName=n,!0}return!1},t}(t);e.NodeEvent=a;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"applicationId",{get:function(){return this._applicationId},enumerable:!0,configurable:!0}),t.prototype.extractField=function(t,n){if(e.prototype.extractField.call(this,t,n))return!0;switch(t){case"ApplicationId":return this._applicationId=n,!0}return!1},t}(t);e.ApplicationEvent=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"serviceId",{get:function(){return this._serviceId},enumerable:!0,configurable:!0}),t.prototype.extractField=function(t,n){if(e.prototype.extractField.call(this,t,n))return!0;switch(t){case"ServiceId":return this._serviceId=n,!0}return!1},t}(t);e.ServiceEvent=s;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"partitionId",{get:function(){return this._partitionId},enumerable:!0,configurable:!0}),t.prototype.extractField=function(t,n){if(e.prototype.extractField.call(this,t,n))return!0;switch(t){case"PartitionId":return this._partitionId=n,!0}return!1},t}(t);e.PartitionEvent=c;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"partitionId",{get:function(){return this._partitionId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"replicaId",{get:function(){return this._replicaId},enumerable:!0,configurable:!0}),t.prototype.extractField=function(t,n){if(e.prototype.extractField.call(this,t,n))return!0;switch(t){case"PartitionId":return this._partitionId=n,!0;case"ReplicaId":return this._replicaId=n,!0}return!1},t}(t);e.ReplicaEvent=l;var u=function(){function e(e){this.eventType=e}return e.prototype.getEvents=function(e){var t=this;return e.map(function(e){var n=new t.eventType;return n.fillFromJSON(e),n})},e}();e.EventsResponseAdapter=u}(Sfx||(Sfx={}));var Sfx;!function(e){function t(e,t,n){for(var i,r=n.split(","),a="",o=0;o<r.length;o++)!function(n){var o=r[n];if(o in e.raw){var s=a+" "+e.raw[o];if(-1===_.findIndex(t,function(e){return e.id===s})){var c=_.padStart("",3*n)+e.raw[o].toString(),l={id:s,content:c,treeLevel:n+1};if(n+1<r.length&&(l.nestedGroups=[]),n>0){t[_.findIndex(t,function(e){return e.id===a})].nestedGroups.push(l.id)}t.push(l)}a=s}else n=r.length,a="";i=n}(o),o=i;return a}function n(n,r){void 0===r&&(r="");var a=new vis.DataSet,o=[];n.forEach(function(n,s){var c=t(n,o,r),l="white";if("Status"in n.eventProperties)try{var u=n.eventProperties.Status;"Ok"===u?l="green":"Warning"===u?l="orange":"Error"===u&&(l="red")}catch(e){}else e.HtmlUtils.eventTypesUtil.isResolved(n)?l="green":e.HtmlUtils.eventTypesUtil.isWarning(n)?l="orange":e.HtmlUtils.eventTypesUtil.isError(n)&&(l="red");var p={content:"",id:s,start:n.timeStamp,group:c,type:"point",title:i.tooltipFormat(n.raw,n.timeStamp),className:l+"-point",subgroup:"noStack"};if("Duration"in n.eventProperties){if("Description"in n.eventProperties)try{p.content=n.eventProperties.Description}catch(e){}try{var d=n.eventProperties.Duration,h=n.timeStamp,f=new Date(h),g=new Date(f.getTime()-d).toISOString();d<0?(p.start=h,p.end=g,p.title=i.tooltipFormat(n.raw,g,h,p.content)):(p.start=g,p.end=h,p.title=i.tooltipFormat(n.raw,h,g,p.content)),p.type="range",p.className=l,p.subgroup="stack"}catch(e){}}a.add(p)});var s=new vis.DataSet(o);return i.addSubGroups(s),{groups:s,items:a}}var i=function(){function e(){}return e.parseUpgradeAndRollback=function(t,n,i,r,a,o){var s=t.timeStamp,c=r.toISOString();if(n){c=n.timeStamp;var l=new Date(s),u=t.eventProperties.OverallUpgradeElapsedTimeInMs,p=new Date(l.getTime()-u).toISOString();i.add({id:t.eventInstanceId+"upgrade",content:"Upgrade rolling forward failed",start:p,end:c,group:a,type:"range",className:"red"})}var d="rolling back to "+t.eventProperties[o];i.add({id:t.eventInstanceId+d,content:d,start:c,end:s,group:a,type:"range",title:e.tooltipFormat(t.eventProperties,c,s),className:"orange"})},e.parseUpgradeDomain=function(t,n,i,r){var a=t.timeStamp,o=new Date(a),s=t.eventProperties.UpgradeDomainElapsedTimeInMs,c=new Date(o.getTime()-s).toISOString(),l=t.eventProperties.UpgradeDomains;n.add({id:t.eventInstanceId+l+t.eventProperties[r],content:l,start:c,end:a,group:i,type:"range",title:e.tooltipFormat(t.eventProperties,c,a),className:"green"})},e.parseUpgradeStarted=function(t,n,i,r,a){var o=i.toISOString(),s=t.timeStamp,c="Upgrading to "+t.eventProperties[a];n.add({id:t.eventInstanceId+c,content:c,start:s,end:o,group:r,type:"range",title:e.tooltipFormat(t.eventProperties,s,o),className:"blue"})},e.parseUpgradeCompleted=function(t,n,i,r){var a="ClusterUpgradeRollbackCompleted"===t.kind,o=t.timeStamp,s=new Date(o),c=t.eventProperties.OverallUpgradeElapsedTimeInMs,l=new Date(s.getTime()-c).toISOString(),u=(a?"Upgrade Rolling back":"Upgrade rolling forward")+" to "+t.eventProperties[r];n.add({id:t.eventInstanceId+u,content:u,start:l,end:o,group:i,type:"range",title:e.tooltipFormat(t.eventProperties,l,o),className:a?"orange":"green"})},e.addSubGroups=function(e){e.forEach(function(t){t.subgroupStack={stack:!0,noStack:!1},e.update(t)})},e.tooltipFormat=function(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i="");var r=Object.keys(e).map(function(t){return'<tr><td style="word-break: keep-all;">'+t+"</td><td> : "+e[t]+"</td></tr>"}).join(""),a='<table style="word-break: break-all;"><tbody>'+r+"</tbody></table>";return'<div class="tooltip-test">'+(i.length>0?i+"<br>":"")+"Start: "+t+" <br>"+(n?"End: "+n+"<br>":"")+'<b style="text-align: center;">Details</b><br>'+a+"</div>"},e}();e.EventStoreUtils=i;var r=function(){function e(){}return e.prototype.consume=function(e,t,n){throw new Error("NotImplementedError")},e.prototype.generateTimeLineData=function(e,t,n){var r=this.consume(e,t,n);return i.addSubGroups(r.groups),r},e}();e.TimeLineGeneratorBase=r;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.consume=function(e,n,r){var a,o,s,c=this,l=new vis.DataSet,u={};return e.forEach(function(e){"ClusterUpgradeStarted"!==e.kind&&"ClusterUpgradeRollbackStarted"!==e.kind||o?"ClusterUpgradeDomainCompleted"===e.kind?i.parseUpgradeDomain(e,l,t.upgradeDomainLabel,"TargetClusterVersion"):"ClusterUpgradeCompleted"===e.kind?(i.parseUpgradeCompleted(e,l,t.clusterUpgradeLabel,"TargetClusterVersion"),o=e):"ClusterNewHealthReport"===e.kind&&(c.parseSeedNodeStatus(e,l,a,r),a=e):s=e,"ClusterUpgradeRollbackCompleted"===e.kind?(o=e,u[e.eventInstanceId]={complete:e}):"ClusterUpgradeRollbackStarted"===e.kind&&e.eventInstanceId in u&&(u[e.eventInstanceId].start=e)}),Object.keys(u).forEach(function(e){var r=u[e];i.parseUpgradeAndRollback(r.complete,r.start,l,n,t.clusterUpgradeLabel,"TargetClusterVersion")}),s&&i.parseUpgradeStarted(s,l,r,t.clusterUpgradeLabel,"TargetClusterVersion"),{groups:new vis.DataSet([{id:t.upgradeDomainLabel,content:t.upgradeDomainLabel},{id:t.clusterUpgradeLabel,content:t.clusterUpgradeLabel},{id:t.seedNodeStatus,content:t.seedNodeStatus}]),items:l}},t.prototype.parseSeedNodeStatus=function(e,n,r,a){if("Warning"===e.eventProperties.HealthState){var o=r?r.timeStamp:a.toISOString(),s=""+e.eventProperties.HealthState;n.add({id:e.eventInstanceId+s,content:s,start:e.timeStamp,end:o,group:t.seedNodeStatus,type:"range",title:i.tooltipFormat(e.eventProperties,e.timeStamp,o),className:"orange"})}},t.upgradeDomainLabel="Upgrade Domains",t.clusterUpgradeLabel="Cluster Upgrades",t.seedNodeStatus="Seed Node Warnings",t}(r);e.ClusterTimelineGenerator=a;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.consume=function(e,n,r){var a=new vis.DataSet,o={},s={},c={},l=!1;return e.forEach(function(e){if("StateTransition"===e.category){if("NodeDown"===e.kind){var n=s[e.nodeName];n&&"NodeUp"!==n.kind&&(l=!0),e.nodeName in o&&delete o[e.nodeName];var u=n?n.timeStamp:r.toISOString(),p=e.timeStamp,d="Node "+e.nodeName+" down",h={id:e.eventInstanceId+d,content:d,start:p,end:u,group:t.NodesDownLabel,type:"range",title:i.tooltipFormat(e.eventProperties,p,u,d),className:"red",subgroup:"stack"};e.eventProperties.NodeInstance in c&&a.add(c[e.eventProperties.NodeInstance]),c[e.eventProperties.NodeInstance]=h}else if("NodeDeactivateCompleted"===e.kind&&"RemoveNode"===e.eventProperties.EffectiveDeactivateIntent){var f=c[e.eventProperties.NodeInstance];f&&(delete c[e.eventProperties.NodeInstance],l=!0)}"NodeUp"===e.kind&&"1601-01-01T00:00:00Z"!==e.eventProperties.LastNodeDownAt&&(s[e.nodeName]=e,o[e.nodeName]=e)}t.transitions.indexOf(e.kind)>-1&&(s[e.nodeName]=e)}),Object.keys(c).forEach(function(e){var t=c[e];a.add(t)}),Object.keys(o).forEach(function(e){var n=o[e],r="Node "+n.nodeName+" down";a.add({id:n.eventInstanceId+r,content:r,start:n.eventProperties.LastNodeDownAt,end:n.timeStamp,group:t.NodesDownLabel,type:"range",title:i.tooltipFormat(n.eventProperties,n.eventProperties.LastNodeDownAt,n.timeStamp,r),className:"red",subgroup:"stack"})}),{groups:new vis.DataSet([{id:t.NodesDownLabel,content:t.NodesDownLabel,subgroupStack:{stack:!0}}]),items:a}},t.NodesDownLabel="Node Down",t.transitions=["NodeDeactivateStarted"],t}(r);e.NodeTimelineGenerator=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.consume=function(e,n,r){var a,o,s=this,c=new vis.DataSet,l={},u={};e.forEach(function(e){"ApplicationUpgradeStarted"!==e.kind&&"ApplicationUpgradeRollbackStarted"!==e.kind||a?"ApplicationUpgradeDomainCompleted"===e.kind?i.parseUpgradeDomain(e,c,t.upgradeDomainLabel,"ApplicationTypeVersion"):"ApplicationUpgradeCompleted"===e.kind?(i.parseUpgradeCompleted(e,c,t.applicationUpgradeLabel,"ApplicationTypeVersion"),a=e):"ApplicationProcessExited"===e.kind&&s.parseApplicationProcessExited(e,c,u):o=e,"ApplicationUpgradeRollbackCompleted"===e.kind?(a=e,l[e.eventInstanceId]={complete:e}):"ApplicationUpgradeRollbackStarted"===e.kind&&e.eventInstanceId in l&&(l[e.eventInstanceId].start=e)}),Object.keys(l).forEach(function(e){var r=l[e];i.parseUpgradeAndRollback(r.complete,r.start,c,n,t.applicationUpgradeLabel,"ApplicationTypeVersion")}),o&&i.parseUpgradeStarted(o,c,r,t.applicationUpgradeLabel,"ApplicationTypeVersion");var p=new vis.DataSet([{id:t.upgradeDomainLabel,content:t.upgradeDomainLabel},{id:t.applicationUpgradeLabel,content:t.applicationUpgradeLabel}]),d={id:t.applicationPrcoessExitedLabel,nestedGroups:[],content:t.applicationPrcoessExitedLabel};return Object.keys(u).forEach(function(e){d.nestedGroups.push(e),p.add(u[e])}),p.add(d),{groups:p,items:c}},t.prototype.parseApplicationProcessExited=function(e,t,n){var r=""+e.eventProperties.ServicePackageName;n[r]={id:r,content:r};var a=e.timeStamp,o=e.eventProperties.ExeName;t.add({id:e.eventInstanceId+o,content:"",start:a,group:r,type:"point",className:"red-point",title:i.tooltipFormat(e.eventProperties,a,null,"Primary swap to "+o)})},t.upgradeDomainLabel="Upgrade Domains",t.applicationUpgradeLabel="Application Upgrades",t.applicationPrcoessExitedLabel="Application Process Exited",t}(r);e.ApplicationTimelineGenerator=s;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.consume=function(e,n,r){var a=new vis.DataSet;return e.forEach(function(e){if("StateTransition"===e.category&&"SwapPrimary"===e.eventProperties.ReconfigType){var n=e.timeStamp,r=new Date(n),o=e.eventProperties.TotalDurationMs,s=new Date(r.getTime()-o).toISOString(),c=e.eventProperties.NodeName;a.add({id:e.eventInstanceId+c,content:c,start:s,end:n,group:t.swapPrimaryLabel,type:"range",title:i.tooltipFormat(e.eventProperties,s,n,"Primary swap to "+c),className:"green"})}}),{groups:new vis.DataSet([{id:t.swapPrimaryLabel,content:t.swapPrimaryLabel}]),items:a}},t.swapPrimaryLabel="Primay Swap",t.swapPrimaryDurations="Swap Primary phases",t}(r);e.PartitionTimelineGenerator=c,e.parseEventsGenerically=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t,n){this.children=[],this.loadingChildren=!1,this.childrenLoaded=!1,this._isExpanded=!1,this._tree=e,this.owningNode=t,this.childrenQuery=n}return Object.defineProperty(t.prototype,"displayedChildren",{get:function(){var e=this.children;return this.owningNode&&this.owningNode.listSettings&&(e=_.slice(e,this.owningNode.listSettings.begin,this.owningNode.listSettings.begin+this.owningNode.listSettings.limit)),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){return!this.childrenLoaded||0!==this.children.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExpanded",{get:function(){return this._isExpanded&&this.hasChildren},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollapsed",{get:function(){return!this._isExpanded&&this.hasChildren},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeftPx",{get:function(){return this.owningNode?this.owningNode.paddingLeftPx:"45px"},enumerable:!0,configurable:!0}),t.prototype.toggle=function(){return this._isExpanded=!this._isExpanded,this._isExpanded?this.getChildren():this._tree.$q.when(!0)},t.prototype.expand=function(){return this._isExpanded=!0,this.getChildren()},t.prototype.collapse=function(){this._isExpanded=!1},t.prototype.pageDown=function(){if(this.owningNode&&this.owningNode.listSettings){var e=this.owningNode.listSettings;e.currentPage<e.pageCount&&e.currentPage++}},t.prototype.pageUp=function(){if(this.owningNode&&this.owningNode.listSettings){var e=this.owningNode.listSettings;e.currentPage>1&&e.currentPage--}},t.prototype.pageFirst=function(){if(this.owningNode&&this.owningNode.listSettings){this.owningNode.listSettings.currentPage=1}},t.prototype.pageLast=function(){if(this.owningNode&&this.owningNode.listSettings){var e=this.owningNode.listSettings;e.currentPage=e.pageCount}},t.prototype.updateHealthChunkQueryRecursively=function(e){this._isExpanded&&(this.owningNode&&this.owningNode.updateHealthChunkQueryDescription&&this.owningNode.updateHealthChunkQueryDescription(e),_.forEach(this.children,function(t){t.childGroupViewModel.updateHealthChunkQueryRecursively(e)}))},t.prototype.updateDataModelFromHealthChunkRecursively=function(e){var t=this;return this._isExpanded?this._tree.$q.when(!this.owningNode||!this.owningNode.mergeClusterHealthStateChunk||this.owningNode.mergeClusterHealthStateChunk(e)).then(function(){var n=_.map(t.children,function(t){return t.childGroupViewModel.updateDataModelFromHealthChunkRecursively(e)});return t._tree.$q.all(n)}):this._tree.$q.when(!0)},t.prototype.refreshExpandedChildrenRecursively=function(){var t=this;return this.childrenQuery&&this._isExpanded?this.childrenQuery().then(function(n){for(var i=t.children,r=0;r<i.length;r++){var a=i[r];if(a.nodeId){t.exists(n,a,function(e,t){return e.nodeId===t.nodeId})||(t._tree.selectedNode&&(a===t._tree.selectedNode||a.isParentOf(t._tree.selectedNode))&&a.parent.select(),i.splice(r,1),r--)}}for(var o=i.slice(0),r=0;r<n.length;r++){var s=n[r];if(s.nodeId){var c=t.exists(i,s,function(e,t){return e.nodeId===t.nodeId?e:null});if(c)c.update(s);else{var l=new e.TreeNodeViewModel(t._tree,s,t.owningNode),u=_.sortedIndexBy(i,l,function(e){return e.sortBy()});i.splice(u,0,l)}}}var p=[];return o.forEach(function(e){p.push(e.childGroupViewModel.refreshExpandedChildrenRecursively())}),t.owningNode&&t.owningNode.listSettings&&(t.owningNode.listSettings.count=t.children.length),t._tree.$q.all(p)}):this._tree.$q.when(!0)},t.prototype.getChildren=function(){var t=this;return!this.childrenQuery||this.childrenLoaded?this._tree.$q.when(!0):(this._currentGetChildrenPromise||(this.loadingChildren=!0,this._currentGetChildrenPromise=this.childrenQuery().then(function(n){for(var i=[],r=0;r<n.length;r++){var a=n[r];i.push(new e.TreeNodeViewModel(t._tree,a,t.owningNode))}t.children=_.sortBy(i,function(e){return e.sortBy()}),t.childrenLoaded=!0}).finally(function(){t.owningNode&&t.owningNode.listSettings&&(t.owningNode.listSettings.count=t.children.length),t._currentGetChildrenPromise=null,t.loadingChildren=!1})),this._currentGetChildrenPromise)},t.prototype.exists=function(e,t,n){for(var i=0;i<e.length;i++){var r=n(e[i],t);if(r)return r}return!1},t}();e.TreeNodeGroupViewModel=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t,n){this.selected=!1,this.canExpandAll=!1,this._keyboardSelectActionDelayInMilliseconds=200,this.parent=n,this._tree=e,this.update(t),t.startExpanded&&!this.childGroupViewModel.isExpanded&&this.toggle()}return Object.defineProperty(t.prototype,"depth",{get:function(){return this.parent?this.parent.depth+1:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeftPx",{get:function(){return this.paddingLeft+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){return this.childGroupViewModel&&this.childGroupViewModel.hasChildren},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExpanded",{get:function(){return this.childGroupViewModel.isExpanded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollapsed",{get:function(){return this.childGroupViewModel.isCollapsed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisibleByBadge",{get:function(){var t=this._node.alwaysVisible||_.isUndefined(this.badge)||_.isUndefined(this.badge())||!this.badge().badgeClass||(this.badge().badgeClass!==e.BadgeConstants.BadgeUnknown||this._tree.showOkItems)&&(this.badge().badgeClass!==e.BadgeConstants.BadgeOK||this._tree.showOkItems)&&(this.badge().badgeClass!==e.BadgeConstants.BadgeWarning||this._tree.showWarningItems)&&(this.badge().badgeClass!==e.BadgeConstants.BadgeError||this._tree.showErrorItems);return this.selected&&!t&&this._tree.selectTreeNode([e.IdGenerator.cluster()]),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allChildrenInvisibleByBadge",{get:function(){var e=this.childGroupViewModel.children;if(0===e.length)return!1;for(var t=0;t<e.length;t++)if(e[t].isVisibleByBadge)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasExpander",{get:function(){return!this.leafNode&&this.hasChildren&&!this.allChildrenInvisibleByBadge},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayHtml",{get:function(){var e=this.displayName();if(this._tree&&this._tree.searchTerm&&this._tree.searchTerm.trim()){var t=this._tree.searchTerm,n=e.toLowerCase().indexOf(t.toLowerCase());if(-1!==n)return e.substring(0,n)+"<span class='search-match'>"+e.substr(n,t.length)+"</span>"+e.substring(n+t.length)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasExpandedAndLoadedChildren",{get:function(){return this.hasChildren&&this.isExpanded&&0!==this.childGroupViewModel.children.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return 20+18*(this.depth+1)},enumerable:!0,configurable:!0}),t.prototype.update=function(t){this._node=t,this.displayName=this._node.displayName,this.leafNode=!this._node.childrenQuery,this.sortBy=t.sortBy?t.sortBy:function(){return[]},this.listSettings=this._node.listSettings,this.actions=this._node.actions,this.badge=this._node.badge,
this.updateHealthChunkQueryDescription=this._node.addHealthStateFiltersForChildren,this.mergeClusterHealthStateChunk=this._node.mergeClusterHealthStateChunk,this.childGroupViewModel?this.childGroupViewModel.childrenQuery=this._node.childrenQuery:this.childGroupViewModel=new e.TreeNodeGroupViewModel(this._tree,this,this._node.childrenQuery),this.canExpandAll=t.canExpandAll},t.prototype.toggle=function(){this.childGroupViewModel.toggle()},t.prototype.toggleAll=function(){var e=this;this.childGroupViewModel.isExpanded||this.childGroupViewModel.expand().then(function(){e.childGroupViewModel.children.forEach(function(e){e.toggleAll()})})},t.prototype.closeAll=function(){this.childGroupViewModel.isExpanded&&(this.childGroupViewModel.children.forEach(function(e){e.closeAll()}),this.childGroupViewModel.collapse())},t.prototype.contextMenuToggled=function(t){t&&e.HtmlUtils.repositionContextMenu()},t.prototype.handleClick=function(){this.select()},t.prototype.select=function(e,t){var n=this;this._tree.selectNode(this)&&this._node.selectAction&&!t&&setTimeout(function(){n.selected&&n._node.selectAction()},0|e)},Object.defineProperty(t.prototype,"nodeId",{get:function(){return this._node.nodeId},enumerable:!0,configurable:!0}),t.prototype.selectNext=function(e){this.hasExpandedAndLoadedChildren?this.childGroupViewModel.displayedChildren[0].select(this._keyboardSelectActionDelayInMilliseconds):this.selectNextSibling()},t.prototype.selectPrevious=function(e){var t=this.getParentsChildren(),n=t.indexOf(this);0===n&&this.parent?this.parent.select(this._keyboardSelectActionDelayInMilliseconds):0!==n&&t[n-1].selectLast()},t.prototype.expandOrMoveToChild=function(){this.hasChildren&&(this.isCollapsed?this.toggle():this.selectNext())},t.prototype.collapseOrMoveToParent=function(){this.hasChildren&&this.isExpanded?this.toggle():this.parent&&this.parent.select(this._keyboardSelectActionDelayInMilliseconds)},t.prototype.isParentOf=function(e){for(var t=e.parent;t&&t!==this;)t=t.parent;return t===this},t.prototype.selectNextSibling=function(){var e=this.getParentsChildren(),t=e.indexOf(this);return t===e.length-1&&this.parent?this.parent.selectNextSibling():t!==e.length-1&&e[t+1].select(this._keyboardSelectActionDelayInMilliseconds),t},t.prototype.getParentsChildren=function(){return this.parent?this.parent.childGroupViewModel.displayedChildren:this._tree.childGroupViewModel.displayedChildren},t.prototype.selectLast=function(){if(this.hasExpandedAndLoadedChildren){this.childGroupViewModel.displayedChildren[this.childGroupViewModel.displayedChildren.length-1].selectLast()}else this.select(this._keyboardSelectActionDelayInMilliseconds)},t}();e.TreeNodeViewModel=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t){this.$q=e,this.showOkItems=!0,this.showWarningItems=!0,this.showErrorItems=!0,this.searchTerm="",this.firstTreeSelect=!0,this._selectTreeNodeOpId=1,this._childrenQuery=t,this.refreshChildren()}return Object.defineProperty(t.prototype,"isLoading",{get:function(){return!this.childGroupViewModel||0===this.childGroupViewModel.children.length&&this.childGroupViewModel.loadingChildren},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.childGroupViewModel&&!this.childGroupViewModel.children.length},enumerable:!0,configurable:!0}),t.prototype.refreshChildren=function(){this.childGroupViewModel=new e.TreeNodeGroupViewModel(this,null,this._childrenQuery),this.childGroupViewModel.isCollapsed&&this.childGroupViewModel.toggle()},t.prototype.selectNode=function(e){return this.selectedNode!==e&&(this.selectedNode&&(this.selectedNode.selected=!1),e&&(e.selected=!0),this.selectedNode=e,!0)},t.prototype.onKeyDown=function(e){var t=this.selectedNode;switch(e.which){case 40:this.selectedNode.selectNext();break;case 38:this.selectedNode.selectPrevious();break;case 39:this.selectedNode.expandOrMoveToChild();break;case 37:this.selectedNode.collapseOrMoveToParent()}t!==this.selectedNode&&e.preventDefault()},t.prototype.refresh=function(){return this.childGroupViewModel.refreshExpandedChildrenRecursively()},t.prototype.selectTreeNode=function(e,t){this._selectTreeNodeOpId++;var n=this._selectTreeNodeOpId;return this.selectTreeNodeInternal(e,0,this.childGroupViewModel,n,t)},t.prototype.addHealthChunkFiltersRecursively=function(e){return this.childGroupViewModel.updateHealthChunkQueryRecursively(e),e},t.prototype.mergeClusterHealthStateChunk=function(e){return this.childGroupViewModel.updateDataModelFromHealthChunkRecursively(e)},t.prototype.selectTreeNodeInternal=function(e,t,n,i,r){var a=this;return n.expand().then(function(){if(i===a._selectTreeNodeOpId){for(var o=null,s=n.children,c=0;c<s.length;c++)if(s[c].nodeId===e[t]){o=s[c];break}if(o){if(o.parent&&o.parent.listSettings){var l=s.indexOf(o);l>=0&&o.parent.listSettings.setPageWithIndex(l)}t===e.length-1?o.selected||o.select(0,r):a.selectTreeNodeInternal(e,t+1,o.childGroupViewModel,i,r)}}})},t}();e.TreeViewModel=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t,n,i,r,a){void 0===n&&(n=[]),this.title=e,this.titleInSingular=t,this.dataPoints=n,this.largeTile=i,this.routes=r,this.count=0,this.viewPath=a,this.count=_.reduce(n,function(e,t){return e+t.count},0),this.adjustCount()}return t.fromHealthStateCount=function(i,r,a,o,s,c){var l=[];return l.push(new n("Error",o.ErrorCount,e.ValueResolver.healthStatuses[3])),l.push(new n("Warning",o.WarningCount,e.ValueResolver.healthStatuses[2])),l.push(new n("Healthy",o.OkCount,e.ValueResolver.healthStatuses[1])),new t(i,r,l,a,s,c)},Object.defineProperty(t.prototype,"displayTitle",{get:function(){return 1===this.count?this.titleInSingular:this.title},enumerable:!0,configurable:!0}),t.prototype.getDataPointTooltip=function(e){return e.title+": "+(e.count/this.count*100).toFixed(1)+"%"},t.prototype.onClick=function(){var e=this;this.viewPath&&this.routes&&this.routes.navigate(function(){return e.viewPath})},t.prototype.adjustCount=function(){var e=this;_.forEach(this.dataPoints,function(t){0===t.count?t.adjustedCount=0:t.adjustedCount=Math.max(.02*e.count,t.count)})},t}();e.DashboardViewModel=t;var n=function(){function e(e,t,n){this.title=e,this.count=t,this.state=n,this.adjustedCount=0}return e}();e.DashboardDataPointViewModel=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t){this.clusterLoadInformation=e,this.nodesLoadInformation=t,this._showResourceGovernanceMetrics=!0,this._showLoadMetrics=!0,this._showSystemMetrics=!1,this._normalizeMetricsData=!0,this.refreshToken=0,this.isExpanderEnabled=!1,this.isFullScreen=!1,this._metrics=null,this.legendColorPalette=d3.scale.ordinal().range(["#71b252","#ff8418","#FCB714","#903F8B","#3f5fb6","#79D7F2","#B5B5B5","#8c564b"]),this.metricsWithCapacities.length>0?this.metricsWithCapacities[0].selected=!0:this.metricsWithoutCapacities.length>0?this.metricsWithoutCapacities[0].selected=!0:this.systemMetrics.length>0&&(this.showSystemMetrics=!0,this.systemMetrics[0].selected=!0)}return t.ensureResourceGovernanceMetrics=function(t){var n=!1,i=!1,r=_.map(t,function(e){return"servicefabric:/_CpuCores"===e.name?n=!0:"servicefabric:/_MemoryInMB"===e.name&&(i=!0),e});if(!n){var a=new e.LoadMetricInformation(null,{Name:"servicefabric:/_CpuCores",IsBalancedBefore:!0,IsBalancedAfter:!0,DeviationBefore:"",DeviationAfter:"",BalancingThreshold:"",Action:"",ActivityThreshold:"",ClusterCapacity:0,ClusterLoad:0,CurrentClusterLoad:0,RemainingUnbufferedCapacity:0,NodeBufferPercentage:0,BufferedCapacity:0,RemainingBufferedCapacity:0,IsClusterCapacityViolation:!1,MinNodeLoadValue:0,MinNodeLoadId:null,MaxNodeLoadValue:0,MaxNodeLoadId:null});r.unshift(a)}if(!i){var o=new e.LoadMetricInformation(null,{Name:"servicefabric:/_MemoryInMB",IsBalancedBefore:!0,IsBalancedAfter:!0,DeviationBefore:"",DeviationAfter:"",BalancingThreshold:"",Action:"",ActivityThreshold:"",ClusterCapacity:0,ClusterLoad:0,CurrentClusterLoad:0,RemainingUnbufferedCapacity:0,NodeBufferPercentage:0,BufferedCapacity:0,RemainingBufferedCapacity:0,IsClusterCapacityViolation:!1,MinNodeLoadValue:0,MinNodeLoadId:null,MaxNodeLoadValue:0,MaxNodeLoadId:null});r.unshift(o)}return r},Object.defineProperty(t.prototype,"filteredNodeLoadInformation",{get:function(){var e=this;return this.selectedMetrics.length>0?_.first(this.selectedMetrics).hasCapacity?_.filter(this.nodesLoadInformation,function(t){return t.isInitialized&&_.some(t.nodeLoadMetricInformation,function(t){return _.some(e.selectedMetrics,function(e){return e.name===t.name&&(-1!=+t.raw.NodeCapacity||+t.raw.NodeLoad>0)})})}):_.filter(this.nodesLoadInformation,function(e){return e.isInitialized}):[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metrics",{get:function(){return null==this._metrics&&(this._metrics=t.ensureResourceGovernanceMetrics(this.clusterLoadInformation.loadMetricInformation)),this._metrics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredMetrics",{get:function(){var e=this;return _.filter(this.metrics,function(t){return t.isSystemMetric?e.showSystemMetrics:t.isResourceGovernanceMetric?e.showResourceGovernanceMetrics:e.showLoadMetrics})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metricsWithCapacities",{get:function(){return _.filter(this.metrics,function(e){return!e.isSystemMetric&&e.hasCapacity})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metricsWithoutCapacities",{get:function(){return _.filter(this.metrics,function(e){return!e.isSystemMetric&&!e.hasCapacity})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"systemMetrics",{get:function(){return _.filter(this.metrics,function(e){return e.isSystemMetric})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedMetrics",{get:function(){return _.filter(this.metrics,function(e){return e.selected})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showResourceGovernanceMetrics",{get:function(){return this._showResourceGovernanceMetrics},set:function(e){this._showResourceGovernanceMetrics=e,e||this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showLoadMetrics",{get:function(){return this._showLoadMetrics},set:function(e){this._showLoadMetrics=e,e||this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSystemMetrics",{get:function(){return this._showSystemMetrics},set:function(e){this._showSystemMetrics=e,e||(this.selectedMetrics.forEach(function(e){e.isSystemMetric&&(e.selected=!1)}),this.refresh())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalizeMetricsData",{get:function(){return this._normalizeMetricsData},set:function(e){this._normalizeMetricsData=e,this.refresh()},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){this.refreshToken=(this.refreshToken+1)%1e4,this._metrics=null},t.prototype.getLegendColor=function(e){return this.legendColorPalette(e)},t.prototype.toggleMetric=function(e){this.metrics.forEach(function(e){return e.selected=!1}),e.selected=!0,this.refresh()},t.prototype.toggleFullScreen=function(e){this.isFullScreen!==e&&(this.isFullScreen=e,this.refresh())},t}();e.MetricsViewModel=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e){this.$q=e,this.firstPageLoad=!0,this.currentControllers=[]}return e.prototype.registerMainController=function(e){this.currentControllers=[],this.registerController(e)},e.prototype.registerController=function(e){this.currentControllers.push(e)},e.prototype.refreshCurrentControllers=function(e){var t=[];return $.each(this.currentControllers,function(n,i){t.push(i.refresh(e))}),this.$q.all(t)},e}();e.ControllerManagerService=t,function(){angular.module("controllerManagerService",[]).factory("controllerManager",["$q",function(e){return new t(e)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t,n){var i=this;if(this.$rootScope=t,this.$location=n,this.response=function(t){return null!==t.headers(e.Constants.SfxReadonlyHeaderName)&&(i.$rootScope[e.Constants.SfxReadonlyMetadataName]="1"===t.headers(e.Constants.SfxReadonlyHeaderName)),null!==t.headers(e.Constants.SfxClusterNameHeaderName)&&(i.$rootScope[e.Constants.SfxClusterNameMetadataName]=t.headers(e.Constants.SfxClusterNameHeaderName)),t},void 0===this.$rootScope[e.Constants.SfxClusterNameMetadataName])if(e.StandaloneIntegration.isStandalone()){var r=new URL(e.StandaloneIntegration.clusterUrl);this.$rootScope[e.Constants.SfxClusterNameMetadataName]=r.protocol+"//"+r.hostname}else this.$rootScope[e.Constants.SfxClusterNameMetadataName]=this.$location.protocol()+"://"+this.$location.host()}return t}();e.ResponseHeadersService=t,function(){var e=angular.module("responseHeadersService",[]);e.factory("responseHeaders",["$rootScope","$location",function(e,n){return new t(e,n)}]),e.config(["$httpProvider",function(e){e.interceptors.push("responseHeaders")}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e,t,n,i,r){var a=this;this.$rootScope=t,this.clusterTree=n,this.refreshSvc=i,this.authenticationData=r,this.isApplicationBootstrapped=!1,this.needAadAuthentication&&(this.adalAuthenticationService=e.get("adalAuthenticationService")),this.needAadAuthentication&&!this.isAadAuthenticated?(t.$on("adal:loginSuccess",function(){a.bootstrapApplication()}),t.$on("adal:acquireTokenSuccess",function(){a.bootstrapApplication()}),t.$on("adal:loginFailure",function(){}),t.$on("adal:notAuthorized",function(){})):this.bootstrapApplication()}return Object.defineProperty(e.prototype,"needAadAuthentication",{get:function(){return this.authenticationData&&this.authenticationData.isAadAuthType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAadAuthenticated",{get:function(){return this.$rootScope.userInfo&&this.$rootScope.userInfo.isAuthenticated},enumerable:!0,configurable:!0}),e.prototype.logOut=function(){this.adalAuthenticationService&&this.adalAuthenticationService.logOut()},e.prototype.bootstrapApplication=function(){this.clusterTree.init(),this.refreshSvc.init(),this.isApplicationBootstrapped=!0,this.refreshSvc.refreshAll()},e}();e.AuthenticationService=t,function(){angular.module("authenticationService",[]).factory("auth",["$injector","$rootScope","clusterTree","refresh","authenticationData",function(e,n,i,r,a){return new t(e,n,i,r,a)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t,n,i,r,a,o,s){this.$rootScope=e,this.$interval=t,this.$q=n,this.$timeout=i,this.controllerManager=r,this.storage=a,this.clusterTree=o,this.data=s,this.isRefreshing=!1,this.autoRefreshInterval=null,this.previousRefreshSetting=0}return t.prototype.init=function(){var t=this,n=this.storage.getValueNumber(e.Constants.AutoRefreshIntervalStorageKey,e.Constants.DefaultAutoRefreshInterval);this.updateRefreshInterval(e.Constants.AutoRefreshIntervalStorageKey,n.toString(),!0),this.storage.subscribe(function(e,n,i){return t.updateRefreshInterval(e,i)})},t.prototype.refreshAll=function(){var e=this;if(!this.isRefreshing){this.data.invalidateBrowserRestResponseCache();var t=Date.now();this.isRefreshing=!0,this.$q.all([this.clusterTree.refresh(),this.controllerManager.refreshCurrentControllers(),this.data.clusterUpgradeProgress.refresh()]).finally(function(){var n=Math.max(1e3-(Date.now()-t),0);e.$timeout(function(){e.isRefreshing=!1},n)})}},t.prototype.updateRefreshInterval=function(t,n,i){var r=this;if(void 0===i&&(i=!1),t===e.Constants.AutoRefreshIntervalStorageKey){this.autoRefreshInterval&&(this.$interval.cancel(this.autoRefreshInterval),this.autoRefreshInterval=null);var a=parseInt(n,10);0===a||(this.autoRefreshInterval=this.$interval(function(){return r.refreshAll()},1e3*a),!i&&(0===this.previousRefreshSetting||a<this.previousRefreshSetting)&&this.refreshAll()),this.previousRefreshSetting=a}},t}();e.RefreshService=t,function(){angular.module("refreshService",["clusterTreeService","dataService","storageService","controllerManagerService"]).factory("refresh",["$rootScope","$interval","$q","$timeout","controllerManager","storage","clusterTree","data",function(e,n,i,r,a,o,s,c){return new t(e,n,i,r,a,o,s,c)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t,n){this.$q=t,this.$http=n,e.StandaloneIntegration.isStandalone()&&(this.httpClient=e.StandaloneIntegration.getHttpClient(),this.httpClient.then(function(t){return t.setRequestTemplateAsync({method:void 0,url:void 0,headers:[{name:e.Constants.SfxVersionMetadataName,value:e.VersionInfo.Version},{name:e.Constants.SfxBuildMetadataName,value:e.VersionInfo.Build},{name:e.Constants.SfxTelemetryMetadataName,value:e.Constants.SfxTelemetryHeaderValue}]})})),this.$http.defaults.headers.common[e.Constants.SfxVersionMetadataName]=e.VersionInfo.Version,this.$http.defaults.headers.common[e.Constants.SfxBuildMetadataName]=e.VersionInfo.Build,this.$http.defaults.headers.common[e.Constants.SfxTelemetryMetadataName]=e.Constants.SfxTelemetryHeaderValue}return t.prototype.getAsync=function(e){return this.httpClient?this.requestAsync({method:"GET",url:e}):this.$http.get(e)},t.prototype.postAsync=function(e,t){return this.httpClient?this.requestAsync({method:"POST",url:e,body:t}):this.$http.post(e,t)},t.prototype.putAsync=function(e,t){return this.httpClient?this.requestAsync({method:"PUT",url:e,body:t}):this.$http.put(e,t)},t.prototype.patchAsync=function(e,t){return this.httpClient?this.requestAsync({method:"PATCH",url:e,body:t}):this.$http.patch(e,t)},t.prototype.deleteAsync=function(e){return this.httpClient?this.requestAsync({method:"DELETE",url:e}):this.$http.delete(e)},t.prototype.requestAsync=function(e){var t=this;return this.$q(function(n,i){t.httpClient.then(function(t){return t.requestAsync(e)}).then(function(e){return n({data:e.data,status:e.statusCode,statusText:e.statusMessage,headers:void 0,config:void 0,xhrStatus:void 0})},function(e){return i(e)})})},t}();e.HttpClient=t,function(){angular.module("httpService",[]).factory("httpClient",["$q","$http",function(e,n){return new t(e,n)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t){var n=this;this.httpClient=e,this.message=t,this.cacheAllowanceToken=Date.now().valueOf(),this.requestCount=0,this.requestStarted=[],this.requestEnded=[],this.allRequestsComplete=[],this.registerRequestEndedCallback(function(e){0===e&&($.each(n.allRequestsComplete,function(e,t){return t()}),n.allRequestsComplete=[])})}return t.prototype.invalidateBrowserRestResponseCache=function(){this.cacheAllowanceToken=Date.now().valueOf()},t.prototype.registerRequestStartedCallback=function(e){return this.requestStarted.push(e),this},t.prototype.registerRequestEndedCallback=function(e){return this.requestEnded.push(e),this},t.prototype.registerAllRequestsCompleteCallback=function(e){0===this.requestCount?e():this.allRequestsComplete.push(e)},t.prototype.getClusterHealth=function(t,n,i,r){void 0===t&&(t=e.HealthStateFilterFlags.Default),void 0===n&&(n=e.HealthStateFilterFlags.Default),void 0===i&&(i=e.HealthStateFilterFlags.Default);var a="$/GetClusterHealth?NodesHealthStateFilter="+n+"&ApplicationsHealthStateFilter="+i+"&EventsHealthStateFilter="+t;return this.get(this.getApiUrl(a),"Get cluster health",r)},t.prototype.getClusterManifest=function(e){return this.get(this.getApiUrl("$/GetClusterManifest"),"Get cluster manifest",e)},t.prototype.getClusterUpgradeProgress=function(e){return this.get(this.getApiUrl("$/GetUpgradeProgress"),"Get cluster upgrade progress",e)},t.prototype.getClusterLoadInformation=function(e){return this.get(this.getApiUrl("$/GetLoadInformation"),"Get cluster load information",e)},t.prototype.getClusterHealthChunk=function(e,t){return this.post(this.getApiUrl("$/GetClusterHealthChunk"),"Get cluster health chunk",e,t)},t.prototype.createNetwork=function(e,n,i){var r="Resources/Networks/"+encodeURIComponent(e),a={name:e,properties:{kind:"Local",networkAddressPrefix:n}};return this.put(this.getApiUrl(r,t.apiVersion64),'Creating isolated network "'+e+'" succeeded',a,i)},t.prototype.getNetwork=function(e,n){var i="Resources/Networks/"+encodeURIComponent(e)+"/";return this.get(this.getApiUrl(i,t.apiVersion64),"Get network",n)},t.prototype.getNetworks=function(e){return this.getFullCollection("Resources/Networks/","Get networks",t.apiVersion64)},t.prototype.deleteNetwork=function(e,n){var i="Resources/Networks/"+encodeURIComponent(e);return this.delete(this.getApiUrl(i,t.apiVersion64),'Network "'+e+'" deleted',n)},t.prototype.getNetworksOnApp=function(e,n){var i="Applications/"+encodeURIComponent(e)+"/$/GetNetworks";return this.getFullCollection(i,"Get networks attached to a application",t.apiVersion60)},t.prototype.getNetworksOnNode=function(e,n){var i="Nodes/"+encodeURIComponent(e)+"/$/GetNetworks";return this.getFullCollection(i,"Get networks deployed on a node",t.apiVersion60)},t.prototype.getAppsOnNetwork=function(e,n){var i="Resources/Networks/"+encodeURIComponent(e)+"/ApplicationRefs";return this.getFullCollection(i,"Get applications using current network",t.apiVersion64)},t.prototype.getNodesOnNetwork=function(e,n){var i="Resources/Networks/"+encodeURIComponent(e)+"/DeployedNodes";return this.getFullCollection(i,"Get nodes, current network is deployed on",t.apiVersion64)},t.prototype.getDeployedContainersOnNetwork=function(e,n,i){var r="Nodes/"+encodeURIComponent(n)+"/$/GetNetworks/"+encodeURIComponent(e)+"/$/GetCodePackages";return this.getFullCollection(r,"Get containers on network",t.apiVersion60)},t.prototype.getNodes=function(e){return this.getFullCollection("Nodes/","Get nodes")},t.prototype.getNode=function(e,t){var n="Nodes/"+encodeURIComponent(e)+"/";return this.get(this.getApiUrl(n),"Get node",t)},t.prototype.getBackupPolicies=function(e){return this.getFullCollection("BackupRestore/BackupPolicies/","Get backup Policies",t.apiVersion64)},t.prototype.getApplicationBackupConfigurationInfoCollection=function(e,n){return this.getFullCollection("Applications/"+encodeURIComponent(e)+"/$/GetBackupConfigurationInfo","Gets the application backup configuration information",t.apiVersion64,n)},t.prototype.getServiceBackupConfigurationInfoCollection=function(e,n){return this.getFullCollection("Services/"+encodeURIComponent(e)+"/$/GetBackupConfigurationInfo","Gets the application backup configuration information",t.apiVersion64,n)},t.prototype.getPartitionBackupProgress=function(e,n){return this.get(this.getApiUrl("Partitions/"+encodeURIComponent(e)+"/$/GetBackupProgress",t.apiVersion64),"Gets the partition backup progress",n)},t.prototype.getPartitionRestoreProgress=function(e,n){return this.get(this.getApiUrl("Partitions/"+encodeURIComponent(e)+"/$/GetRestoreProgress",t.apiVersion64),"Gets the partition restore progress",n)},t.prototype.getPartitionBackupConfigurationInfo=function(e,n){return this.get(this.getApiUrl("Partitions/"+encodeURIComponent(e)+"/$/GetBackupConfigurationInfo",t.apiVersion64),"Gets the partition backup configuration information",n)},t.prototype.getLatestPartitionBackup=function(e,n){return this.getFullCollection2("Partitions/"+encodeURIComponent(e)+"/$/GetBackups","Gets the latest partition backup",t.apiVersion64,n,void 0,void 0,void 0,void 0,!0)},t.prototype.getPartitionBackupList=function(e,n,i,r,a){return this.getFullCollection2("Partitions/"+encodeURIComponent(e)+"/$/GetBackups","Gets the partition backup list",t.apiVersion64,n,void 0,i,r,a)},t.prototype.getBackupPolicy=function(e,n){var i="BackupRestore/BackupPolicies/"+encodeURIComponent(e)+"/";return this.get(this.getApiUrl(i,t.apiVersion64),"Get backup policy",n)},t.prototype.getNodeHealth=function(t,n,i){void 0===n&&(n=e.HealthStateFilterFlags.Default);var r="Nodes/"+encodeURIComponent(t)+"/$/GetHealth?EventsHealthStateFilter="+n;return this.get(this.getApiUrl(r),"Get node health",i)},t.prototype.getNodeLoadInformation=function(e,t){var n="Nodes/"+encodeURIComponent(e)+"/$/GetLoadInformation";return this.get(this.getApiUrl(n),"Get node load information",t)},t.prototype.restartNode=function(e,t,n){var i="Nodes/"+encodeURIComponent(e)+"/$/Restart",r={NodeInstanceId:t};return this.post(this.getApiUrl(i),"Node restart",r,n)},t.prototype.getDeployedApplications=function(e,t){var n="Nodes/"+encodeURIComponent(e)+"/$/GetApplications";return this.get(this.getApiUrl(n),"Get applications",t)},t.prototype.getDeployedApplication=function(e,t,n){var i="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t);return this.get(this.getApiUrl(i),"Get deployed applications",n)},t.prototype.getDeployedApplicationHealth=function(t,n,i,r,a){void 0===i&&(i=e.HealthStateFilterFlags.Default),void 0===r&&(r=e.HealthStateFilterFlags.Default);var o="Nodes/"+encodeURIComponent(t)+"/$/GetApplications/"+encodeURIComponent(n)+"/$/GetHealth?EventsHealthStateFilter="+i+"&DeployedServicePackagesHealthStateFilter="+r;return this.get(this.getApiUrl(o),"Get application health",a)},t.prototype.getDeployedServicePackages=function(e,t,n){var i="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetServicePackages";return this.get(this.getApiUrl(i),"Get deployed service packages",n)},t.prototype.getDeployedServicePackage=function(e,t,n,i){var r="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetServicePackages/"+encodeURIComponent(n);return this.get(this.getApiUrl(r),"Get deployed service package on application",i)},t.prototype.getDeployedServicePackageHealth=function(t,n,i,r,a,o){void 0===a&&(a=e.HealthStateFilterFlags.Default);var s="Nodes/"+encodeURIComponent(t)+"/$/GetApplications/"+encodeURIComponent(n)+"/$/GetServicePackages/"+encodeURI(i)+"/$/GetHealth?EventsHealthStateFilter="+a+(r?"&ServicePackageActivationId="+r:"");return this.get(this.getApiUrl(s),"Get deployed service package health",o)},t.prototype.getServiceManifest=function(e,t,n,i){var r="ApplicationTypes/"+encodeURIComponent(e)+"/$/GetServiceManifest",a=this.getApiUrl(r)+"&ApplicationTypeVersion="+encodeURIComponent(t)+"&ServiceManifestName="+encodeURIComponent(n);return this.get(a,"Get service manifest for application type",i)},t.prototype.getServiceTypes=function(e,t,n){var i="ApplicationTypes/"+encodeURIComponent(e)+"/$/GetServiceTypes?ApplicationTypeVersion="+encodeURIComponent(t),r=this.getApiUrl(i)+"&ApplicationTypeVersion="+encodeURIComponent(t);return this.get(r,"Get service types for application type",n)},t.prototype.getDeployedReplicas=function(e,t,n,i){var r="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetReplicas",a=this.getApiUrl(r)+"&ServiceManifestName="+encodeURIComponent(n);return this.get(a,"Get replicas on service",i)},t.prototype.getDeployedCodePackages=function(e,t,n,i){var r="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetCodePackages",a=this.getApiUrl(r)+"&ServiceManifestName="+encodeURIComponent(n);return this.get(a,"Get deployed code packages",i)},t.prototype.getDeployedCodePackage=function(e,t,n,i,r){var a="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetCodePackages",o=this.getApiUrl(a)+"&ServiceManifestName="+encodeURIComponent(n)+"&CodePackageName="+encodeURIComponent(i);return this.get(o,"Get deployed code package",r)},t.prototype.getDeployedContainerLogs=function(e,t,n,i,r,a,o){var s="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetCodePackages/$/ContainerLogs",c=this.getApiUrl(s)+"&ServiceManifestName="+encodeURIComponent(n)+"&CodePackageName="+encodeURIComponent(i)+"&ServicePackageActivationId="+encodeURIComponent(r)+"&Tail="+encodeURIComponent(a);return this.get(c,"Get deployed container logs",o)},t.prototype.restartCodePackage=function(e,t,n,i,r,a,o){var s="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetCodePackages/$/Restart",c={ServiceManifestName:n,CodePackageName:i,CodePackageInstanceId:r};return a&&(c.ServicePackageActivationId=a),this.post(this.getApiUrl(s),"Code package restart",c,o)},t.prototype.getDeployedReplica=function(e,t,n,i,r){var a="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetReplicas",o=this.getApiUrl(a)+"&PartitionId="+encodeURIComponent(i)+"&ServiceManifestName="+encodeURIComponent(n);return this.get(o,"Get deployed replica",r)},t.prototype.getDeployedReplicaDetail=function(e,t,n,i){var r="Nodes/"+encodeURIComponent(e)+"/$/GetPartitions/"+encodeURIComponent(t)+"/$/GetReplicas/"+encodeURIComponent(n)+"/$/GetDetail";return this.get(this.getApiUrl(r),"Get deployed replica detail",i)},t.prototype.getApplicationTypes=function(e,t){return e?this.get(this.getApiUrl("ApplicationTypes/"+encodeURIComponent(e)),"Get application type"):this.get(this.getApiUrl("ApplicationTypes/"),"Get application types",t)},t.prototype.getApplicationManifestForApplicationType=function(e,t,n){var i="ApplicationTypes/"+encodeURIComponent(e)+"/$/GetApplicationManifest?ApplicationTypeVersion="+encodeURIComponent(t);return this.get(this.getApiUrl(i),"Get application manifest for application type")},t.prototype.provisionApplication=function(e,t,n,i){var r={Name:e,TypeName:t,TypeVersion:n};return this.post(this.getApiUrl("Applications/$/Create"),"Application instance creation",r,i)},t.prototype.activateNode=function(e,t){var n="Nodes/"+encodeURIComponent(e)+"/$/Activate";return this.post(this.getApiUrl(n),"Node Activation",null,t)},t.prototype.deactivateNode=function(e,t,n){var i="Nodes/"+encodeURIComponent(e)+"/$/Deactivate";return this.post(this.getApiUrl(i),"Node deactivation",{DeactivationIntent:t},n)},t.prototype.removeNodeState=function(e,t){var n="Nodes/"+encodeURIComponent(e)+"/$/RemoveNodeState";return this.post(this.getApiUrl(n),"Node state removal",null,t)},t.prototype.getApplications=function(e){return this.getFullCollection("Applications/","Get applications",null,e)},t.prototype.getServices=function(e,t){var n="Applications/"+encodeURIComponent(e)+"/$/GetServices";return this.getFullCollection(n,"Get services",null,t)},t.prototype.getService=function(e,t,n){var i="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t);return this.get(this.getApiUrl(i),"Get service",n)},t.prototype.createService=function(e,t,n){var i="Applications/"+encodeURIComponent(e)+"/$/GetServices/$/Create";return this.post(this.getApiUrl(i),"Service creation",t,n)},t.prototype.createServiceFromTemplate=function(e,t,n){var i="Applications/"+encodeURIComponent(e)+"/$/GetServices/$/CreateFromTemplate";return this.post(this.getApiUrl(i),"Service creation",t,n)},t.prototype.updateService=function(e,t,n,i){var r="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/Update";return this.post(this.getApiUrl(r),"Service update",n,i)},t.prototype.enableApplicationBackup=function(e,n){var i="Applications/"+encodeURIComponent(e.id)+"/$/EnableBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Enable Application Backup",{BackupPolicyName:e.backupPolicyName},n)},t.prototype.disableApplicationBackup=function(e,n){var i="Applications/"+encodeURIComponent(e.id)+"/$/DisableBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Disable Application Backup",{CleanBackup:e.cleanBackup},n)},t.prototype.enableServiceBackup=function(e,n){var i="Services/"+encodeURIComponent(e.id)+"/$/EnableBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Enable Service Backup",{BackupPolicyName:e.backupPolicyName},n)},t.prototype.disableServiceBackup=function(e,n){var i="Services/"+encodeURIComponent(e.id)+"/$/DisableBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Disable Service Backup",{CleanBackup:e.cleanBackup},n)},t.prototype.enablePartitionBackup=function(e,n){var i="Partitions/"+encodeURIComponent(e.id)+"/$/EnableBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Enable Service Backup",{BackupPolicyName:e.partitionBackupInfo.backupPolicyName},n)},t.prototype.disablePartitionBackup=function(e,n){
var i="Partitions/"+encodeURIComponent(e.id)+"/$/DisableBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Disable Service Backup",{CleanBackup:e.partitionBackupInfo.cleanBackup},n)},t.prototype.suspendApplicationBackup=function(e,n){var i="Applications/"+encodeURIComponent(e)+"/$/SuspendBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Suspend Application Backup",null,n)},t.prototype.resumeApplicationBackup=function(e,n){var i="Applications/"+encodeURIComponent(e)+"/$/ResumeBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Resume Application Backup",null,n)},t.prototype.suspendServiceBackup=function(e,n){var i="Services/"+encodeURIComponent(e)+"/$/SuspendBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Suspend Service Backup",null,n)},t.prototype.resumeServiceBackup=function(e,n){var i="Services/"+encodeURIComponent(e)+"/$/ResumeBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Resume Service Backup",null,n)},t.prototype.suspendPartitionBackup=function(e,n){var i="Partitions/"+encodeURIComponent(e)+"/$/SuspendBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Suspend Partition Backup",null,n)},t.prototype.resumePartitionBackup=function(e,n){var i="Partitions/"+encodeURIComponent(e)+"/$/ResumeBackup";return this.post(this.getApiUrl(i,t.apiVersion64),"Resume Partition Backup",null,n)},t.prototype.deleteBackupPolicy=function(e,n){var i="BackupRestore/BackupPolicies/"+encodeURIComponent(e)+"/$/Delete";return this.post(this.getApiUrl(i,t.apiVersion64),"Backup Policy deletion",null,n)},t.prototype.updateBackupPolicy=function(e,n){var i="BackupRestore/BackupPolicies/"+encodeURIComponent(e.Name)+"/$/Update";return this.post(this.getApiUrl(i,t.apiVersion64),"Backup Policy updation",e,n)},t.prototype.createBackupPolicy=function(e,n){return this.post(this.getApiUrl("BackupRestore/BackupPolicies/$/Create",t.apiVersion64),"Backup Policy creation",e,n)},t.prototype.triggerPartitionBackup=function(e,n){var i="Partitions/"+encodeURIComponent(e.id)+"/$/Backup";return e.partitionBackupInfo.BackupTimeout&&(i+="?BackupTimeout="+e.partitionBackupInfo.BackupTimeout.toString()),this.post(this.getApiUrl(i,t.apiVersion64),"Partition Backup trigger",{BackupStorage:e.partitionBackupInfo.storage},n)},t.prototype.restorePartitionBackup=function(e,n){var i="Partitions/"+encodeURIComponent(e.id)+"/$/Restore";return e.partitionBackupInfo.RestoreTimeout&&(i+="?RestoreTimeout="+e.partitionBackupInfo.RestoreTimeout.toString()),this.post(this.getApiUrl(i,t.apiVersion64),"Partition Backup restore",{BackupId:e.partitionBackupInfo.backupId,BackupStorage:e.partitionBackupInfo.storage,BackupLocation:e.partitionBackupInfo.backupLocation},n)},t.prototype.getServiceDescription=function(e,t,n){var i="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/GetDescription";return this.get(this.getApiUrl(i),"Get service description",n)},t.prototype.getServiceHealth=function(t,n,i,r,a){void 0===i&&(i=e.HealthStateFilterFlags.Default),void 0===r&&(r=e.HealthStateFilterFlags.Default);var o="Applications/"+encodeURIComponent(t)+"/$/GetServices/"+encodeURIComponent(n)+"/$/GetHealth?EventsHealthStateFilter="+i+"&PartitionsHealthStateFilter="+r;return this.get(this.getApiUrl(o),"Get service health",a)},t.prototype.deleteService=function(e,t,n){var i="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/Delete";return this.post(this.getApiUrl(i),"Service deletion",null,n)},t.prototype.unprovisionApplicationType=function(e,t,n){var i="ApplicationTypes/"+encodeURIComponent(e)+"/$/Unprovision";return this.post(this.getApiUrl(i),"Application type unprovision",{ApplicationTypeVersion:t},n)},t.prototype.getApplication=function(e,t){var n="Applications/"+encodeURIComponent(e)+"/";return this.get(this.getApiUrl(n),"Get application",t)},t.prototype.getApplicationHealth=function(t,n,i,r,a){void 0===n&&(n=e.HealthStateFilterFlags.Default),void 0===i&&(i=e.HealthStateFilterFlags.Default),void 0===r&&(r=e.HealthStateFilterFlags.Default);var o="Applications/"+encodeURIComponent(t)+"/$/GetHealth?EventsHealthStateFilter="+n+"&DeployedApplicationsHealthStateFilter="+r+"&ServicesHealthStateFilter="+i;return this.get(this.getApiUrl(o),"Get application health",a)},t.prototype.getApplicationUpgradeProgress=function(e,t){var n="Applications/"+encodeURIComponent(e)+"/$/GetUpgradeProgress";return this.get(this.getApiUrl(n),"Get application upgrade progress",t)},t.prototype.deleteApplication=function(e,t){var n="Applications/"+encodeURIComponent(e)+"/$/Delete";return this.post(this.getApiUrl(n),"Application deletion",null,t)},t.prototype.createComposeDeployment=function(e,n){return this.put(this.getApiUrl("ComposeDeployments/$/Create",t.apiVersion60),"Compose application creation",e,n)},t.prototype.deleteComposeApplication=function(e,n){var i="ComposeDeployments/"+encodeURIComponent(e)+"/$/Delete";return this.post(this.getApiUrl(i,t.apiVersion40),"Compose application deletion",null,n)},t.prototype.getPartitions=function(e,t,n){var i="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/GetPartitions";return this.getFullCollection(i,"Get partitions",null,n)},t.prototype.getPartition=function(e,t,n,i){var r="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/GetPartitions/"+encodeURIComponent(n);return this.get(this.getApiUrl(r),"Get partition",i)},t.prototype.getPartitionById=function(e,n){var i="Partitions/"+encodeURIComponent(e);return this.get(this.getApiUrl(i,t.apiVersion60),"Get partition by id",n)},t.prototype.getPartitionHealth=function(t,n,i,r,a,o){void 0===r&&(r=e.HealthStateFilterFlags.Default),void 0===a&&(a=e.HealthStateFilterFlags.Default);var s="Applications/"+encodeURIComponent(t)+"/$/GetServices/"+encodeURIComponent(n)+"/$/GetPartitions/"+encodeURIComponent(i)+"/$/GetHealth?EventsHealthStateFilter="+r+"&ReplicasHealthStateFilter="+a;return this.get(this.getApiUrl(s),"Get partition health",o)},t.prototype.getPartitionLoadInformation=function(e,t,n,i){var r="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/GetPartitions/"+encodeURIComponent(n)+"/$/GetLoadInformation";return this.get(this.getApiUrl(r),"Get partition load information",i)},t.prototype.getReplicasOnPartition=function(e,t,n,i){var r="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/GetPartitions/"+encodeURIComponent(n)+"/$/GetReplicas";return this.getFullCollection(r,"Get replicas on partition",null,i)},t.prototype.getReplicaOnPartition=function(e,t,n,i,r){var a="Applications/"+encodeURIComponent(e)+"/$/GetServices/"+encodeURIComponent(t)+"/$/GetPartitions/"+encodeURIComponent(n)+"/$/GetReplicas/"+encodeURIComponent(i);return this.get(this.getApiUrl(a),"Get replica on partition",r)},t.prototype.getReplicaHealth=function(t,n,i,r,a,o){void 0===a&&(a=e.HealthStateFilterFlags.Default);var s="Applications/"+encodeURIComponent(t)+"/$/GetServices/"+encodeURIComponent(n)+"/$/GetPartitions/"+encodeURIComponent(i)+"/$/GetReplicas/"+encodeURIComponent(r)+"/$/GetHealth?EventsHealthStateFilter="+a;return this.get(this.getApiUrl(s),"Get replica health",o)},t.prototype.getReplicasOnNode=function(e,t,n){var i="Nodes/"+encodeURIComponent(e)+"/$/GetApplications/"+encodeURIComponent(t)+"/$/GetReplicas";return this.get(this.getApiUrl(i),"Get replicas on node",n)},t.prototype.deleteReplica=function(e,t,n,i,r){var a="Nodes/"+encodeURIComponent(e)+"/$/GetPartitions/"+encodeURIComponent(t)+"/$/GetReplicas/"+encodeURIComponent(n)+"/$/Delete";return i&&(a+="?ForceRemove=true"),this.post(this.getApiUrl(a),"Replica deletion",null,r)},t.prototype.getImageStoreContent=function(e,n){var i=e?"ImageStore/"+e:"ImageStore";return i+="?timeout=300",this.get(this.getApiUrl(i,t.apiVersion60),"Get Image Store content",n)},t.prototype.deleteImageStoreContent=function(e,n){return this.delete(this.getApiUrl("ImageStore/"+e,t.apiVersion60),"Delete Image Store content",n)},t.prototype.getImageStoreFolderSize=function(e,n){var i=(e?"ImageStore/"+e:"ImageStore")+"/$/FolderSize";return i+="?timeout=300",this.get(this.getApiUrl(i,t.apiVersion65),"Get Image Store Folder Size",n)},t.prototype.getClusterEvents=function(t,n,i){return this.getEvents(e.ClusterEvent,"EventsStore/Cluster/Events",t,n,i)},t.prototype.getNodeEvents=function(t,n,i,r){var a="EventsStore/Nodes/"+(i?encodeURIComponent(i)+"/$/":"")+"Events";return this.getEvents(e.NodeEvent,a,t,n,r)},t.prototype.getApplicationEvents=function(t,n,i,r){var a="EventsStore/Applications/"+(i?encodeURIComponent(i)+"/$/":"")+"Events";return this.getEvents(e.ApplicationEvent,a,t,n,r)},t.prototype.getServiceEvents=function(t,n,i,r){var a="EventsStore/Services/"+(i?encodeURIComponent(i)+"/$/":"")+"Events";return this.getEvents(e.ServiceEvent,a,t,n,r)},t.prototype.getPartitionEvents=function(t,n,i,r){var a="EventsStore/Partitions/"+(i?encodeURIComponent(i)+"/$/":"")+"Events";return this.getEvents(e.PartitionEvent,a,t,n,r)},t.prototype.getReplicaEvents=function(t,n,i,r,a){var o="EventsStore/Partitions/"+encodeURIComponent(i)+"/$/Replicas/"+(r?encodeURIComponent(r)+"/$/":"")+"Events";return this.getEvents(e.ReplicaEvent,o,t,n,a)},t.prototype.getCorrelatedEvents=function(t,n){var i="EventsStore/CorrelatedEvents/"+encodeURIComponent(t)+"/$/Events";return this.getEvents(e.FabricEvent,i,null,null,n)},t.prototype.restartReplica=function(e,n,i,r){var a="Nodes/"+e+"/$/GetPartitions/"+n+"/$/GetReplicas/"+i+"/$/Restart";return this.post(this.getApiUrl(a,t.apiVersion60),"Restart replica",null,r)},t.prototype.getClusterVersion=function(e){return this.get(this.getApiUrl("$/GetClusterVersion",t.apiVersion64),"Get cluster version",e)},t.prototype.getEvents=function(n,i,r,a,o){var s=i;r&&a&&(s=s+"?starttimeutc="+r.toISOString().substr(0,19)+"Z&endtimeutc="+a.toISOString().substr(0,19)+"Z");var c=this.getApiUrl(s,t.apiVersion72,null,!0);return this.get(c,null,o).then(function(t){return new e.EventsResponseAdapter(n).getEvents(t.data)})},t.prototype.getApiUrl=function(n,i,r,a){return void 0===i&&(i=t.defaultApiVersion),e.StandaloneIntegration.clusterUrl+"/"+n+(-1===n.indexOf("?")?"?":"&")+"api-version="+(i||t.defaultApiVersion)+(!0===a?"":"&_cacheToken="+this.cacheAllowanceToken)+(r?"&ContinuationToken="+r:"")},t.prototype.getApiUrl2=function(e,n,i,r,a,o,s,c){return void 0===n&&(n=t.defaultApiVersion),this.getApiUrl(e,n,i,!1)+(void 0===s||null===s?"":"&MaxResults="+s)+(void 0===a||null===a||void 0===o||null===o?"":"&StartDateTimeFilter="+a.toISOString().substr(0,19)+"Z&EndDateTimeFilter="+o.toISOString().substr(0,19)+"Z")+(!0===c?"&Latest=True":"")},t.prototype.getFullCollection=function(e,t,n,i,r){var a=this,o=this.getApiUrl(e,n,r,!1);return this.get(o,t,i).then(function(r){return r.data.ContinuationToken?a.getFullCollection(e,t,n,i,r.data.ContinuationToken).then(function(e){return _.union(r.data.Items,e)}):r.data.Items}).catch(function(e){return[]})},t.prototype.getFullCollection2=function(e,t,n,i,r,a,o,s,c){var l=this,u=this.getApiUrl2(e,n,r,!1,a,o,s,c);return this.get(u,t,i).then(function(r){return r.data.ContinuationToken?l.getFullCollection(e,t,n,i,r.data.ContinuationToken).then(function(e){return _.union(r.data.Items,e)}):r.data.Items}).catch(function(e){return[]})},t.prototype.get=function(t,n,i){var r=this,a=this.wrapInCallbacks(function(){return r.httpClient.getAsync(t)});return i||(i=e.ResponseMessageHandlers.getResponseMessageHandler),this.handleResponse(n,a,i),a},t.prototype.post=function(t,n,i,r){var a=this,o=this.wrapInCallbacks(function(){return a.httpClient.postAsync(t,i)});return r||(r=e.ResponseMessageHandlers.postResponseMessageHandler),this.handleResponse(n,o,r),o},t.prototype.put=function(t,n,i,r){var a=this,o=this.wrapInCallbacks(function(){return a.httpClient.putAsync(t,i)});return r||(r=e.ResponseMessageHandlers.putResponseMessageHandler),this.handleResponse(n,o,r),o},t.prototype.delete=function(t,n,i){var r=this,a=this.wrapInCallbacks(function(){return r.httpClient.deleteAsync(t)});return i||(i=e.ResponseMessageHandlers.deleteResponseMessageHandler),this.handleResponse(n,a,i),a},t.prototype.handleResponse=function(t,n,i){var r=this;n.then(function(n){var a=i.getSuccessMessage(t,n);a&&r.message.showMessage(a,e.MessageSeverity.Info)},function(n){var a=i.getErrorMessage(t,n);a&&r.message.showMessage(a,e.MessageSeverity.Err)})},t.prototype.wrapInCallbacks=function(e){var t=this;this.requestCount++;var n=e();return n.finally(function(){t.requestCount--}),n},t.defaultApiVersion="3.0",t.apiVersion40="4.0",t.apiVersion60="6.0",t.apiVersion62Preview="6.2-preview",t.apiVersion64="6.4",t.apiVersion65="6.5",t.apiVersion72="7.2",t}();e.RestClient=t,function(){angular.module("restClientService",["messages","httpService"]).factory("restClient",["httpClient","message",function(e,n){return new t(e,n)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t,n,i,r,a,o,s,c,l,u,p,d,h){this.routes=t,this.message=n,this.telemetry=i,this.$location=r,this.restClient=a,this.warnings=o,this.storage=s,this.$q=c,this.$timeout=l,this.$uibModal=u,this.$route=p,this.$sanitize=d,this.$rootScope=h,this.systemApp=new e.SystemApplication(this),this.clusterManifest=new e.ClusterManifest(this),this.clusterUpgradeProgress=new e.ClusterUpgradeProgress(this),this.clusterLoadInformation=new e.ClusterLoadInformation(this),this.appTypeGroups=new e.ApplicationTypeGroupCollection(this),this.apps=new e.ApplicationCollection(this),this.nodes=new e.NodeCollection(this),this.imageStore=new e.ImageStore(this),this.networks=new e.NetworkCollection(this),this.backupPolicies=new e.BackupPolicyCollection(this)}return t.prototype.actionsEnabled=function(){return!0!==this.$rootScope[e.Constants.SfxReadonlyMetadataName]},t.prototype.actionsAdvancedEnabled=function(){return this.actionsEnabled()&&this.storage.getValueBoolean(e.Constants.AdvancedModeKey,!1)},t.prototype.invalidateBrowserRestResponseCache=function(){this.restClient.invalidateBrowserRestResponseCache()},t.prototype.getClusterHealth=function(t,n,i){return void 0===t&&(t=e.HealthStateFilterFlags.Default),void 0===n&&(n=e.HealthStateFilterFlags.Default),void 0===i&&(i=e.HealthStateFilterFlags.Default),new e.ClusterHealth(this,t,n,i)},t.prototype.getClusterManifest=function(e,t){return void 0===e&&(e=!1),this.clusterManifest.ensureInitialized(e,t)},t.prototype.getClusterUpgradeProgress=function(e,t){return void 0===e&&(e=!1),this.clusterUpgradeProgress.ensureInitialized(e,t)},t.prototype.getClusterLoadInformation=function(e,t){return void 0===e&&(e=!1),this.clusterLoadInformation.ensureInitialized(e,t)},t.prototype.getClusterHealthChunk=function(t){var n=this;return this.restClient.getClusterHealthChunk(t,e.ResponseMessageHandlers.silentResponseMessageHandler).then(function(e){return n.preprocessHealthChunkData(e.data)})},t.prototype.getInitialClusterHealthChunkQueryDescription=function(){return{ApplicationFilters:[{HealthStateFilter:e.HealthStateFilterFlags.All}],NodeFilters:[{HealthStateFilter:e.HealthStateFilterFlags.All}]}},t.prototype.getSystemApp=function(e,t){return this.systemApp.ensureInitialized(e,t)},t.prototype.getSystemServices=function(e,t){return this.getSystemApp(!1,t).then(function(n){return n.services.ensureInitialized(e,t)})},t.prototype.getApps=function(e,t){return this.apps.ensureInitialized(e,t)},t.prototype.getApp=function(e,t,n){var i=this;return this.getApps(!1,n).then(function(r){return i.tryGetValidItem(r,e,t,n)})},t.prototype.getNodes=function(e,t){return this.nodes.ensureInitialized(e,t)},t.prototype.getNode=function(e,t,n){var i=this;return this.getNodes(!1,n).then(function(r){return i.tryGetValidItem(r,e,t,n)})},t.prototype.getBackupPolicies=function(e,t){return this.backupPolicies.ensureInitialized(e,t)},t.prototype.getBackupPolicy=function(e,t,n){var i=this;return this.getBackupPolicies(!1,n).then(function(r){return i.tryGetValidItem(r,e,t,n)})},t.prototype.getNetwork=function(e,t,n){var i=this;return this.getNetworks(!1,n).then(function(r){return i.tryGetValidItem(r,e,t,n)})},t.prototype.getNetworks=function(e,t){return this.networks.ensureInitialized(e,t)},t.prototype.getAppTypeGroups=function(e,t){return this.appTypeGroups.ensureInitialized(e,t)},t.prototype.getAppTypeGroup=function(e,t,n){var i=this;return this.getAppTypeGroups(!1,n).then(function(r){return i.tryGetValidItem(r,e,t,n)})},t.prototype.getAppType=function(e,t,n,i){return this.getAppTypeGroup(e,!1,i).then(function(e){return _.filter(e.appTypes,function(e){return e.raw.Version===t})[0]})},t.prototype.getServiceTypes=function(e,t,n,i){return this.getAppType(e,t,!1,i).then(function(e){return e.serviceTypes.ensureInitialized(n,i)})},t.prototype.getServiceType=function(e,t,n,i,r){var a=this;return this.getServiceTypes(e,t,!1,r).then(function(e){return a.tryGetValidItem(e,n,i,r)})},t.prototype.getServices=function(t,n,i){return(t===e.Constants.SystemAppId?this.getSystemApp(!1,i):this.getApp(t,!1,i)).then(function(e){return e.services.ensureInitialized(n,i)})},t.prototype.getService=function(t,n,i,r){var a=this;return this.getServices(t,!1,r).then(function(t){return a.tryGetValidItem(t,e.IdGenerator.service(n),i,r)})},t.prototype.getPartitions=function(e,t,n,i){return this.getService(e,t,!1,i).then(function(e){return e.partitions.ensureInitialized(n,i)})},t.prototype.getPartition=function(t,n,i,r,a){var o=this;return this.getPartitions(t,n,!1,a).then(function(t){return o.tryGetValidItem(t,e.IdGenerator.partition(i),r,a)})},t.prototype.getReplicasOnPartition=function(e,t,n,i,r){return this.getPartition(e,t,n,!1,r).then(function(e){return e.replicas.ensureInitialized(i,r)})},t.prototype.getReplicaOnPartition=function(t,n,i,r,a,o){var s=this;return this.getReplicasOnPartition(t,n,i,!1,o).then(function(t){return s.tryGetValidItem(t,e.IdGenerator.replica(r),a,o)})},t.prototype.getDeployedApplications=function(e,t,n){return this.getNode(e,!1,n).then(function(e){return e.deployedApps.ensureInitialized(t,n)})},t.prototype.getDeployedApplication=function(t,n,i,r){var a=this;return this.getDeployedApplications(t,!1,r).then(function(t){return a.tryGetValidItem(t,e.IdGenerator.app(n),i,r)})},t.prototype.getDeployedServicePackages=function(e,t,n,i){return this.getDeployedApplication(e,t,!1,i).then(function(e){return e.deployedServicePackages.ensureInitialized(n,i)})},t.prototype.getDeployedServicePackage=function(t,n,i,r,a,o){var s=this;return this.getDeployedServicePackages(t,n,!1,o).then(function(t){return s.tryGetValidItem(t,e.IdGenerator.deployedServicePackage(i,r),a,o)})},t.prototype.getDeployedCodePackages=function(e,t,n,i,r,a){return this.getDeployedServicePackage(e,t,n,i,!1,a).then(function(e){return e.deployedCodePackages.ensureInitialized(r,a)})},t.prototype.getDeployedCodePackage=function(t,n,i,r,a,o,s){var c=this;return this.getDeployedCodePackages(t,n,i,r,!1,s).then(function(t){return c.tryGetValidItem(t,e.IdGenerator.deployedCodePackage(a),o,s)})},t.prototype.getDeployedReplicas=function(e,t,n,i,r,a){return this.getDeployedServicePackage(e,t,n,i,!1,a).then(function(e){return e.deployedReplicas.ensureInitialized(r,a)})},t.prototype.getDeployedReplica=function(t,n,i,r,a,o,s){var c=this;return this.getDeployedReplicas(t,n,i,r,!1,s).then(function(t){return c.tryGetValidItem(t,e.IdGenerator.deployedReplica(a),o,s)})},t.prototype.createClusterEventList=function(){return new e.ClusterEventList(this)},t.prototype.createNodeEventList=function(t){return new e.NodeEventList(this,t)},t.prototype.createApplicationEventList=function(t){return new e.ApplicationEventList(this,t)},t.prototype.createServiceEventList=function(t){return new e.ServiceEventList(this,t)},t.prototype.createPartitionEventList=function(t){return new e.PartitionEventList(this,t)},t.prototype.createReplicaEventList=function(t,n){return new e.ReplicaEventList(this,t,n)},t.prototype.createCorrelatedEventList=function(t){return new e.CorrelatedEventList(this,t)},t.prototype.tryGetValidItem=function(e,t,n,i){var r=e.find(t);return r?r.ensureInitialized(n,i):this.$q.reject()},t.prototype.preprocessHealthChunkData=function(t){t.SystemApplicationHealthStateChunk=_.first(_.remove(t.ApplicationHealthStateChunks.Items,function(t){return t.ApplicationName===e.Constants.SystemAppName}));var n=[];_.forEach(t.ApplicationHealthStateChunks.Items,function(e){return _.forEach(e.DeployedApplicationHealthStateChunks.Items,function(t){t.ApplicationName=e.ApplicationName,n.push(t)})});var i=_.groupBy(n,function(e){return e.NodeName});return _.forEach(i,function(e,n){var i=_.find(t.NodeHealthStateChunks.Items,function(e){return e.NodeName===n});i&&(i.DeployedApplicationHealthStateChunks={Items:e,TotalCount:e.length})}),_.forEach(t.NodeHealthStateChunks.Items,function(e){e.DeployedApplicationHealthStateChunks||(e.DeployedApplicationHealthStateChunks={Items:[],TotalCount:0})}),t},t}();e.DataService=t,function(){var n=angular.module("dataService",["routes","messages","ui.bootstrap","ngSanitize","restClientService","StatusWarningService","storageService"]);n.factory("data",["routes","message","telemetry","$location","restClient","warnings","storage","$q","$timeout","$uibModal","$route","$sanitize","$rootScope",function(e,n,i,r,a,o,s,c,l,u,p,d,h){return new t(e,n,i,r,a,o,s,c,l,u,p,d,h)}]),n.run(["$rootScope","data",function(t,n){t.$on("$routeChangeSuccess",function(e,t,i){n.invalidateBrowserRestResponseCache()}),t.SfxVersion=e.VersionInfo.Version,t.SfxBuild=e.VersionInfo.Build,t.ShowPreviewWarning=e.VersionInfo.IsPreview}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){}return e.prototype.registerMessageReceiver=function(e){return this.messageReceiver=e,this},e.prototype.showMessage=function(e,t,n){this.messageReceiver&&this.messageReceiver.showMessage(e,t,n)},e}();e.MessageService=t;var n=function(){function e(e,t){this.$interval=t,this.messages=[],e.registerMessageReceiver(this)}return e.prototype.showMessage=function(e,t,n){for(var i=this,r=0;r<this.messages.length;r++)if(this.messages[r].message===e)return;var a=1e4|n;this.messages.push({message:e,severity:t,removeTimeout:this.$interval(function(){return i.removeMsg(e)},a,1)})},e.prototype.removeMsg=function(e){for(var t=0;t<this.messages.length;t++)if(this.messages[t].message===e)return this.$interval.cancel(this.messages[t].removeTimeout),void this.messages.splice(t,1)},e}();e.MessageController=n;!function(e){e[e.Info=0]="Info",e[e.Warn=1]="Warn",e[e.Err=2]="Err"}(e.MessageSeverity||(e.MessageSeverity={})),function(){var e=angular.module("messages",[]);e.factory("message",function(){return new t}),e.controller("MessageController",["message","$interval",n])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getValueNumber=function(e,t){return this.getValueT(e,function(e){return Number(e)},t)},t.prototype.getValueString=function(e,t){return this.getValueT(e,function(e){return e},t)},t.prototype.getValueBoolean=function(e,t){return this.getValueT(e,function(e){return"true"===e},t)},t.prototype.getValueT=function(e,t,n){var i=localStorage.getItem(e);return i?t(i):n},t.prototype.clear=function(e){this.isDefined(e)&&localStorage.removeItem(e)},t.prototype.isDefined=function(e){return!!localStorage.getItem(e)},t.prototype.setValue=function(e,t){var n=localStorage.getItem(e)||"";n!==t.toString()&&(localStorage.setItem(e,t.toString()),this.notify(e,n,t.toString()))},t}(e.Observable);e.StorageService=t,function(){angular.module("storageService",[]).factory("storage",function(){return new t})}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e,t){this.$interval=e,this.$location=t,this._forceSingleEncode=!1}return e.prototype.navigate=function(e){var t,n=this;try{this.forceSingleEncode(!0),t=e()}finally{this.forceSingleEncode(!1)}this.$interval(function(){n.$location.path(t.substring(1))},0,1)},e.prototype.getTabViewPath=function(e,t){return _.trimEnd(e,"/")+"/tab/"+t},e.prototype.getClusterViewPath=function(){return"#/"},e.prototype.getNodesViewPath=function(){return"#/nodes"},e.prototype.getSystemAppsViewPath=function(){return"#/system/apps"},e.prototype.getAppsViewPath=function(){return"#/apps"},e.prototype.getAppTypesViewPath=function(){return"#/appTypes"},e.prototype.getNodeViewPath=function(e){return"#/node/"+this.doubleEncode(e)},e.prototype.getNetworksViewPath=function(){return"#/networks"},e.prototype.getNetworkViewPath=function(e){return"#/network/"+this.doubleEncode(e)},e.prototype.getDeployedAppViewPath=function(e,t){return"#/node/"+this.doubleEncode(e)+"/deployedapp/"+this.doubleEncode(t)},e.prototype.getDeployedServiceViewPath=function(e,t,n,i){return"#/node/"+this.doubleEncode(e)+"/deployedapp/"+this.doubleEncode(t)+"/deployedservice/"+this.doubleEncode(n)+(i?"/activationid/"+this.doubleEncode(i):"")},e.prototype.getDeployedReplicasViewPath=function(e,t,n,i){return"#/node/"+this.doubleEncode(e)+"/deployedapp/"+this.doubleEncode(t)+"/deployedservice/"+this.doubleEncode(n)+(i?"/activationid/"+this.doubleEncode(i):"")+"/replicas/"},e.prototype.getDeployedCodePackagesViewPath=function(e,t,n,i){return"#/node/"+this.doubleEncode(e)+"/deployedapp/"+this.doubleEncode(t)+"/deployedservice/"+this.doubleEncode(n)+(i?"/activationid/"+this.doubleEncode(i):"")+"/codepackages/"},e.prototype.getDeployedReplicaViewPath=function(e,t,n,i,r,a){return"#/node/"+this.doubleEncode(e)+"/deployedapp/"+this.doubleEncode(t)+"/deployedservice/"+this.doubleEncode(n)+(i?"/activationid/"+this.doubleEncode(i):"")+"/partition/"+this.doubleEncode(r)+"/replica/"+this.doubleEncode(a)},e.prototype.getCodePackageViewPath=function(e,t,n,i,r){return"#/node/"+this.doubleEncode(e)+"/deployedapp/"+this.doubleEncode(t)+"/deployedservice/"+this.doubleEncode(n)+(i?"/activationid/"+this.doubleEncode(i):"")+"/codepackage/"+this.doubleEncode(r)},e.prototype.getAppTypeViewPath=function(e){return"#/apptype/"+this.doubleEncode(e)},e.prototype.getAppViewPath=function(e,t){return"#/apptype/"+this.doubleEncode(e)+"/app/"+this.doubleEncode(t)},e.prototype.getServiceViewPath=function(e,t,n){return"#/apptype/"+this.doubleEncode(e)+"/app/"+this.doubleEncode(t)+"/service/"+this.doubleEncode(n)},e.prototype.getPartitionViewPath=function(e,t,n,i){return"#/apptype/"+this.doubleEncode(e)+"/app/"+this.doubleEncode(t)+"/service/"+this.doubleEncode(n)+"/partition/"+this.doubleEncode(i)},e.prototype.getReplicaViewPath=function(e,t,n,i,r){return"#/apptype/"+this.doubleEncode(e)+"/app/"+this.doubleEncode(t)+"/service/"+this.doubleEncode(n)+"/partition/"+this.doubleEncode(i)+"/replica/"+this.doubleEncode(r)},e.prototype.doubleEncode=function(e){return this._forceSingleEncode?encodeURIComponent(e):encodeURIComponent(encodeURIComponent(e))},e.prototype.forceSingleEncode=function(e){this._forceSingleEncode=e},e}();e.RoutesService=t,function(){function e(e,t,n){n.reloadOnSearch=!1,n.requireADLogin=!0,_.isArray(t)||(t=[t]),_.each(t,function(t){e.when(t,n).when(_.trimEnd(t,"/")+"/tab/:tabId",n)})}var n=angular.module("routes",["ngRoute"]);n.factory("routes",["$interval","$location",function(e,n){return new t(e,n)}]),n.config(["$routeProvider","$httpProvider",function(t,n){e(t,"/",{templateUrl:"partials/cluster.html",controller:"ClusterViewController",controllerAs:"clusterCtrl"}),e(t,"/apps",{templateUrl:"partials/apps.html",controller:"AppsViewController",controllerAs:"appsCtrl"}),e(t,"/system/apps",{templateUrl:"partials/system-apps.html",controller:"SystemAppsViewController",controllerAs:"systemAppsCtrl"}),e(t,"/nodes",{templateUrl:"partials/nodes.html",controller:"NodesViewController",controllerAs:"nodesCtrl"}),e(t,"/node/:nodeName",{templateUrl:"partials/node.html",controller:"NodeViewController",controllerAs:"nodeCtrl"}),e(t,"/node/:nodeName/deployedapp/:appId",{templateUrl:"partials/deployed-app.html",controller:"DeployedAppViewController",controllerAs:"deployedAppCtrl"}),e(t,"/networks",{templateUrl:"partials/networks.html",controller:"NetworksViewController",controllerAs:"networksCtrl"}),e(t,"/network/:networkName",{templateUrl:"partials/network.html",controller:"NetworkViewController",controllerAs:"networkCtrl"}),e(t,["/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId","/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/activationid/:activationId"],{templateUrl:"partials/deployed-service-package.html",controller:"DeployedServiceViewController",controllerAs:"deployedServicePackageCtrl"}),e(t,["/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/codepackages","/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/activationid/:activationId/codepackages"],{templateUrl:"partials/deployed-code-packages.html",controller:"DeployedServiceCodePackagesViewController",controllerAs:"deployedCodePackagesCtrl"}),e(t,["/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/replicas","/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/activationid/:activationId/replicas"],{templateUrl:"partials/deployed-replicas.html",controller:"DeployedServiceReplicasViewController",controllerAs:"deployedReplicasCtrl"}),e(t,["/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/partition/:partitionId/replica/:replicaId","/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/activationid/:activationId/partition/:partitionId/replica/:replicaId"],{templateUrl:"partials/deployed-replica.html",controller:"DeployedReplicaViewController",controllerAs:"deployedReplicaCtrl"}),e(t,["/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/codepackage/:codePackageName","/node/:nodeName/deployedapp/:appId/deployedservice/:serviceId/activationid/:activationId/codepackage/:codePackageName"],{templateUrl:"partials/deployed-code-package.html",controller:"DeployedCodePackageViewController",controllerAs:"codePackageCtrl"}),e(t,"/apptype/:appTypeName",{templateUrl:"partials/app-type.html",controller:"AppTypeViewController",controllerAs:"appTypeCtrl"}),e(t,"/apptype/:appTypeName/app/:appId",{templateUrl:"partials/app.html",controller:"AppViewController",controllerAs:"appCtrl"}),e(t,"/apptype/:appTypeName/app/:appId/service/:serviceId",{templateUrl:"partials/service.html",controller:"ServiceViewController",controllerAs:"serviceCtrl"}),e(t,"/apptype/:appTypeName/app/:appId/service/:serviceId/partition/:partitionId",{templateUrl:"partials/partition.html",controller:"PartitionViewController",controllerAs:"partitionCtrl"}),e(t,"/apptype/:appTypeName/app/:appId/service/:serviceId/partition/:partitionId/replica/:replicaId",{templateUrl:"partials/replica.html",controller:"ReplicaViewController",controllerAs:"replicaCtrl"}),t.otherwise({templateUrl:"partials/cluster.html",controller:"ClusterViewController",controllerAs:"clusterCtrl"})}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t,n,i){this.$q=e,this.data=t,this.routes=n,this.settings=i}return t.prototype.init=function(){var t=this;this.clusterHealth=new e.ClusterHealth(this.data,e.HealthStateFilterFlags.None,e.HealthStateFilterFlags.None,e.HealthStateFilterFlags.None),this.tree=new e.TreeViewModel(this.$q,function(){return t.getRootNode()}),this.cachedTreeSelection&&this.tree.selectTreeNode(this.cachedTreeSelection.path,this.cachedTreeSelection.skipSelectAction),this.cm=new e.ClusterManifest(this.data)},t.prototype.selectTreeNode=function(e,t){return this.tree?this.tree.selectTreeNode(e,t):(this.cachedTreeSelection={path:e,skipSelectAction:t},this.$q.when(null))},t.prototype.setFirstVisit=function(){return!this.tree||!!this.tree.firstTreeSelect&&(this.tree.firstTreeSelect=!1,!0)},t.prototype.refresh=function(){var e=this,t=this.tree.addHealthChunkFiltersRecursively(this.data.getInitialClusterHealthChunkQueryDescription());return this.data.getClusterHealthChunk(t).then(function(t){return e.$q.all([e.clusterHealth.mergeHealthStateChunk(t),e.tree.mergeClusterHealthStateChunk(t)])}).finally(function(){return e.tree.refresh()})},t.prototype.getRootNode=function(){var t=this
;return this.clusterHealth.ensureInitialized().then(function(n){return[{nodeId:e.IdGenerator.cluster(),displayName:function(){return"Cluster"},childrenQuery:function(){return t.getGroupNodes()},selectAction:function(){return t.routes.navigate(function(){return t.routes.getClusterViewPath()})},badge:function(){return n.healthState},alwaysVisible:!0,startExpanded:!0,mergeClusterHealthStateChunk:function(e){return t.$q.all([t.data.getApps().then(function(t){return t.mergeClusterHealthStateChunk(e)}),t.data.getNodes().then(function(t){return t.mergeClusterHealthStateChunk(e)}),t.data.getSystemApp().then(function(t){return t.mergeHealthStateChunk(e.SystemApplicationHealthStateChunk)})])}}]})},t.prototype.getGroupNodes=function(){var t,n,i,r=this,a=this.cm.ensureInitialized(!1),o=this.data.getApps().then(function(n){t={nodeId:e.IdGenerator.appGroup(),displayName:function(){return"Applications"},childrenQuery:function(){return r.getApplicationTypes()},badge:function(){return n.healthState},selectAction:function(){return r.routes.navigate(function(){return n.viewPath})},alwaysVisible:!0}}),s=this.data.getNodes().then(function(t){n={nodeId:e.IdGenerator.nodeGroup(),displayName:function(){return"Nodes"},selectAction:function(){return r.routes.navigate(function(){return t.viewPath})},childrenQuery:function(){return r.getNodes()},badge:function(){return t.healthState},listSettings:r.settings.getNewOrExistingTreeNodeListSettings(t.viewPath),alwaysVisible:!0}}),c=this.data.getSystemApp().then(function(t){i={nodeId:e.IdGenerator.systemAppGroup(),displayName:function(){return e.Constants.SystemAppTypeName},selectAction:function(){return r.routes.navigate(function(){return t.viewPath})},childrenQuery:function(){return r.getServices(e.Constants.SystemAppId)},badge:function(){return t.healthState},alwaysVisible:!0,addHealthStateFiltersForChildren:function(e){t.addHealthStateFiltersForChildren(e)},mergeClusterHealthStateChunk:function(e){return t.services.mergeClusterHealthStateChunk(e)}}}).catch(function(e){i=null});return a.then(function(){if(r.cm.isNetworkInventoryManagerEnabled){var a,l=r.data.getNetworks(!0).then(function(t){a={nodeId:e.IdGenerator.networkGroup(),displayName:function(){return"Networks"},childrenQuery:function(){return r.getNetworks()},selectAction:function(){return r.routes.navigate(function(){return t.viewPath})},alwaysVisible:!0}});return r.$q.all([o,s,l,c]).then(function(){return[t,n,a,i]})}return r.$q.all([o,s,c]).then(function(){var e=[t,n];return i&&e.push(i),e})})},t.prototype.getNodes=function(){var t=this;return this.data.getNodes(!0).then(function(n){return _.map(n.collection,function(n){return{nodeId:e.IdGenerator.node(n.name),displayName:function(){var t="";return n.raw.NodeStatus!==e.NodeStatusConstants.Up&&(n.raw.IsStopped?t="Down (Stopped)":(t=n.raw.NodeStatus,n.raw.NodeDeactivationInfo.NodeDeactivationIntent!==e.NodeStatusConstants.Invalid&&(t+="->"+n.raw.NodeDeactivationInfo.NodeDeactivationIntent))),n.raw.IsSeedNode&&(t="Seed Node"+(""===t?"":" - "+t)),""!==t?n.name+" ("+t+")":n.name},selectAction:function(){return t.routes.navigate(function(){return n.viewPath})},childrenQuery:function(){return t.getDeployedApplications(n.name)},badge:function(){return n.healthState},sortBy:function(){return[n.name]},actions:n.actions,addHealthStateFiltersForChildren:function(e){n.addHealthStateFiltersForChildren(e)},mergeClusterHealthStateChunk:function(e){return n.deployedApps.mergeClusterHealthStateChunk(e)}}})})},t.prototype.getNetworks=function(){var t=this;return this.data.getNetworks(!0).then(function(n){return _.map(n.collection,function(n){return{nodeId:e.IdGenerator.network(n.name),displayName:function(){return n.name},selectAction:function(){return t.routes.navigate(function(){return n.viewPath})},sortBy:function(){return[n.name]},actions:n.actions}})})},t.prototype.getApplicationTypes=function(){var t=this;return this.data.getAppTypeGroups(!0).then(function(n){return _.map(n.collection,function(n){return{nodeId:e.IdGenerator.appType(n.name),displayName:function(){return n.name},selectAction:function(){return t.routes.navigate(function(){return n.viewPath})},childrenQuery:function(){return t.getApplicationsForType(n.name)},badge:function(){return n.appsHealthState},sortBy:function(){return[n.name]},actions:n.actions}})})},t.prototype.getDeployedApplications=function(t){var n=this;return this.data.getDeployedApplications(t).then(function(i){return _.map(i.collection,function(i){return{nodeId:e.IdGenerator.deployedApp(i.id),displayName:function(){return i.name},selectAction:function(){return n.routes.navigate(function(){return i.viewPath})},childrenQuery:function(){return n.getDeployedServicePackages(t,i.id)},badge:function(){return i.health.healthState},sortBy:function(){return[i.name]},listSettings:n.settings.getNewOrExistingTreeNodeListSettings(i.viewPath),addHealthStateFiltersForChildren:function(e){i.addHealthStateFiltersForChildren(e)},mergeClusterHealthStateChunk:function(e){return i.deployedServicePackages.mergeClusterHealthStateChunk(e)},canExpandAll:!0}})})},t.prototype.getDeployedServicePackages=function(t,n){var i=this;return this.data.getDeployedServicePackages(t,n).then(function(r){return _.map(r.collection,function(r){return{nodeId:e.IdGenerator.deployedServicePackage(r.name,r.servicePackageActivationId),displayName:function(){return r.uniqueId},selectAction:function(){return i.routes.navigate(function(){return r.viewPath})},childrenQuery:function(){return i.getDeployedServiceChildrenGroupNodes(t,n,r.name,r.servicePackageActivationId)},badge:function(){return r.health.healthState},sortBy:function(){return[r.uniqueId]},canExpandAll:!0}})})},t.prototype.getDeployedServiceChildrenGroupNodes=function(t,n,i,r){var a,o,s=this,c=this.data.getDeployedCodePackages(t,n,i,r,!0).then(function(o){a={nodeId:e.IdGenerator.deployedCodePackageGroup(),displayName:function(){return"Code Packages"},childrenQuery:function(){return s.getDeployedCodePackages(o,t,n,i,r)},selectAction:function(){return s.routes.navigate(function(){return o.viewPath})}}}),l=this.data.getDeployedReplicas(t,n,i,r,!0).then(function(a){o={nodeId:e.IdGenerator.deployedReplicaGroup(),displayName:function(){return a.isStatelessService?"Instances":"Replicas"},childrenQuery:function(){return s.getDeployedReplicas(a,t,n,i,r)},selectAction:function(){return s.routes.navigate(function(){return a.viewPath})},listSettings:s.settings.getNewOrExistingTreeNodeListSettings(a.viewPath)}});return this.$q.all([c,l]).then(function(){return[a,o]})},t.prototype.getDeployedCodePackages=function(t,n,i,r,a){var o=this;return this.$q.when(_.map(t.collection,function(t){return{nodeId:e.IdGenerator.deployedCodePackage(t.name),displayName:function(){return t.uniqueId},selectAction:function(){return o.routes.navigate(function(){return t.viewPath})},sortBy:function(){return[t.uniqueId]},actions:t.actions}}))},t.prototype.getDeployedReplicas=function(t,n,i,r,a){var o=this;return this.$q.when(_.map(t.collection,function(t){return{nodeId:e.IdGenerator.deployedReplica(t.raw.PartitionId),displayName:function(){return t.isStatelessService?t.id:t.id+" ("+t.role+")"},selectAction:function(){return o.routes.navigate(function(){return t.viewPath})},sortBy:function(){return t.isStatelessService?[t.id]:[t.replicaRoleSortPriority,t.id]},actions:t.actions}}))},t.prototype.getApplicationsForType=function(t){var n=this;return this.data.getAppTypeGroup(t).then(function(t){return _.map(t.apps,function(t){return{nodeId:e.IdGenerator.app(t.id),displayName:function(){return t.name},selectAction:function(){return n.routes.navigate(function(){return t.viewPath})},childrenQuery:function(){return n.getServices(t.id)},badge:function(){return t.healthState},sortBy:function(){return[t.name]},actions:t.actions,listSettings:n.settings.getNewOrExistingTreeNodeListSettings(t.viewPath),addHealthStateFiltersForChildren:function(e){t.addHealthStateFiltersForChildren(e)},mergeClusterHealthStateChunk:function(e){return t.services.mergeClusterHealthStateChunk(e)},canExpandAll:!0}})})},t.prototype.getServices=function(t){var n=this;return this.data.getServices(t).then(function(i){return _.map(i.collection,function(i){return{nodeId:e.IdGenerator.service(i.id),displayName:function(){return i.name},selectAction:function(){return n.routes.navigate(function(){return i.viewPath})},childrenQuery:function(){return n.getPartitions(t,i.id)},badge:function(){return i.healthState},sortBy:function(){return[i.name]},actions:i.actions,listSettings:n.settings.getNewOrExistingTreeNodeListSettings(i.viewPath),addHealthStateFiltersForChildren:function(e){i.addHealthStateFiltersForChildren(e)},mergeClusterHealthStateChunk:function(e){return i.partitions.mergeClusterHealthStateChunk(e)},canExpandAll:!0}})})},t.prototype.getPartitions=function(t,n){var i=this;return this.data.getPartitions(t,n).then(function(r){return _.map(r.collection,function(r){return{nodeId:e.IdGenerator.partition(r.id),displayName:function(){return r.partitionInformation.isPartitionKindNamed?r.partitionInformation.raw.Name+" ("+r.id+")":r.id},selectAction:function(){return i.routes.navigate(function(){return r.viewPath})},childrenQuery:function(){return i.getReplicas(t,n,r.id)},badge:function(){return r.healthState},sortBy:function(){return[r.name]},listSettings:i.settings.getNewOrExistingTreeNodeListSettings(r.viewPath)}})})},t.prototype.getReplicas=function(t,n,i){var r=this;return this.data.getReplicasOnPartition(t,n,i,!0).then(function(t){return _.map(t.collection,function(t){return{nodeId:e.IdGenerator.replica(t.id),displayName:function(){return t.isStatelessService?t.raw.NodeName:t.role+" ("+t.raw.NodeName+")"},selectAction:function(){return r.routes.navigate(function(){return t.viewPath})},badge:function(){return t.healthState},sortBy:function(){return t.isStatelessService?[t.raw.NodeName]:[t.replicaRoleSortPriority,t.raw.NodeName]},actions:t.actions,canExpandAll:!0}})})},t}();e.ClusterTreeService=t,function(){angular.module("clusterTreeService",["ng","ngSanitize","dataService","routes"]).factory("clusterTree",["$q","data","routes","settings",function(e,n,i,r){return new t(e,n,i,r)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(e,t,n,i,r){this.$window=e,this.$interval=t,this.$location=n,this.$route=i,this.storage=r,this.isEnabled=!1,this.initialize()}return t.prototype.trackPageView=function(){var e=this;this.isEnabled&&this.noThrowWrapper(function(){var t=new r(e.$location,e.$route.current);t.url&&e.appInsights.trackPageView(null,t.url,t.properites)})},t.prototype.trackActionEvent=function(e,t,n){var i=this;this.isEnabled&&t&&e&&this.noThrowWrapper(function(){i.appInsights.trackEvent("Action: "+e,{Result:n,Source:t})})},t.prototype.trackEvent=function(e){var t=this;this.isEnabled&&e&&this.noThrowWrapper(function(){t.appInsights.trackEvent(e)})},t.prototype.initialize=function(){var t=this;this.delayedUpdates={},this.appInsights=this.$window.appInsights,this.isEnabled=this.shouldEnableTelemetry(),this.appInsights&&(this.appInsights.config&&(this.appInsights.config.disableTelemetry=!this.isEnabled),this.appInsights.context&&this.appInsights.context.application&&(this.appInsights.context.application.ver=e.VersionInfo.Version,this.appInsights.context.application.build=e.VersionInfo.Build)),this.isEnabled&&this.storage.subscribe(function(e,n,i){return t.storageValueChanged(e,n,i)})},t.prototype.shouldEnableTelemetry=function(){return this.appInsights&&t.TelemetryEnabledHostsRegex.test(this.$location.host())},t.prototype.trackPropertyChangedEvent=function(e,t,n){var i=this;this.isEnabled&&(this.appInsights&&e&&t!==n&&this.noThrowWrapper(function(){i.appInsights.trackEvent("Property: "+e,{OldValue:t,NewValue:n})}),delete this.delayedUpdates[e])},t.prototype.storageValueChanged=function(e,i,r){var a=this;this.isEnabled&&this.noThrowWrapper(function(){var o=i,s=a.delayedUpdates[e];s&&(a.$interval.cancel(s.promise),o=s.oldValue),a.delayedUpdates[e]=new n(o,r,a.$interval(function(){return a.trackPropertyChangedEvent(e,o,r)},1e3*t.DelayUpdateTimeInSeconds,1))})},t.prototype.noThrowWrapper=function(e){try{e.apply(this)}catch(e){}},t.TelemetryEnabledHostsRegex=/(^|\.)azure\.com($|:)/i,t.DelayUpdateTimeInSeconds=10,t}();e.TelemetryService=t;var n=function(){function e(e,t,n){this.oldValue=e,this.newValue=t,this.promise=n}return e}();e.PropertyUpdatePromise=n;var i=function(){function e(){}return e}();e.PageViewProperties=i;var r=function(){function e(e,t){t&&e&&(this.properites=new i,this.url=t.loadedTemplateUrl,this.properites.IsSecure=e.protocol()&&"https"===e.protocol().toLowerCase(),this.properites.IsLocal=e.host()&&"localhost"===e.host().toLowerCase(),t.params&&t.params.tabId&&(this.properites.TabName=t.params.tabId))}return e}();e.PageViewRecord=r,function(){angular.module("telemetryService",["storageService","ngRoute"]).factory("telemetry",["$window","$interval","$location","$route","storage",function(e,n,i,r,a){return new t(e,n,i,r,a)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n){var i=t.call(this)||this;return i.storage=n,i.currentThemeName=n.getValueString(e.Constants.ThemeNameStorageKey,e.Constants.DefaultThemeName),i}return __extends(n,t),n.prototype.getActiveThemeName=function(){return this.currentThemeName},n.prototype.changeToTheme=function(t,n){if(void 0===n&&(n=!1),t!==this.currentThemeName){var i=this.currentThemeName;this.currentThemeName=t,this.notify(e.Constants.ThemeNameMonitorPropertyName,i,t),n&&this.storage.setValue(e.Constants.ThemeNameStorageKey,t)}},n.prototype.resolveAndChangeToTheme=function(e,t){if(_.isString(e)&&e&&_.isString(t)&&t){e=e.toLowerCase(),t=t.toLowerCase();var n="";switch(e){case"vs":n=this.resolveVsTheme(t);break;case"azure":n=this.resolveAzureTheme(t)}n&&this.changeToTheme(n,!1)}},n.prototype.resolveVsTheme=function(e){switch(e){case"blue":case"light":return"light";case"dark":return"dark";default:return""}},n.prototype.resolveAzureTheme=function(e){switch(e){case"azure":case"blue":case"light":return"light";case"dark":return"dark";default:return""}},n}(e.Observable);e.ThemeService=t,function(){angular.module("themeService",["storageService"]).factory("theme",["storage",function(e){return new t(e)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t,n){this.$location=t,this.storage=n,this.listSettings={},this._paginationLimit=n.getValueNumber(e.Constants.PaginationLimitStorageKey,e.Constants.DefaultPaginationLimit)}return Object.defineProperty(t.prototype,"paginationLimit",{get:function(){return this._paginationLimit},set:function(t){t&&(t<e.Constants.PaginationLimitMin?t=e.Constants.PaginationLimitMin:t>e.Constants.PaginationLimitMax&&(t=e.Constants.PaginationLimitMax),this._paginationLimit=t,this.storage.setValue(e.Constants.PaginationLimitStorageKey,t),this.updatePaginationLimit(t))},enumerable:!0,configurable:!0}),t.prototype.getNewOrExistingMetricsViewModel=function(t,n){return this._metricsViewModel||(this._metricsViewModel=new e.MetricsViewModel(t,n)),this._metricsViewModel},t.prototype.getNewOrExistingListSettings=function(t,n,i,r,a,o,s){void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===a&&(a=!1),void 0===o&&(o=function(e){return!0}),void 0===s&&(s=!0);var c=this.$location.path()+"/"+t;return this.listSettings[c]||(this.listSettings[c]=new e.ListSettings(this.paginationLimit,n,i,r,a,o,s)),this.listSettings[c]},t.prototype.getNewOrExistingTreeNodeListSettings=function(t,n,i){return void 0===n&&(n=[]),void 0===i&&(i=[]),this.listSettings[t]||(this.listSettings[t]=new e.ListSettings(this.paginationLimit,n,i)),this.listSettings[t]},t.prototype.getNewOrExistingUnhealthyEvaluationsListSettings=function(t){return void 0===t&&(t="unhealthyEvaluations"),this.getNewOrExistingListSettings(t,null,[new e.ListColumnSetting("kind","Kind",null,!1,function(t){return e.HtmlUtils.getSpanWithLink("preserve-whitespace",t.kind,t.viewPath)}),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSetting("description","Description",null,!1,function(t){return'<sfx-clip-board text="item.description"></sfx-clip-board> '+e.HtmlUtils.getSpanWithCustomClass("preserve-whitespace-wrap",t.description)})])},t.prototype.getNewOrExistingHealthEventsListSettings=function(t){return void 0===t&&(t="healthEvents"),this.getNewOrExistingListSettings(t,["raw.SequenceNumber"],[new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSetting("raw.SourceId","Source"),new e.ListColumnSetting("raw.Property","Property"),new e.ListColumnSetting("sourceUtcTimestamp","Source UTC"),new e.ListColumnSetting("TTL","TTL"),new e.ListColumnSetting("raw.SequenceNumber","Sequence Number"),new e.ListColumnSetting("raw.RemoveWhenExpired","Remove When Expired"),new e.ListColumnSetting("raw.IsExpired","Is Expired")],[new e.ListColumnSetting("placeholder","placeholder",null,!1),new e.ListColumnSetting("description","Description",null,!1,function(t){return e.HtmlUtils.getSpanWithCustomClass("preserve-whitespace-wrap",t.description)},100)])},t.prototype.getNewOrExistingNodeStatusListSetting=function(t){return void 0===t&&(t="nodeStatus"),this.getNewOrExistingListSettings(t,null,[new e.ListColumnSetting("nodeType","Node Type"),new e.ListColumnSetting("totalCount","Total Node Count"),new e.ListColumnSetting("statusTypeCounts."+e.NodeStatusConstants.Up,e.NodeStatusConstants.Up),new e.ListColumnSetting("statusTypeCounts."+e.NodeStatusConstants.Down,e.NodeStatusConstants.Down),new e.ListColumnSetting("statusTypeCounts."+e.NodeStatusConstants.Disabled,e.NodeStatusConstants.Disabled),new e.ListColumnSetting("statusTypeCounts."+e.NodeStatusConstants.Disabling,e.NodeStatusConstants.Disabling),new e.ListColumnSetting("errorCount","Error"),new e.ListColumnSetting("warningCount","Warning")])},t.prototype.getNewOrExistingBackupPolicyListSettings=function(t){return void 0===t&&(t="backupPolicies"),this.getNewOrExistingListSettings(t,[null],[new e.ListColumnSetting("raw.Name","Name",["raw.Name"],!1,function(e,t){return"<a href='#/tab/backupPolicies'>"+t+"</a>"},1,function(e){return e.action.runWithCallbacks.apply(e.action)}),new e.ListColumnSetting("raw.Schedule.ScheduleKind","ScheduleKind"),new e.ListColumnSetting("raw.Storage.StorageKind","StorageKind"),new e.ListColumnSetting("raw.AutoRestoreOnDataLoss","AutoRestoreOnDataLoss"),new e.ListColumnSetting("raw.MaxIncrementalBackups","MaxIncrementalBackups")])},t.prototype.updatePaginationLimit=function(e){_.forEach(this.listSettings,function(t){t.currentPage=1,t.limit=e})},t}();e.SettingsService=t,function(){angular.module("settingsService",["storageService"]).factory("settings",["$location","storage",function(e,n){return new t(e,n)}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.require="^^ngController"}return e.prototype.link=function(e,t,n,i){var r=$(t).slider({value:i.default,min:i.min,max:i.max,step:i.step,change:function(e,n){i.slide(n.value),$(t).attr("aria-valuenow",n.value),$(t[0].children[0]).attr("aria-valuenow",n.value)}}),a=r[0].children[0];$(a).attr("aria-valuenow",i.default),$(a).attr("aria-label","Change how often content is updated"),$(a).attr("aria-valuemin",i.min),$(a).attr("aria-valuemax",i.max),$("#"+n.minLabelId).click(function(){$(t).slider("option","value",i.min)}),$("#"+n.maxLabelId).click(function(){$(t).slider("option","value",i.max)})},e}();e.SliderDirective=t;var n=function(){function t(n,i){this.storageService=n,this.$rootScope=i,this.min=0,this.max=t.Stops.length-1,this.step=1,this.default=e.Constants.DefaultAutoRefreshInterval;var r=this.storageService.getValueNumber(e.Constants.AutoRefreshIntervalStorageKey,this.default),a=t.Stops.indexOf(r);-1===a&&(a=this.min),this.default=a,this.refreshRate=t.Stops[a]}return t.prototype.slide=function(n){(n<0||n>=t.Stops.length)&&(n=0),this.refreshRate=t.Stops[n],this.storageService.setValue(e.Constants.AutoRefreshIntervalStorageKey,this.refreshRate),this.$rootScope.$$phase||this.$rootScope.$apply()},t.Stops=[0,300,60,30,15,10,5,2],t}();e.RefreshSliderController=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="A",this.require="ngController"}return e.prototype.link=function(e,t,n,i){var r=function(e,t,n,i,r){$("#"+t).outerWidth(r),$("#"+n).css("left",$("#"+t).outerWidth()+i),$(e).attr("aria-valuenow",$("#"+t).outerWidth())},a=i.SplitterLeftWidth;r(t,i.left,i.right,i.offset,a),$(t).mousedown(function(e){e.preventDefault(),$(document).mousemove(function(e){r(t,i.left,i.right,i.offset,e.pageX+2),i.SplitterLeftWidth=$("#"+i.left).outerWidth()+i.offset})}),$(t).keyup(function(e){var n=0;37===e.keyCode&&(n=-50),39===e.keyCode&&(n=50),0!==n&&(e.preventDefault(),r(t,i.left,i.right,i.offset,i.SplitterLeftWidth+n),i.SplitterLeftWidth=$("#"+i.left).outerWidth()+i.offset)}),$(document).mouseup(function(e){$(document).unbind("mousemove")})},e}();e.SplitterDirective=t;var n=function(){function t(e){this.storageService=e,this.left="tree",this.right="main",this.offset=0}return Object.defineProperty(t.prototype,"SplitterLeftWidth",{get:function(){return this.storageService.getValueNumber(e.Constants.SplitterLeftWidth,e.Constants.DefaultSplitterLeftWidth)},set:function(t){this.storageService.setValue(e.Constants.SplitterLeftWidth,t)},enumerable:!0,configurable:!0}),t}();e.SplitterController=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="AE",this.replace=!0,this.controller=i,this.controllerAs="ctrl",this.templateUrl="partials/detail-view-part.html",this.scope={data:"=",title:"="}}return e.prototype.link=function(e,t,n,i){e.noFixedLayout=!1,n.$observe("noFixedLayout",function(){e.noFixedLayout=e.$eval(n.noFixedLayout)}),e.$watchGroup(["data.raw","data"],function(t,n){e.resolvedData=i.getResolvedDataObject(e.data)})},e}();e.DetailViewPartDirective=t;var n=function(){function e(){}return e}();e.ResolvedObject=n;var i=function(){function t(){}return t.prototype.getResolvedObjectSize=function(e){return _.size(e)},t.prototype.getResolvedPropertyType=function(e){return this.isResolvedObject(e)?"Object":this.isArray(e)?"Array":this.isHtml(e)?"Html":"Value"},t.prototype.getResolvedDataObject=function(e,t){return void 0===t&&(t=!1),e?e instanceof n?e:e.hasOwnProperty("raw")?_.isUndefined(e.raw)||_.isNull(e.raw)?null:this.getResolvedDataObjectInternal(e.raw,e,t):this.getResolvedDataObjectInternal(e,null,t):null},t.prototype.isResolvedObject=function(e){return e instanceof n},t.prototype.isArray=function(e){return _.isArray(e)},t.prototype.isHtml=function(t){return e.HtmlUtils.isHtml(t)},t.prototype.getResolvedDataObjectInternal=function(t,i,r){var a=this;void 0===r&&(r=!1);var o=new n;return _.forOwn(t,function(n,s){var c=_.startCase(s),l=null;if(i&&i.decorators){if(i.decorators.showList&&!_.includes(i.decorators.showList,s))return;if(i.decorators.hideList&&_.includes(i.decorators.hideList,s))return;i.decorators.decorators&&i.decorators.decorators[s]&&(i.decorators.decorators[s].displayName&&(c=i.decorators.decorators[s].displayName(s)),i.decorators.decorators[s].displayValueInHtml&&(l=i.decorators.decorators[s].displayValueInHtml(n)))}l||(i&&(l=i[s]||i[_.camelCase(s)]),l||(l=t[s])),_.isNumber(l)||_.isBoolean(l)||(_.isUndefined(l)||_.isNull(l)||_.isEmpty(l)?l=r?e.Constants.Empty:null:_.isArray(l)?l=_.isObject(_.first(l))?_.map(l,function(e){return a.getResolvedDataObject(e,!0)}):"["+_.map(l,function(e){return e.toString()}).join(", ")+"]":_.isObject(l)&&(l=e.Utils.isBadge(l)?l.text&&l.badgeClass?e.HtmlUtils.getBadgeHtml(l):l.text:a.getResolvedDataObject(l))),_.isEmpty(c)&&(c=e.Constants.Empty),null!==l&&(o[c]=l)}),_.size(o)>0?o:null},t}();e.DetailViewPartController=i}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.replace=!0,this.controller=n,this.controllerAs="ctrl",this.templateUrl="partials/detail-list.html",this.scope={list:"=",listSettings:"=",innerScroll:"=?",searchText:"=?"},this.transclude=!0}return e.prototype.link=function(e,t,n,i){e.$watchCollection("list",function(){e.list&&!angular.isDefined(e.list.isRefreshing)&&i.updateList()}),e.$watch("list.isInitialized",function(t,n){e.list&&!1===t&&!0===n&&i.updateList()}),e.$watch("list.isRefreshing",function(){e.list&&angular.isDefined(e.list.isRefreshing)&&!e.list.isRefreshing&&i.updateList()}),e.$watch("listSettings.search",function(e){void 0!==e&&i.updateList()})},e}();e.DetailListDirective=t;var n=function(){function t(e,t){this.$filter=e,this.$scope=t}return t.prototype.updateList=function(){this.$scope.list&&(this.$scope.sortedFilteredList=this.getSortedFilteredList(),this.$scope.listSettings.count=this.$scope.sortedFilteredList.length)},t.prototype.handleClickRow=function(e,t){t&&t.target!==t.currentTarget||this.$scope.listSettings.secondRowCollapsible&&this.$scope.listSettings.showSecondRow(e)&&(e.isSecondRowCollapsed=!e.isSecondRowCollapsed)},t.prototype.getSortedFilteredList=function(){var e=this,t=this.$scope.list.collection||this.$scope.list;if(_.isEmpty(t))return t;if(this.$scope.listSettings.hasEnabledFilters||this.$scope.listSettings.search){var n=_.map(t,function(t){var n=e.$scope.listSettings.getPluckedObject(t);return n.$originalItem=t,n});if(n=this.filterOnColumns(n,this.$scope.listSettings),this.$scope.listSettings.search){var i=this.$scope.listSettings.search.trim().split(/\s+/);_.forEach(i,function(t){n=e.$filter("filter")(n,t)})}t=_.map(n,function(e){return e.$originalItem})}return _.isEmpty(this.$scope.listSettings.sortPropertyPaths)||(t=this.$filter("orderBy")(t,this.$scope.listSettings.sortPropertyPaths,this.$scope.listSettings.sortReverse)),t},t.prototype.filterOnColumns=function(t,n){var i=new Array(t.length);return _.fill(i,!0),_.forEach(n.columnSettings,function(n){if(n.enableFilter){var r=_.some(n.filterValues,function(e){return!e.isChecked}),a=_.map(_.filter(n.filterValues,function(e){return e.isChecked}),"value");n.filterValues=_.sortBy(_.union(_.map(_.filter(_.uniq(_.filter(_.map(t,function(e,t){var o=e[n.propertyPath];return i[t]=i[t]&&(!r||!o||_.includes(a,o)),o}),function(e){return!_.isEmpty(e)})),function(e){return _.every(n.filterValues,function(t){return t.value!==e})}),function(t){return new e.FilterValue(t)}),n.filterValues),"value")}}),t=_.filter(t,function(e,t){return i[t]})},t.$inject=["$filter","$scope"],t}();e.DetailListController=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t){this.$compile=t,this.restrict="A",this.link=function(t,i,r){function a(e){return t.metrics.getLegendColor(e)}function o(e){var t=d3.select(this);t.text(null).attr("transform","rotate(-45)").style("text-anchor","end").attr("dx","-0.5em").attr("dy","0.5em");var n=t.append("tspan").text(e),i=n.node().getComputedTextLength();if(t.append("title").text(e),i>120)for(;i>120&&e.length>0;)e=e.slice(1),n.text("..."+e),i=n.node().getComputedTextLength()}var s={bottom:100,left:60},c=605-s.bottom,l=e.Constants.SvgTransitionDuration,u=d3.scale.ordinal().rangeBands([0,760]),p=d3.scale.ordinal(),d=d3.scale.linear().range([c,0]),h=d3.svg.axis().scale(u).outerTickSize(0).orient("bottom"),f=d3.svg.axis().scale(d).ticks(0).outerTickSize(0).orient("left"),g=d3.select(i[0]).append("svg").attr("class","metrics-chart-left").append("g").attr("transform","translate("+s.left+", 0)"),m=d3.select(i[0]).append("div").attr("class","metrics-chart-body-container"),v=m.append("svg").attr("class","metrics-chart-body").attr("width","100%"),y=d3.select(i[0]).append("svg").attr("class","metrics-chart-right").append("g"),S=v.append("g"),w=v.append("g");v.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(h);var C=g.append("g").attr("class","y axis").call(f).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end"),b=v.append("text").style("text-anchor","middle").attr("transform","translate(380,"+c/2+")").text("Loading...");t.$watch("metrics.refreshToken",function(i,r){if(t.metrics&&t.metrics.filteredNodeLoadInformation&&!_.isUndefined(r)){var s=_.sortBy(t.metrics.filteredNodeLoadInformation,function(e){return[e.parent.raw.Type,e.name]}),I=t.metrics.selectedMetrics,P=_.map(I,function(e){return e.raw.Name}),N=_.some(I,function(e){return e.hasCapacity}),k=N&&t.metrics.normalizeMetricsData;if(s.length<=20)t.metrics.isExpanderEnabled=!1,$(m[0]).width(760),$(v[0]).width(760),u.rangeBands([0,760],.1,.5);else{t.metrics.isExpanderEnabled=!0;var D=760*s.length/20;$(m[0]).width(t.metrics.isFullScreen?D:760),$(v[0]).width(D),u.rangeBands([0,D],.1,.5)}u.domain(s.map(function(e){return e.name})),p.domain(P).rangeBands([0,u.rangeBand()],.1);var A=d3.max(s,function(e){return d3.max(_.filter(e.nodeLoadMetricInformation,function(e){return _.includes(P,e.name)}),function(e){return k?e.loadCapacityRatio:N?Math.max(+e.raw.NodeLoad,+e.raw.NodeCapacity):+e.raw.NodeLoad})});k&&(A=Math.max(A,d3.max(I,function(e){return e.loadCapacityRatio}))),d.domain([0,1.1*A]);var x=u.rangeBand();v.selectAll("g.x.axis").call(h);var R=v.selectAll("g.x.axis .tick text"),T=!1;R.each(function(){var e=d3.select(this);T=T||e.node().getComputedTextLength()>=x}),T?R.each(o):R.attr("transform",null),k?f.tickFormat(d3.format("%")).ticks(null):A<=10?f.tickFormat(d3.format("d")).ticks(A):f.tickFormat(d3.format("s")).ticks(null),g.selectAll("g.y.axis").transition().duration(l).call(f),C.text(P[0]);var U=[];if(N&&!k){var E=_.first(I);s.forEach(function(e){var t=_.find(e.nodeLoadMetricInformation,function(e){return e.name===E.name}),i=_.last(U);if(i&&i.nodeTypeName===e.parent.raw.Type)i.nodeLoadMetrics.push(t);else{var r=new n(e.parent.raw.Type,E.name,+t.raw.NodeCapacity);r.nodeLoadMetrics.push(t),U.push(r)}})}var L=S.selectAll(".metric-cap-rect").data(U,function(e){return e.nodeTypeName});L.enter().append("rect").attr("class","metric-cap-rect").attr("is-capacity-violation",function(e){return e.isCapacityViolation}).attr("width",function(e){return u(e.lastNodeName)-u(e.firstNodeName)+u.rangeBand()}).attr("x",function(e){return u(e.firstNodeName)}).attr("y",d(0)).attr("height",Math.max(0,c-d(0))).transition().duration(l).attr("y",function(e){return d(e.capacity)}).attr("height",function(e){return Math.max(0,c-d(e.capacity))}).each(function(e){$(this).tooltip({placement:"top",html:!0,animation:!1,container:".metrics-chart-body-container",viewport:".metrics-chart-body-container",title:function(){return(e.isCapacityViolation?"<b>Capacity Violation</b><br />":"")+"Capacity ("+e.nodeTypeName+"): "+e.capacity}})}),L.transition().duration(l).attr("is-capacity-violation",function(e){return e.isCapacityViolation}).attr("width",function(e){return u(e.lastNodeName)-u(e.firstNodeName)+u.rangeBand()}).attr("x",function(e){return u(e.firstNodeName)}).attr("y",function(e){return d(e.capacity)}).attr("height",function(e){return Math.max(0,c-d(e.capacity))}),L.exit().transition().duration(l).attr("y",d(0)).attr("height",Math.max(0,c-d(0))).style("fill-opacity",1e-6).remove();var M=w.selectAll(".node").data(s,function(e){return e.name});M.enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+u(e.name)+",0)"}),M.attr("transform",function(e){return"translate("+u(e.name)+",0)"}),M.exit().transition().duration(l).style("fill-opacity",1e-6).remove();var B=M.selectAll(".metric-rect").data(function(e){return _.filter(e.nodeLoadMetricInformation,function(e){return _.includes(P,e.name)})},function(e){return e.raw.Name});B.enter().append("rect").attr("class","metric-rect").attr("is-capacity-violation",function(e){return e.raw.IsCapacityViolation}).attr("width",p.rangeBand()).attr("x",function(e){return p(e.raw.Name)}).attr("y",d(0)).attr("height",Math.max(0,c-d(0))).transition().duration(l).attr("y",function(e){return d(k?e.loadCapacityRatio:+e.raw.NodeLoad)}).attr("height",function(e){return Math.max(0,c-d(k?e.loadCapacityRatio:+e.raw.NodeLoad))}).style("fill",function(e){return e.raw.IsCapacityViolation?null:a(e.raw.Name)}).each(function(e){$(this).tooltip({placement:"top",html:!0,
animation:!1,container:".metrics-chart-body-container",viewport:".metrics-chart-body-container",title:function(){return(e.raw.IsCapacityViolation?"<b>Capacity Violation</b><br />":"")+e.parent.name+": "+e.raw.NodeLoad+(e.hasCapacity?" / "+e.raw.NodeCapacity+" ("+e.loadCapacityRatioString+")":"")}})}),B.transition().duration(l).attr("is-capacity-violation",function(e){return e.raw.IsCapacityViolation}).attr("width",p.rangeBand()).attr("x",function(e){return p(e.raw.Name)}).attr("y",function(e){return d(k?e.loadCapacityRatio:+e.raw.NodeLoad)}).attr("height",function(e){return Math.max(0,c-d(k?e.loadCapacityRatio:+e.raw.NodeLoad))}).style("fill",function(e){return e.raw.IsCapacityViolation?null:a(e.raw.Name)}),B.exit().transition().duration(l).attr("y",d(0)).attr("height",Math.max(0,c-d(0))).style("fill-opacity",1e-6).remove();var H=[];k&&s.length>0&&(H=_.filter(I,function(e){return e.loadCapacityRatio>0}));var F=v.selectAll(".mean-line").data(H,function(e){return e.name}),V=y.selectAll(".mean-label").data(H,function(e){return e.name});F.transition().duration(l).attr("y1",function(e){return d(e.loadCapacityRatio)}).attr("y2",function(e){return d(e.loadCapacityRatio)}),V.transition().duration(l).attr("y",function(e){return d(e.loadCapacityRatio)}).text(function(e){return""+e.loadCapacityRatioString}),F.enter().append("svg:line").attr("class","mean-line").attr("opacity",1e-6).transition().duration(l).attr("opacity",1).attr("x1",u.rangeExtent()[0]).attr("x2",u.rangeExtent()[1]).attr("y1",function(e){return d(e.loadCapacityRatio)}).attr("y2",function(e){return d(e.loadCapacityRatio)}).style("stroke-width",2).style("fill","none"),V.enter().append("text").attr("class","mean-label").attr("opacity",1e-6).transition().duration(l).attr("opacity",1).attr("x",10).attr("y",function(e){return d(e.loadCapacityRatio)}).attr("dy",".35em").text(function(e){return""+e.loadCapacityRatioString}),F.exit().transition().duration(l).style("opacity",1e-6).remove(),V.exit().transition().duration(l).style("opacity",1e-6).remove(),0===I.length?b.transition().duration(l).style("opacity",1).text("Select a metric to show chart."):0===s.length?b.transition().duration(l).style("opacity",1).text("No data is available for the selected metric."):b.transition().duration(l).style("opacity",1e-6);var O=t.metrics.metrics.map(function(t){return new e.ListColumnSetting("data."+t.name,t.displayName)});O.splice(0,0,new e.ListColumnSetting("node","Node"));var G=t.metrics.filteredNodeLoadInformation.map(function(e){var t=e.nodeLoadMetricInformation.reduce(function(e,t){return e[t.name]=t.raw.NodeLoad,e},{});return{node:e.raw.NodeName,data:t}});t.tableData=G,t.tableSettings=t.listSettings.getNewOrExistingListSettings("metricsettings",["node"],O)}})}}return t.factory=function(){var e=function(e){return new t(e)};return e.$inject=["$compile"],e},t}();e.MetricsBarChartDirective=t;var n=function(){function e(e,t,n){this.nodeTypeName=e,this.metricName=t,this.capacity=n,this.nodeLoadMetrics=[]}return Object.defineProperty(e.prototype,"firstNodeName",{get:function(){return _.first(this.nodeLoadMetrics).parent.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastNodeName",{get:function(){return _.last(this.nodeLoadMetrics).parent.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCapacityViolation",{get:function(){return _.some(this.nodeLoadMetrics,function(e){return e.raw.IsCapacityViolation})},enumerable:!0,configurable:!0}),e}();e.NodeTypeMetricCapacity=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){this.restrict="AE",this.replace=!0,this.templateUrl="partials/dashboard.html",this.scope={data:"="},this.link=function(t,n,i){function r(e){return e/360*270-Math.PI/4}function a(e,t){this._current||(this._current={startAngle:0,endAngle:0});var n=d3.interpolate(this._current,e);return this._current=n(0),function(e){return h(n(e))}}var o=6+(t.data.largeTile?200:120),s=o,c=t.data.largeTile?10:8,l=o/2-3,u=o/2-c-3,p=e.Constants.SvgTransitionDurationSlow,d=d3.layout.pie().value(function(e){return e.adjustedCount}).sort(null),h=d3.svg.arc().startAngle(function(e){return r(e.startAngle)}).endAngle(function(e){return r(e.endAngle)}).outerRadius(l).innerRadius(u),f=d3.select(n[0]).select(".dashboard-donut-chart").attr("width",o).attr("height",s).append("g").attr("transform","translate("+o/2+","+s/2+")"),g=t.data.largeTile?40:32,m=f.append("g").attr("transform","translate(-"+o/2+", -6)"),v=m.append("text").attr("class","dashboard-number"),y=m.append("text").attr("transform","translate(8, "+g+")").attr("class","dashboard-title"),S=f.append("path");S.datum({startAngle:0,endAngle:2*Math.PI}).transition().duration(p).attr("class","dashboard-arc-bg").attr("d",h).attrTween("d",a),h.padAngle(function(e,t){return e.data?0===e.data.adjustedCount?0:.03:0}),t.$watch("data",function(){var e=d(t.data.dataPoints),n=f.selectAll(".dashboard-arc"),i=n.data().length>0?n.data():d([]),o=n.data(e,function(e){return e.data.title}),s=t.data.largeTile?72:50,c=t.data.largeTile?160:112;y.text(t.data.displayTitle.toUpperCase()),v.text(t.data.count).style("font-size",function(e){return Math.min(s,1.9*Math.floor(c/t.data.count.toString().length))+"px"}),t.data.count.toString().length>6?v.attr("transform","translate(6, 10)"):v.attr("transform","translate(6, 18)"),S.attr("display",function(){return t.data.count>0?"none":null});var l=o.enter().append("path");l.append("title").text(function(e){return t.data.getDataPointTooltip(e.data)}),l.attr("class",function(e){return"dashboard-arc "+e.data.state.badgeClass}).transition().duration(p).attr("d",h).attrTween("d",a).each(function(e,t){var n=0;t>0&&i.length>=t&&(n=i[t-1].endAngle+i[t-1].padAngle),this._current={startAngle:n,endAngle:n}}),o.transition().duration(p).attrTween("d",a),o.select("title").text(function(e){return t.data.getDataPointTooltip(e.data)}),o.exit().datum(function(t,n){var i=r(2*Math.PI);return n>0&&e.length>=n&&(i=e[n-1].endAngle),{startAngle:i,endAngle:i}}).transition().duration(p).attrTween("d",a).remove()},!0)}}return t.factory=function(){var e=function(){return new t};return e.$inject=[],e},t}();e.DashboardChartDirective=t}(Sfx||(Sfx={}));var Sfx;!function(e){!function(){var t=angular.module("directives",["templates","ngAnimate","ngSanitize","ui.bootstrap","dataService"]);t.controller("RefreshSliderController",["storage","$rootScope",e.RefreshSliderController]),t.controller("SplitterController",["storage",e.SplitterController]),t.controller("DetailListController",["$filter","$scope",e.DetailListController]),t.controller("StatusWarningsController",["$scope","data",e.StatusWarningController]),t.directive("sfxSplitter",function(){return new e.SplitterDirective}),t.directive("sfxSlider",function(){return new e.SliderDirective}),t.directive("sfxDetailViewPart",function(){return new e.DetailViewPartDirective}),t.directive("sfxDetailList",function(){return new e.DetailListDirective}),t.directive("sfxDetailListDetailsView",function(){return new e.DetailListDetailsViewDirective}),t.directive("sfxMetricsBarChart",e.MetricsBarChartDirective.factory()),t.directive("sfxDashboard",e.DashboardChartDirective.factory()),t.directive("sfxImageStoreView",function(){return new e.ImageStoreViewDirective}),t.directive("sfxImageStoreFileView",function(){return new e.ImageStoreOptionsViewDirective}),t.directive("sfxTimeline",function(){return new e.TimeLineChartDirective}),t.directive("sfxDoubleSlider",function(){return new e.DoubleSliderDirective}),t.directive("sfxStatusWarnings",function(){return new e.StatusWarningsDirective}),t.directive("sfxThemeImport",["theme",function(t){return{restrict:"A",link:function(n,i,r){$(i).attr("href","css/"+t.getActiveThemeName()+".min.css"),t.subscribe(function(n,r,a){n===e.Constants.ThemeNameMonitorPropertyName&&$(i).attr("href","css/"+t.getActiveThemeName()+".min.css")})}}}]),t.directive("sfxInclude",["$http","$templateCache","$compile",function(e,t,n){return function(i,r,a){i.$watch(a.src,function(a){e.get(a,{cache:t}).success(function(e){var t=r.html(e).contents();n(t)(i)})})}}]),t.directive("sfxBindHtmlCompile",["$compile",function(e){return{restrict:"A",link:function(t,n,i){t.$watch(function(){return t.$eval(i.sfxBindHtmlCompile)},function(r){n.html(r&&r.toString());var a=t;i.bindHtmlScope&&(a=t.$eval(i.bindHtmlScope)),e(n.contents())(a)})}}}]),t.directive("sfxTreeScrollTo",function(){return{restrict:"A",link:function(e,t,n){n.$observe("selected",function(i){if("true"===i)var r=e.$watch(function(){return $(t).is(":visible")},function(e){if(e){var i=$("."+n.scrollParent),a=$(t).offset().top-i.offset().top,o=i.scrollTop(),s=i.innerHeight();a-5<0?i.scrollTop(o+a-5):a+30>s&&i.scrollTop(o+a-s+30),r()}})})}}}),t.directive("sfxTreeSetFocus",["$timeout","clusterTree",function(e,t){return{restrict:"A",link:function(n,i,r){r.$observe("selected",function(n){if(t.setFirstVisit())return void(t.tree.firstTreeSelect=!1);"true"===n&&e(function(){$(".self:first",i).focus()})})}}}]),t.directive("sfxTabSetFocus",["$timeout","controllerManager",function(e,t){return{restrict:"A",link:function(n,i,r){r.$observe("active",function(n){if(t.firstPageLoad)return void(t.firstPageLoad=!1);"true"===n&&e(function(){0===$(":focus").length&&$(i).focus()},100)})}}}]),t.directive("sfxTreeNode",function(){return{restrict:"A",replace:!0,templateUrl:"partials/tree-node.html",scope:{node:"="}}}),t.directive("sfxReplicaAddress",function(){return{restrict:"E",replace:!0,templateUrl:"partials/replica-address.html",scope:{address:"="},link:function(e,t,n){e.$watch("address",function(){e.isString=_.isString(e.address)})}}}),t.directive("sfxBadge",function(){return{restrict:"E",replace:!0,templateUrl:"partials/badge.html",scope:{badgeClass:"=",text:"="}}}),t.directive("sfxDetailViewNavbar",function(){return{restrict:"E",replace:!0,scope:{mainViewCtrl:"=ctrl",actions:"=",type:"@",name:"@"},transclude:!0,templateUrl:"partials/detail-view-navbar.html"}}),t.directive("sfxCandybarCompact",function(){return{restrict:"E",replace:!0,scope:{viewPath:"@",item:"="},templateUrl:"partials/candybar-compact.html"}}),t.directive("sfxSearchBar",function(){return{restrict:"E",replace:!0,scope:{placeholder:"@",reset:"&?",model:"=",customClass:"@"},templateUrl:"partials/search-bar.html",link:function(e,t,n){e.$watch("model",function(e,n){n&&!e&&$(t).find("input").focus()})}}}),t.directive("sfxPager",function(){return{restrict:"AE",scope:{list:"=",listSettings:"="},templateUrl:"partials/pager.html",link:function(e,t,n){e.$watchGroup(["list","list.length"],function(t,n){e.list&&(e.listSettings.count=e.list.length)})}}}),t.directive(_.camelCase(e.Constants.DirectiveNameUpgradeProgress),function(){return{restrict:"E",scope:{upgradeDomains:"="},templateUrl:"partials/upgrade-progress.html"}}),t.directive("sfxUpgradeDomainProgress",function(){return{restrict:"E",scope:{nodeUpgradeProgressList:"="},templateUrl:"partials/upgrade-domain-progress.html"}}),t.directive(_.camelCase(e.Constants.DirectiveNameActionsRow),function(){return{restrict:"E",replace:!0,scope:{actions:"=",source:"@"},templateUrl:"partials/actions-row.html"}}),t.directive("sfxMetricsView",function(){return{restrict:"AE",replace:!0,scope:{metrics:"=",listSettings:"="},templateUrl:"partials/metrics-view.html"}}),t.directive("sfxEventsView",function(){return new e.EventsViewDirective}),t.directive("sfxTextFileInput",function(){return new e.TextFileInputDirective}),t.directive("sfxDatePicker",function(){return new e.DatePickerDirective}),t.directive("sfxDateTimePicker",function(){return new e.DateTimePickerDirective}),t.directive("sfxListShorten",function(){return{restrict:"E",replace:!0,scope:{list:"="},templateUrl:"partials/long-list-shorten.html",link:function(e,t,n){e.opened=!1,e.flip=function(){e.opened=!e.opened}}}}),t.directive("sfxClipBoard",function(){return{restrict:"E",replace:!0,scope:{text:"=",nestedText:"=",nestedTextProperty:"=",encoded:"="},templateUrl:"partials/copy-to-clipboard.html",link:function(e,t,n){e.copy=function(){try{var t=$("<textarea>");$("body").append(t);var n=e.nestedTextProperty?e.nestedText[e.nestedTextProperty]:e.text;e.encoded&&(n=decodeURI(n)),t.val(n).select(),document.execCommand("copy"),t.remove()}catch(e){}}}}})}()}(Sfx||(Sfx={}));var Sfx;!function(e){!function(){var t=angular.module("filters",[]);t.filter("trim",[function(){return function(e){return(e||"").replace(/(^\s*|\s*$)/g,function(e,t){return""})}}]),t.filter("warningPrefix",[function(){return function(t){return t===e.StatusWarningLevel.Warning?"Warning":t===e.StatusWarningLevel.Error?"Error":"Info"}}])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e){this.$injector=e,this.routes=this.$injector.get("routes"),this.message=this.$injector.get("message"),this.telemetry=this.$injector.get("telemetry"),this.settings=this.$injector.get("settings"),this.data=this.$injector.get("data"),this.authSvc=this.$injector.get("auth"),this.storage=this.$injector.get("storage"),this.$location=this.$injector.get("$location"),this.$q=this.$injector.get("$q"),this.$route=this.$injector.get("$route"),this.$injector.get("controllerManager").registerController(this)}return Object.defineProperty(e.prototype,"routeParams",{get:function(){return this.$route.current.params},enumerable:!0,configurable:!0}),e.prototype.refresh=function(e){return this.$q.when(!0)},e}();e.ControllerBase=t;var n=function(t){function n(n){var i=t.call(this,n)||this;return i.valueResolver=new e.ValueResolver,i}return __extends(n,t),n}(t);e.ControllerWithResolver=n;var i=function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t)||this;return i.tabs=n,i.setActiveTab(),i}return __extends(t,e),Object.defineProperty(t.prototype,"hasTabs",{get:function(){return _.size(this.tabs)>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstTabId",{get:function(){return _.keys(this.tabs)[0]},enumerable:!0,configurable:!0}),t.prototype.navigateToTab=function(e){t.LastVisitedTabId=null,t.LastVisitedTemplateUrl=null,this.$location.path(this.getTabViewPath(e))},t.prototype.isActiveTab=function(e){return this.activeTabId===e},t.prototype.refresh=function(e){var t=this;return this.authSvc.isApplicationBootstrapped?(this.refreshingPromise||(this.refreshingPromise=this.refreshCommon(e).then(function(){if(t.hasTabs&&t.tabs[t.activeTabId]&&t.tabs[t.activeTabId].refresh)return t.tabs[t.activeTabId].refresh(e)}).finally(function(){t.refreshingPromise=null})),this.refreshingPromise):this.$q.reject()},t.prototype.refreshCommon=function(e){return this.$q.when(!0)},t.prototype.setActiveTab=function(){this.basePath=this.getBasePath();var e=this.routeParams.tabId;e?this.activeTabId=e:this.hasTabs&&(t.LastVisitedTabId&&t.LastVisitedTabId!==this.firstTabId&&this.$route.current.templateUrl===t.LastVisitedTemplateUrl&&this.tabs[t.LastVisitedTabId]?this.navigateToTab(t.LastVisitedTabId):this.activeTabId=this.firstTabId),t.LastVisitedTabId=this.activeTabId,t.LastVisitedTemplateUrl=this.$route.current.templateUrl,this.telemetry.trackPageView()},t.prototype.getBasePath=function(){return _.trimEnd(this.$location.path().replace(/\/tab\/.*/,""),"/")},t.prototype.getTabViewPath=function(e){return e===this.firstTabId?this.basePath:this.basePath+"/tab/"+e},t}(n);e.TabController=i;var r=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.clusterTree=e.get("clusterTree"),e.get("controllerManager").registerMainController(i),i.switchThemeIfDetected(),i}return __extends(n,t),n.prototype.selectTreeNode=function(e){return this.clusterTree.selectTreeNode(e,!0)},n.prototype.switchThemeIfDetected=function(){if(this.routeParams.theme_source&&this.routeParams.theme_name){if(this.telemetry.trackEvent("Theme external source: "+this.routeParams.theme_source+"/"+this.routeParams.theme_name),!this.storage.isDefined(e.Constants.ThemeNameStorageKey)){this.$injector.get("theme").resolveAndChangeToTheme(this.routeParams.theme_source,this.routeParams.theme_name)}this.$location.search(e.Constants.ThemeSourceQueryStringName,null),this.$location.search(e.Constants.ThemeNameQueryStringName,null)}},n}(i);e.MainViewController=r}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n){var i=t.call(this,e)||this;return i.$rootScope=n,i}return __extends(n,t),Object.defineProperty(n.prototype,"isApplicationBootstrapped",{get:function(){return this.authSvc.isApplicationBootstrapped},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isAadAuthenticated",{get:function(){return this.authSvc.isAadAuthenticated},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStandalone",{get:function(){return e.StandaloneIntegration.isStandalone()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"userName",{get:function(){if(this.$rootScope.userInfo){if(this.$rootScope.userInfo.profile&&this.$rootScope.userInfo.profile.name)return this.$rootScope.userInfo.profile.name;if(this.$rootScope.userInfo.userName)return this.$rootScope.userInfo.userName}return""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"brandTitle",{get:function(){var t="Service Fabric Explorer";if(this.isStandalone){t=new URL(e.StandaloneIntegration.clusterUrl).hostname}return t},enumerable:!0,configurable:!0}),n.prototype.logOut=function(){this.authSvc.logOut()},n}(e.ControllerWithResolver);e.AuthenticationController=t,function(){angular.module("authenticationController",[]).controller("AuthenticationController",["$injector","$rootScope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n){var i=t.call(this,n)||this;return i.advancedModeState=i.storage.getValueBoolean(e.Constants.AdvancedModeKey,!1),i}return __extends(n,t),n.prototype.setPaginationLimit=function(e){this.settings.paginationLimit=e},n.prototype.setAdvancedMode=function(){var t=this;this.storage.setValue(e.Constants.AdvancedModeKey,this.advancedModeState),this.data.getNodes().then(function(e){e.setAdvancedMode(t.advancedModeState)})},n}(e.ControllerWithResolver);e.SettingsController=t,function(){angular.module("settingsController",["settingsService","storageService","dataService"]).controller("SettingsController",["$injector","settings","storage","data",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(e){function t(t,n){var i=e.call(this,t)||this;return i.themeSvc=n,i}return __extends(t,e),t.prototype.getActiveThemeName=function(){return this.themeSvc.getActiveThemeName()},t.prototype.changeToTheme=function(e){this.themeSvc.changeToTheme(e,!0)},t}(e.ControllerWithResolver);e.ThemeController=t,function(){angular.module("themeController",["themeService"]).controller("ThemeController",["$injector","theme",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e,t,n){e.action=n,e.ok=function(){t.close()},e.cancel=function(){t.dismiss()}}return e.$inject=["$scope","$uibModalInstance","action"],e}();e.ActionController=t,function(){angular.module("actionController",[]).controller("ActionController",["$scope","$uibModalInstance","action",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n.treeService=t.get("clusterTree"),n}return __extends(t,e),Object.defineProperty(t.prototype,"tree",{get:function(){return this.treeService.tree},enumerable:!0,configurable:!0}),t.prototype.enterBeta=function(){var e=location.href.replace("old.html","index.html");window.location.assign(e)},t}(e.ControllerWithResolver);e.TreeViewController=t,function(){angular.module("treeViewController",[]).controller("TreeViewController",["$injector",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"}})||this;return r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.tabs.details.refresh=function(e){return r.refreshDetails(e)},r.appTypeName=e.IdUtils.getAppTypeName(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.appGroup(),e.IdGenerator.appType(r.appTypeName)]),r.$scope.appTypesListSettings=r.settings.getNewOrExistingListSettings("appTypeAppTypes",["raw.Version"],[new e.ListColumnSetting("name","Name"),new e.ListColumnSetting("raw.Version","Version"),new e.ListColumnSettingWithFilter("raw.Status","Status"),new e.ListColumnSetting("actions","Actions",null,!1,function(t){return"<"+e.Constants.DirectiveNameActionsRow+' actions="item.actions" source="serviceTypesTable"></'+e.Constants.DirectiveNameActionsRow+">"})],[new e.ListColumnSetting("placeholder","placeholder",null,!1),new e.ListColumnSetting("raw.StatusDetails","Status Details",null,!1,function(t){return e.HtmlUtils.getSpanWithCustomClass("preserve-whitespace-wrap",t.raw.StatusDetails)},100)],!1,function(e){return e.raw.StatusDetails},!1),r.$scope.appsListSettings=r.settings.getNewOrExistingListSettings("appTypeApps",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("raw.TypeName","Application Type"),new e.ListColumnSetting("raw.TypeVersion","Version"),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSettingWithFilter("raw.Status","Status")]),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getAppTypeGroup(this.appTypeName,!0).then(function(e){t.$scope.appTypeGroup=e})},n.prototype.refreshEssentials=function(e){return this.data.getApps(!0,e)},n.prototype.refreshDetails=function(e){var t=this;return this.$q.all(_.map(this.$scope.appTypeGroup.appTypes,function(n){return n.serviceTypes.refresh(e).then(function(){return t.$q.all(_.map(n.serviceTypes.collection,function(t){return t.manifest.refresh(e)}))})}))},n}(e.MainViewController);e.AppTypeViewController=t,function(){angular.module("appTypeViewController",["ngRoute","dataService"]).controller("AppTypeViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},deployments:{name:"Deployments",superscriptClass:"tab-superscript-badge-container"},manifest:{name:"Manifest"},events:{name:"Events"}})||this;return r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.tabs.manifest.refresh=function(e){return r.refreshManifest(e)},r.tabs.events.refresh=function(e){return r.refreshEvents(e)},r.appId=e.IdUtils.getAppId(r.routeParams),r.appTypeName=e.IdUtils.getAppTypeName(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.appGroup(),e.IdGenerator.appType(r.appTypeName),e.IdGenerator.app(r.appId)]),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("services",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("raw.TypeName","Service Type"),new e.ListColumnSetting("raw.ManifestVersion","Version"),new e.ListColumnSettingWithFilter("raw.ServiceKind","Service Kind"),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSettingWithFilter("raw.ServiceStatus","Status")]),r.$scope.deployedApplicationsHealthStatesListSettings=r.settings.getNewOrExistingListSettings("deployedApps",["raw.NodeName"],[new e.ListColumnSettingForLink("raw.NodeName","Node Name",function(e){return e.viewPath}),new e.ListColumnSettingForBadge("healthState","Health State")]),r.$scope.serviceTypesListSettings=r.settings.getNewOrExistingListSettings("serviceTypes",["raw.ServiceTypeDescription.ServiceTypeName"],[new e.ListColumnSetting("raw.ServiceTypeDescription.ServiceTypeName","Service Type Name"),new e.ListColumnSettingWithFilter("serviceKind","Service Kind"),new e.ListColumnSetting("raw.ServiceManifestVersion","Service Manifest Version"),new e.ListColumnSetting("actions","Actions",null,!1,function(t){return"<"+e.Constants.DirectiveNameActionsRow+' actions="item.actions" source="serviceTypesTable"></'+e.Constants.DirectiveNameActionsRow+">"})]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.$scope.upgradeProgressUnhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings("upgradeProgressUnhealthyEvaluations"),r.$scope.appEvents=r.data.createApplicationEventList(r.appId),r.$scope.networkListSettings=r.settings.getNewOrExistingListSettings("networks",["networkDetail.name"],[new e.ListColumnSettingForLink("networkDetail.name","Network Name",function(e){return e.viewPath}),new e.ListColumnSetting("networkDetail.type","Network Type"),new e.ListColumnSetting("networkDetail.addressPrefix","Network Address Prefix"),new e.ListColumnSetting("networkDetail.status","Network Status")]),r.$scope.applicationBackupConfigurationInfoListSettings=r.settings.getNewOrExistingListSettings("backupConfigurationInfoCollection",["raw.PolicyName"],[new e.ListColumnSetting("raw.PolicyName","Policy Name",["raw.PolicyName"],!1,function(e,t){return"<a href='"+e.parent.viewPath+"/tab/details'>"+t+"</a>"},1,function(e){return e.action.runWithCallbacks.apply(e.action)}),new e.ListColumnSetting("raw.Kind","Kind"),new e.ListColumnSetting("raw.PolicyInheritedFrom","Policy Inherited From"),new e.ListColumnSetting("raw.ServiceName","Service Name"),new e.ListColumnSetting("raw.PartitionId","Partition Id"),new e.ListColumnSetting("raw.SuspensionInfo.IsSuspended","Is Suspended"),new e.ListColumnSetting("raw.SuspensionInfo.SuspensionInheritedFrom","Suspension Inherited From")]),r.$scope.clusterManifest=new e.ClusterManifest(r.data),r.$scope.networks=new e.NetworkOnAppCollection(r.data,r.appId),r.$scope.timelineGenerator=new e.ApplicationTimelineGenerator,r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(t){var n=this;return this.$q.all([this.data.getApp(this.appId,!0,t).then(function(i){return n.$scope.app=i,n.$scope.clusterManifest.ensureInitialized().then(function(){n.$scope.clusterManifest.isBRSEnabled&&(n.$scope.app.applicationBackupConfigurationInfoCollection.refresh(t),n.data.backupPolicies.refresh(t))}),n.$scope.app.health.refresh(t).then(function(){n.$scope.deployedApplicationsHealthStates=n.$scope.app.health.deployedApplicationHealthStates,n.$scope.app.health.deploymentsHealthState.text!==e.HealthStateConstants.OK?n.tabs.deployments.superscriptInHtml=function(){return'<image class="tab-superscript-badge" src="images/'+n.$scope.app.health.deploymentsHealthState.badgeClass+'.svg"></image>'}:n.tabs.deployments.superscriptInHtml=null})}),this.$scope.clusterManifest.ensureInitialized(!1)])},n.prototype.refreshEssentials=function(e){var t=this;return this.$q.all([this.$scope.app.upgradeProgress.refresh(e).then(function(e){t.$scope.upgradeProgress=e}),this.$scope.app.serviceTypes.refresh(e),this.$scope.app.services.refresh(e),this.$scope.clusterManifest.isNetworkInventoryManagerEnabled?this.$scope.networks.refresh(e):this.$q.when(!0)])},n.prototype.refreshManifest=function(e){return this.$scope.app.manifest.refresh(e)},n.prototype.refreshEvents=function(t){return this.$scope.appEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},n}(e.MainViewController);e.AppViewController=t,function(){angular.module("appViewController",["ngRoute","dataService"]).controller("AppViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},metrics:{name:"Metrics"},clustermap:{name:"Cluster Map"},imagestore:{name:"Image Store"},manifest:{name:"Manifest"},events:{name:"Events"},backupPolicies:{name:"Backups"}})||this;return r.$scope=i,i.actions=new e.ActionCollection(r.data.telemetry,r.data.$q),r.data.actionsEnabled()&&r.setupActions(),r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.tabs.details.refresh=function(e){return r.refreshDetails(e)},r.tabs.clustermap.refresh=function(e){return r.refreshClusterMap(e)},r.tabs.metrics.refresh=function(e){return r.refreshMetrics(e)},r.tabs.manifest.refresh=function(e){return r.refreshManifest(e)},r.tabs.imagestore.refresh=function(e){return r.refreshImageStore(e)},r.tabs.events.refresh=function(e){return r.refreshEvents(e)},r.tabs.backupPolicies.refresh=function(e){return r.refreshBackupPolicies(e)},i.clusterAddress=r.$location.protocol()+"://"+r.$location.host(),r.selectTreeNode([e.IdGenerator.cluster()]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.$scope.upgradeProgressUnhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings("clusterUpgradeProgressUnhealthyEvaluations"),r.$scope.nodeStatusListSettings=r.settings.getNewOrExistingNodeStatusListSetting(),r.$scope.backupPolicyListSettings=r.settings.getNewOrExistingBackupPolicyListSettings(),r.$scope.clusterHealth=r.data.getClusterHealth(e.HealthStateFilterFlags.Default,e.HealthStateFilterFlags.None,e.HealthStateFilterFlags.None),r.$scope.clusterUpgradeProgress=r.data.clusterUpgradeProgress,r.$scope.clusterLoadInformation=r.data.clusterLoadInformation,r.$scope.clusterManifest=r.data.clusterManifest,r.$scope.systemApp=r.data.systemApp,r.$scope.nodes=r.data.nodes,r.$scope.appsUpgradeTabViewPath=r.routes.getTabViewPath(r.routes.getAppsViewPath(),"upgrades"),r.$scope.imageStore=r.data.imageStore,r.$scope.clusterEvents=r.data.createClusterEventList(),r.$scope.nodesStatuses=[],r.$scope.backupPolicies=r.data.backupPolicies,r.$scope.settings=r.settings,r.$scope.clusterTimelineGenerator=new e.ClusterTimelineGenerator,r.refresh(),r.$scope.clusterManifest.ensureInitialized().then(function(){r.$scope.clusterManifest.isBRSEnabled||delete r.tabs.backupPolicies}),r.$scope.nodes.refresh().then(function(){r.$scope.clusterManifest.ensureInitialized().then(function(){r.$scope.clusterManifest.isSfrpCluster&&r.$scope.nodes.checkSeedNodeCount(5)})}),r}return __extends(i,t),i.prototype.getNodesForDomains=function(e,t){return _.filter(this.$scope.nodes.collection,function(n){return n.upgradeDomain===e&&n.faultDomain===t})},i.prototype.refreshEssentials=function(t){var n=this,i=[];return i.push(this.$scope.clusterHealth.refresh(t).then(function(t){var i=t.getHealthStateCount(e.HealthStatisticsEntityKind.Node);n.$scope.nodesDashboard=e.DashboardViewModel.fromHealthStateCount("Nodes","Node",!0,i,n.data.routes,n.routes.getNodesViewPath());var r=t.getHealthStateCount(e.HealthStatisticsEntityKind.Application);n.$scope.appsDashboard=e.DashboardViewModel.fromHealthStateCount("Applications","Application",!0,r,n.data.routes,n.routes.getAppsViewPath());var a=t.getHealthStateCount(e.HealthStatisticsEntityKind.Service);n.$scope.servicesDashboard=e.DashboardViewModel.fromHealthStateCount("Services","Service",!1,a);var o=t.getHealthStateCount(e.HealthStatisticsEntityKind.Partition);n.$scope.partitionsDashboard=e.DashboardViewModel.fromHealthStateCount("Partitions","Partition",!1,o);var s=t.getHealthStateCount(e.HealthStatisticsEntityKind.Replica);n.$scope.replicasDashboard=e.DashboardViewModel.fromHealthStateCount("Replicas","Replica",!1,s),t.checkExpiredCertStatus()})),i.push(this.data.getApps(!0,t).then(function(e){n.$scope.upgradeAppsCount=_.filter(e.collection,function(e){return e.isUpgrading}).length})),i.push(this.$scope.nodes.refresh(t)),i.push(this.$scope.systemApp.refresh(t)),i.push(this.$scope.clusterUpgradeProgress.refresh(t)),this.$q.all(i)},i.prototype.refreshClusterMap=function(e){return this.$scope.nodes.refresh(e)},i.prototype.refreshDetails=function(e){var t=this;return this.$q.all([this.$scope.clusterHealth.refresh(e),this.$scope.clusterUpgradeProgress.refresh(e),this.$scope.clusterLoadInformation.refresh(e),this.$scope.nodes.refresh(e).then(function(){t.$scope.nodesStatuses=t.$scope.nodes.getNodeStateCounts()})])},i.prototype.refreshMetrics=function(e){var t=this
;return this.$q.all([this.$scope.nodes.refresh(e),this.$scope.clusterLoadInformation.refresh(e)]).then(function(){t.$scope.metricsViewModel||(t.$scope.metricsViewModel=t.settings.getNewOrExistingMetricsViewModel(t.$scope.clusterLoadInformation,_.map(t.$scope.nodes.collection,function(e){return e.loadInformation})));var n=_.map(t.$scope.nodes.collection,function(t){return t.loadInformation.refresh(e)});return t.$q.all(n).finally(function(){t.$scope.metricsViewModel.refresh()})})},i.prototype.refreshManifest=function(e){return this.$scope.clusterManifest.refresh(e)},i.prototype.refreshEvents=function(t){return this.$scope.clusterEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},i.prototype.refreshImageStore=function(e){return this.$scope.imageStore.refresh(e)},i.prototype.refreshBackupPolicies=function(e){return this.$scope.backupPolicies.refresh(e)},i.prototype.setupActions=function(){this.$scope.actions.add(new n(this.data))},i}(e.MainViewController);e.ClusterViewController=t;var n=function(t){function n(n){var i=t.call(this,n.$uibModal,n.$q,"createBackupPolicy","Create Backup Policy","Creating",function(){return i.createBackupPolicy(n)},function(){return!0},{templateUrl:"partials/create-backup-policy-dialog.html",controller:e.ActionController,resolve:{action:function(){return i}}},null)||this;return i.retentionPolicyRequired=!1,i.date="",i.weekDay=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],i.daySelectedMapping={},setInterval(function(){},2e3),i}return __extends(n,t),n.prototype.add=function(){null!==this.backupPolicy.Schedule.RunTimes&&void 0!==this.backupPolicy.Schedule.RunTimes||(this.backupPolicy.Schedule.RunTimes=[]),this.backupPolicy.Schedule.RunTimes.push(this.date),this.date=""},n.prototype.deleteDate=function(e){this.backupPolicy.Schedule.RunTimes.splice(e,1)},n.prototype.createBackupPolicy=function(e){if(this.retentionPolicyRequired?(this.RetentionPolicy.RetentionPolicyType="Basic",this.backupPolicy.RetentionPolicy=this.RetentionPolicy):this.backupPolicy.RetentionPolicy=null,"TimeBased"===this.backupPolicy.Schedule.ScheduleKind&&"Weekly"===this.backupPolicy.Schedule.ScheduleFrequencyType){this.backupPolicy.Schedule.RunDays=[];for(var t=0,n=this.weekDay;t<n.length;t++){var i=n[t];this.daySelectedMapping[i]&&this.backupPolicy.Schedule.RunDays.push(i)}}return e.restClient.createBackupPolicy(this.backupPolicy)},n}(e.ActionWithDialog);e.ActionCreateBackupPolicy=n;var i=function(t){function n(n,i){var r=t.call(this,n.$uibModal,n.$q,"updateBackupPolicy","Update Backup Policy","Updating",function(){return r.updateBackupPolicy(n)},function(){return!0},{templateUrl:"partials/update-backup-policy-dialog.html",controller:e.ActionController,resolve:{action:function(){return r}}},null)||this;if(r.retentionPolicyRequired=!1,r.date="",r.weekDay=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r.daySelectedMapping={},r.backupPolicy=i,r.backupPolicy.RetentionPolicy&&(r.retentionPolicyRequired=!0,r.RetentionPolicy=r.backupPolicy.RetentionPolicy),r.backupPolicy.Schedule.RunDays)for(var a=0,o=r.backupPolicy.Schedule.RunDays;a<o.length;a++){var s=o[a];r.daySelectedMapping[s]=!0}return r.delete=function(){n.restClient.deleteBackupPolicy(r.backupPolicy.Name)},r}return __extends(n,t),n.prototype.add=function(){null!==this.backupPolicy.Schedule.RunTimes&&void 0!==this.backupPolicy.Schedule.RunTimes||(this.backupPolicy.Schedule.RunTimes=[]),this.backupPolicy.Schedule.RunTimes.push(this.date),this.date=""},n.prototype.deleteDate=function(e){this.backupPolicy.Schedule.RunTimes.splice(e,1)},n.prototype.updateBackupPolicy=function(e){if(this.retentionPolicyRequired?(this.RetentionPolicy.RetentionPolicyType="Basic",this.backupPolicy.RetentionPolicy=this.RetentionPolicy):this.backupPolicy.RetentionPolicy=null,"TimeBased"===this.backupPolicy.Schedule.ScheduleKind&&"Weekly"===this.backupPolicy.Schedule.ScheduleFrequencyType){this.backupPolicy.Schedule.RunDays=[];for(var t=0,n=this.weekDay;t<n.length;t++){var i=n[t];this.daySelectedMapping[i]&&this.backupPolicy.Schedule.RunDays.push(i)}}return e.restClient.updateBackupPolicy(this.backupPolicy)},n}(e.ActionWithDialog);e.ActionUpdateBackupPolicy=i,function(){angular.module("clusterViewController",["dataService","filters"]).controller("ClusterViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"}})||this;return r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.appId=e.IdUtils.getAppId(r.routeParams),r.nodeName=e.IdUtils.getNodeName(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup(),e.IdGenerator.node(r.nodeName),e.IdGenerator.deployedApp(r.appId)]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("servicePackages",["name"],[new e.ListColumnSettingForLink("uniqueId","Name",function(e){return e.viewPath}),new e.ListColumnSetting("raw.Version","Version"),new e.ListColumnSettingForBadge("health.healthState","Health State"),new e.ListColumnSettingWithFilter("raw.Status","Status")]),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getDeployedApplication(this.nodeName,this.appId,!0).then(function(n){return t.$scope.deployedApp=n,t.$scope.deployedApp.health.refresh(e)})},n.prototype.refreshEssentials=function(e){var t=this;return this.$scope.deployedApp.deployedServicePackages.refresh(e).then(function(e){t.$scope.deployedServicePackages=e})},n}(e.MainViewController);e.DeployedAppViewController=t,function(){angular.module("deployedAppViewController",["ngRoute","dataService"]).controller("DeployedAppViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},containerLogs:{name:"Container Logs"}})||this;return r.$scope=i,r.tabs.containerLogs.refresh=function(e){return r.refreshContainerLogs(e)},r.nodeName=e.IdUtils.getNodeName(r.routeParams),r.appId=e.IdUtils.getAppId(r.routeParams),r.serviceId=e.IdUtils.getServiceId(r.routeParams),r.activationId=e.IdUtils.getServicePackageActivationId(r.routeParams),r.codePackageName=e.IdUtils.getCodePackageName(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup(),e.IdGenerator.node(r.nodeName),e.IdGenerator.deployedApp(r.appId),e.IdGenerator.deployedServicePackage(r.serviceId,r.activationId),e.IdGenerator.deployedCodePackageGroup(),e.IdGenerator.deployedCodePackage(r.codePackageName)]),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(t){var n=this;return this.data.getDeployedCodePackage(this.nodeName,this.appId,this.serviceId,this.activationId,this.codePackageName,!0,t).then(function(t){n.$scope.deployedCodePackage=t,t.raw.HostType!==e.Constants.ContainerHostTypeName&&delete n.tabs.containerLogs})},n.prototype.refreshContainerLogs=function(e){var t=this;return this.$scope.deployedCodePackage.containerLogs.refresh(e).then(function(e){t.$scope.containerLogs=e.raw.Content})},n}(e.MainViewController);e.DeployedCodePackageViewController=t,function(){angular.module("deployedCodePackageViewController",["ngRoute","dataService"]).controller("DeployedCodePackageViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"}})||this;return r.$scope=i,r.tabs.details.refresh=function(e){return r.refreshDetails(e)},r.nodeName=e.IdUtils.getNodeName(r.routeParams),r.serviceId=e.IdUtils.getServiceId(r.routeParams),r.activationId=e.IdUtils.getServicePackageActivationId(r.routeParams),r.partitionId=e.IdUtils.getPartitionId(r.routeParams),r.applicationId=e.IdUtils.getAppId(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup(),e.IdGenerator.node(r.nodeName),e.IdGenerator.deployedApp(e.IdUtils.getAppId(r.routeParams)),e.IdGenerator.deployedServicePackage(r.serviceId,r.activationId),e.IdGenerator.deployedReplicaGroup(),e.IdGenerator.deployedReplica(r.partitionId)]),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getDeployedReplica(this.nodeName,this.applicationId,this.serviceId,this.activationId,this.partitionId,!0,e).then(function(e){t.$scope.replica=e;var n=t.$scope.replica.parent,i=n.parent,r=encodeURI(t.$scope.replica.raw.ServiceName.replace("fabric:/",""));t.$scope.appView=t.data.routes.getReplicaViewPath(i.raw.TypeName,i.raw.Id,r,t.$scope.replica.raw.PartitionId,t.$scope.replica.id)})},n.prototype.refreshDetails=function(e){return this.$scope.replica.detail.refresh(e)},n}(e.MainViewController);e.DeployedReplicaViewController=t,function(){angular.module("deployedReplicaViewController",["ngRoute","dataService"]).controller("DeployedReplicaViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},manifest:{name:"Manifest"}})||this;return r.$scope=i,r.tabs.manifest.refresh=function(e){return r.refreshManifest(e)},r.serviceId=e.IdUtils.getServiceId(r.routeParams),r.activationId=e.IdUtils.getServicePackageActivationId(r.routeParams),r.nodeName=e.IdUtils.getNodeName(r.routeParams),r.appId=e.IdUtils.getAppId(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup(),e.IdGenerator.node(r.nodeName),e.IdGenerator.deployedApp(r.appId),e.IdGenerator.deployedServicePackage(r.serviceId,r.activationId)]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.$q.all([this.data.getDeployedServicePackage(this.nodeName,this.appId,this.serviceId,this.activationId,!0,e).then(function(n){return t.$scope.servicePackage=n,t.$scope.servicePackage.health.refresh(e)})])},n.prototype.refreshManifest=function(e){var t=this;return this.$scope.servicePackage.manifest.refresh(e).then(function(e){t.$scope.serviceManifest=e.raw.Manifest})},n}(e.MainViewController);e.DeployedServiceViewController=t,function(){angular.module("deployedServiceViewController",["ngRoute","dataService"]).controller("DeployedServiceViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n)||this;return r.$scope=i,r.nodeName=e.IdUtils.getNodeName(r.routeParams),r.appId=e.IdUtils.getAppId(r.routeParams),r.serviceId=e.IdUtils.getServiceId(r.routeParams),r.activationId=e.IdUtils.getServicePackageActivationId(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup(),e.IdGenerator.node(r.nodeName),e.IdGenerator.deployedApp(r.appId),e.IdGenerator.deployedServicePackage(r.serviceId,r.activationId),e.IdGenerator.deployedReplicaGroup()]),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(t){var n=this;return this.data.getDeployedReplicas(this.nodeName,this.appId,this.serviceId,this.activationId,!0,t).then(function(t){if(n.$scope.replicas=t,!n.$scope.listSettings&&t.length>0){var i=_.first(t.collection),r=["replicaRoleSortPriority","id"],a=[new e.ListColumnSettingForLink("id","Id",function(e){return e.viewPath}),new e.ListColumnSetting("raw.PartitionId","Partition Id"),new e.ListColumnSettingWithFilter("raw.ServiceKind","Service Kind"),new e.ListColumnSettingWithFilter("role","Replica Role",r),new e.ListColumnSettingWithFilter("raw.ReplicaStatus","Status")];i.isStatelessService&&(a.splice(3,1),r=["id"]),_.some(t.collection,function(e){return e.servicePackageActivationId})&&a.splice(1,0,new e.ListColumnSetting("servicePackageActivationId","Service Package Activation Id")),n.$scope.listSettings=n.settings.getNewOrExistingListSettings("replicas",r,a)}})},n}(e.MainViewController);e.DeployedServiceReplicasViewController=t,function(){angular.module("deployedServiceReplicasViewController",[]).controller("DeployedServiceReplicasViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n)||this;return r.$scope=i,r.nodeName=e.IdUtils.getNodeName(r.routeParams),r.appId=e.IdUtils.getAppId(r.routeParams),r.serviceId=e.IdUtils.getServiceId(r.routeParams),r.activationId=e.IdUtils.getServicePackageActivationId(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup(),e.IdGenerator.node(r.nodeName),e.IdGenerator.deployedApp(e.IdUtils.getAppId(r.routeParams)),e.IdGenerator.deployedServicePackage(r.serviceId,r.activationId),e.IdGenerator.deployedCodePackageGroup()]),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(t){var n=this;return this.data.getDeployedCodePackages(this.nodeName,this.appId,this.serviceId,this.activationId,!0,t).then(function(t){if(n.$scope.codePackages=t,!n.$scope.listSettings&&t.length>0){var i=[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSettingWithFilter("raw.HostType","Host Type"),new e.ListColumnSettingWithFilter("raw.HostIsolationMode","Host Isolation Mode"),new e.ListColumnSetting("raw.Version","Version"),new e.ListColumnSetting("raw.MainEntryPoint.ProcessId","Process Id"),new e.ListColumnSettingWithFilter("raw.Status","Status")];_.some(t.collection,function(e){return e.servicePackageActivationId})&&i.splice(3,0,new e.ListColumnSetting("servicePackageActivationId","Service Package Activation Id")),n.$scope.listSettings=n.settings.getNewOrExistingListSettings("codePkgs",["name"],i)}})},n}(e.MainViewController);e.DeployedServiceCodePackagesViewController=t,function(){angular.module("deployedServiceCodePackagesViewController",[]).controller("DeployedServiceCodePackagesViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e,t,n){this.refreshSvc=e,this.routes=t,this.$window=n}return Object.defineProperty(e.prototype,"isRefreshing",{get:function(){return this.refreshSvc.isRefreshing},enumerable:!0,configurable:!0}),e.prototype.refreshAll=function(){this.refreshSvc.refreshAll()},e.prototype.navigateToCluster=function(){var e=this;this.routes.navigate(function(){return e.routes.getClusterViewPath()})},e}();e.NavbarController=t,function(){angular.module("navbarController",["refreshService","routes"]).controller("NavbarController",["refresh","routes","$window",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{nodes:{name:"All Nodes"},events:{name:"Events"}})||this;return r.$scope=i,r.tabs.events.refresh=function(e){return r.refreshEvents(e)},r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup()]),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("nodes",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("raw.IpAddressOrFQDN","Address"),new e.ListColumnSettingWithFilter("raw.Type","Node Type"),new e.ListColumnSettingWithFilter("raw.UpgradeDomain","Upgrade Domain"),new e.ListColumnSettingWithFilter("raw.FaultDomain","Fault Domain"),new e.ListColumnSettingWithFilter("raw.IsSeedNode","Is Seed Node"),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSettingWithFilter("nodeStatus","Status")]),r.$scope.nodeEvents=r.data.createNodeEventList(null),r.$scope.nodeEventTimelineGenerator=new e.NodeTimelineGenerator,r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getNodes(!0,e).then(function(e){t.$scope.nodes=e})},n.prototype.refreshEvents=function(t){return this.$scope.nodeEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},n}(e.MainViewController);e.NodesViewController=t,function(){angular.module("nodesViewController",[]).controller("NodesViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){!function(e){e[e.Invalid=0]="Invalid",e[e.Up=1]="Up",e[e.Down=2]="Down",e[e.Enabling=3]="Enabling",e[e.Disabling=4]="Disabling",e[e.Disabled=5]="Disabled"}(e.NodeStatus||(e.NodeStatus={}));var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},events:{name:"Events"}})||this;return r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.tabs.details.refresh=function(e){return r.refreshDetails(e)},r.tabs.events.refresh=function(e){return r.refreshEvents(e)},r.nodeName=e.IdUtils.getNodeName(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.nodeGroup(),e.IdGenerator.node(r.nodeName)]),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("apps",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("raw.TypeName","Application Type"),new e.ListColumnSettingForBadge("health.healthState","Health State"),new e.ListColumnSettingWithFilter("raw.Status","Status")]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.$scope.nodeEvents=r.data.createNodeEventList(r.nodeName),r.$scope.nodeEventTimelineGenerator=new e.NodeTimelineGenerator,r.$scope.networkListSettings=r.settings.getNewOrExistingListSettings("networks",["networkDetail.name"],[new e.ListColumnSettingForLink("networkDetail.name","Network Name",function(e){return e.viewPath}),new e.ListColumnSetting("networkDetail.type","Network Type"),new e.ListColumnSetting("networkDetail.addressPrefix","Network Address Prefix"),new e.ListColumnSetting("networkDetail.status","Network Status")]),r.$scope.networks=new e.NetworkOnNodeCollection(r.data,r.nodeName),r.$scope.clusterManifest=new e.ClusterManifest(r.data),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.$q.all([this.data.getNode(this.nodeName,!0,e).then(function(n){return t.$scope.node=n,t.$scope.node.health.refresh(e)}),this.$scope.clusterManifest.ensureInitialized(!1)])},n.prototype.refreshDetails=function(e){return this.$scope.node.loadInformation.refresh(e)},n.prototype.refreshEssentials=function(e){var t=this;return this.$q.all([this.$scope.node.deployedApps.refresh(e).then(function(e){t.$scope.deployedApps=e}),this.$scope.clusterManifest.isNetworkInventoryManagerEnabled?this.$scope.networks.refresh(e):this.$q.when(!0)])},n.prototype.refreshEvents=function(t){return this.$scope.nodeEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},n}(e.MainViewController);e.NodeViewController=t,function(){angular.module("nodeViewController",["ngRoute","dataService"]).controller("NodeViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},events:{name:"Events"},backups:{name:"Backups"}})||this;return r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.tabs.details.refresh=function(e){return r.refreshDetails(e)},r.tabs.events.refresh=function(e){return r.refreshEvents(e)},r.tabs.backups.refresh=function(e){return r.refreshBackups(e)},r.appId=e.IdUtils.getAppId(r.routeParams),r.serviceId=e.IdUtils.getServiceId(r.routeParams),r.partitionId=e.IdUtils.getPartitionId(r.routeParams),r.appTypeName=e.IdUtils.getAppTypeName(r.routeParams),r.appTypeName===e.Constants.SystemAppTypeName?r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.systemAppGroup(),e.IdGenerator.service(r.serviceId),e.IdGenerator.partition(r.partitionId)]):r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.appGroup(),e.IdGenerator.appType(r.appTypeName),e.IdGenerator.app(r.appId),e.IdGenerator.service(r.serviceId),e.IdGenerator.partition(r.partitionId)]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.$scope.partitionEvents=r.data.createPartitionEventList(r.partitionId),r.$scope.partitionTimeLineGenerator=new e.PartitionTimelineGenerator,r.$scope.partitionBackupListSettings=r.settings.getNewOrExistingListSettings("partitionBackups",[null],[new e.ListColumnSetting("raw.BackupId","BackupId",["raw.BackupId"],!1,function(e,t){return'<span class="link"\'>'+t+"</span>"},1,function(e){return e.action.runWithCallbacks.apply(e.action)}),new e.ListColumnSetting("raw.BackupType","BackupType"),new e.ListColumnSetting("raw.EpochOfLastBackupRecord.DataLossVersion","Data Loss Version"),new e.ListColumnSetting("raw.EpochOfLastBackupRecord.ConfigurationVersion","Configuration Version"),new e.ListColumnSetting("raw.LsnOfLastBackupRecord","Lsn of last Backup Record"),new e.ListColumnSetting("raw.CreationTimeUtc","Creation Time Utc")]),r.data.clusterManifest.ensureInitialized().then(function(){r.data.clusterManifest.isBRSEnabled||delete r.tabs.backups}),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(t){var n=this;return this.data.getPartition(this.appId,this.serviceId,this.partitionId,!0,t).then(function(i){if(n.$scope.partition=i,n.data.clusterManifest.ensureInitialized().then(function(){n.data.clusterManifest.isBRSEnabled&&(n.data.backupPolicies.refresh(t),n.$scope.partition.isStatefulService&&n.$scope.partition.partitionBackupInfo.partitionBackupConfigurationInfo.refresh(t))}),(n.$scope.partition.isStatelessService||"System"===i.parent.parent.raw.TypeName)&&(n.tabs={essentials:{name:"Essentials"},details:{name:"Details"},events:{name:"Events"}},n.tabs.essentials.refresh=function(e){return n.refreshEssentials(e)},n.tabs.details.refresh=function(e){return n.refreshDetails(e)},n.tabs.events.refresh=function(e){return n.refreshEvents(e)}),!n.$scope.listSettings){var r=["replicaRoleSortPriority","raw.NodeName"],a=[new e.ListColumnSettingForLink("id","Id",function(e){return e.viewPath}),new e.ListColumnSetting("raw.NodeName","Node Name"),new e.ListColumnSettingWithFilter("role","Replica Role",r),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSettingWithFilter("raw.ReplicaStatus","Status")];i.isStatelessService&&(a.splice(2,1),r=["raw.NodeName"]),n.$scope.listSettings=n.settings.getNewOrExistingListSettings("replicas",r,a)}return n.$scope.partition.health.refresh(t)})},n.prototype.refreshDetails=function(e){var t=this;return this.data.clusterManifest.ensureInitialized().then(function(){t.data.clusterManifest.isBRSEnabled&&(t.$scope.partition.partitionBackupInfo.partitionBackupProgress.refresh(e),t.$scope.partition.partitionBackupInfo.partitionRestoreProgress.refresh(e))}),this.$scope.partition.loadInformation.refresh(e)},n.prototype.refreshEssentials=function(e){var t=this;return this.data.clusterManifest.ensureInitialized().then(function(){t.data.clusterManifest.isBRSEnabled&&t.$scope.partition.isStatefulService&&t.$scope.partition.partitionBackupInfo.latestPartitionBackup.refresh(e)}),this.$scope.partition.replicas.refresh(e)},n.prototype.refreshEvents=function(t){return this.$scope.partitionEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},n.prototype.refreshBackups=function(e){if(this.$scope.partition.isStatefulService)return this.$scope.partition.partitionBackupInfo.partitionBackupList.refresh(e)},n}(e.MainViewController);e.PartitionViewController=t,function(){angular.module("partitionViewController",["ngRoute","dataService"]).controller("PartitionViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},events:{name:"Events"}})||this;r.$scope=i,r.tabs.details.refresh=function(e){return r.refreshDetails(e)},r.tabs.events.refresh=function(e){return r.refreshEvents(e)};var a=r.routeParams;return r.appId=e.IdUtils.getAppId(a),r.serviceId=e.IdUtils.getServiceId(a),r.partitionId=e.IdUtils.getPartitionId(a),r.replicaId=e.IdUtils.getReplicaId(a),r.appTypeName=e.IdUtils.getAppTypeName(a),r.isSystem=r.appTypeName===e.Constants.SystemAppTypeName,r.isSystem?r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.systemAppGroup(),e.IdGenerator.service(r.serviceId),e.IdGenerator.partition(r.partitionId),e.IdGenerator.replica(r.replicaId)]):r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.appGroup(),e.IdGenerator.appType(r.appTypeName),e.IdGenerator.app(r.appId),e.IdGenerator.service(r.serviceId),e.IdGenerator.partition(r.partitionId),e.IdGenerator.replica(r.replicaId)]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.$scope.replicaEvents=r.data.createReplicaEventList(r.partitionId,r.replicaId),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getReplicaOnPartition(this.appId,this.serviceId,this.partitionId,this.replicaId,!0,e).then(function(n){if(t.$scope.replica=n,!t.isSystem)try{t.$scope.replica.detail.refresh(e).then(function(){var e=t.$scope.replica.isStatefulService?"DeployedServiceReplica":"DeployedServiceReplicaInstance",n=t.$scope.replica.detail.raw[e],i=n.ServiceManifestName,r=n.ServicePackageActivationId||null;t.$scope.nodeView=t.data.routes.getDeployedReplicaViewPath(t.$scope.replica.raw.NodeName,t.appId,i,r,t.partitionId,t.replicaId)})}catch(e){}return t.$scope.replica.health.refresh(e)})},n.prototype.refreshDetails=function(e){return this.$scope.replica.detail.refresh(e)},n.prototype.refreshEvents=function(t){return this.$scope.replicaEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},n}(e.MainViewController);e.ReplicaViewController=t,function(){angular.module("replicaViewController",["ngRoute","dataService"]).controller("ReplicaViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"},manifest:{name:"Manifest"},events:{name:"Events"}})||this;r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.tabs.manifest.refresh=function(e){return r.refreshManifest(e)},r.tabs.events.refresh=function(e){return r.refreshEvents(e)};var a=r.routeParams;return r.appTypeName=e.IdUtils.getAppTypeName(a),r.appId=e.IdUtils.getAppId(a),r.serviceId=e.IdUtils.getServiceId(a),r.appTypeName===e.Constants.SystemAppTypeName?(delete r.tabs.manifest,r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.systemAppGroup(),e.IdGenerator.service(r.serviceId)])):r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.appGroup(),e.IdGenerator.appType(r.appTypeName),e.IdGenerator.app(r.appId),e.IdGenerator.service(r.serviceId)]),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("partitions",["id"],[new e.ListColumnSettingForLink("id","Id",function(e){return e.viewPath}),new e.ListColumnSettingWithFilter("partitionInformation.raw.ServicePartitionKind","Partition Kind"),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSettingWithFilter("raw.PartitionStatus","Status")]),r.$scope.serviceBackupConfigurationInfoListSettings=r.settings.getNewOrExistingListSettings("serviceBackupConfigurationInfoListSettings",["raw.PolicyName"],[new e.ListColumnSetting("raw.PolicyName","Policy Name",["raw.PolicyName"],!1,function(e,t){return"<a href='"+e.parent.viewPath+"/tab/details'>"+t+"</a>"},1,function(e){return e.action.runWithCallbacks.apply(e.action)}),new e.ListColumnSetting("raw.Kind","Kind"),new e.ListColumnSetting("raw.PolicyInheritedFrom","Policy Inherited From"),new e.ListColumnSetting("raw.PartitionId","Partition Id"),new e.ListColumnSetting("raw.SuspensionInfo.IsSuspended","Is Suspended"),new e.ListColumnSetting("raw.SuspensionInfo.SuspensionInheritedFrom","Suspension Inherited From")]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.$scope.serviceEvents=r.data.createServiceEventList(r.serviceId),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getService(this.appId,this.serviceId,!0,e).then(function(n){return t.$scope.service=n,t.data.clusterManifest.ensureInitialized().then(function(){t.data.clusterManifest.isBRSEnabled&&(t.data.backupPolicies.refresh(e),t.$scope.service.isStatefulService&&t.$scope.service.serviceBackupConfigurationInfoCollection.refresh(e))}),t.$q.all([t.$scope.service.health.refresh(e),t.$scope.service.description.refresh(e)])})},n.prototype.refreshEssentials=function(e){return this.$scope.service.partitions.refresh(e)},n.prototype.refreshManifest=function(e){var t=this,n=this.$scope.service.parent;return this.data.getServiceType(n.raw.TypeName,n.raw.TypeVersion,this.$scope.service.description.raw.ServiceTypeName,!0,e).then(function(n){return n.manifest.refresh(e).then(function(){t.$scope.serviceManifest=n.manifest.raw.Manifest})})},n.prototype.refreshEvents=function(t){return this.$scope.serviceEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},n}(e.MainViewController);e.ServiceViewController=t,function(){angular.module("serviceViewController",[]).controller("ServiceViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(n,i){var r=t.call(this,n,{applications:{name:"All Applications"},upgrades:{name:"Upgrades in Progress",superscriptClass:"tab-superscript-number"},events:{name:"Events"}})||this;return r.$scope=i,i.actions=new e.ActionCollection(r.data.telemetry,r.data.$q),r.data.actionsEnabled()&&r.setupActions(r.$scope.actions),r.tabs.upgrades.refresh=function(e){return r.refreshUpgradesTab(e)},r.tabs.events.refresh=function(e){return r.refreshEvents(e)},r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.appGroup()]),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("apps",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("raw.TypeName","Application Type"),new e.ListColumnSetting("raw.TypeVersion","Version"),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSettingWithFilter("raw.Status","Status")]),r.$scope.upgradeAppsListSettings=r.settings.getNewOrExistingListSettings("upgrades",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSettingForLink("parent.raw.TypeName","Application Type",function(e){return e.parent.appTypeViewPath}),new e.ListColumnSetting("parent.raw.TypeVersion","Current Version"),new e.ListColumnSetting("raw.TargetApplicationTypeVersion","Target Version"),new e.ListColumnSetting("upgrade","Progress by Upgrade Domain",null,!1,function(t){return e.HtmlUtils.getUpgradeProgressHtml("item.upgradeDomains")}),new e.ListColumnSettingWithFilter("raw.UpgradeState","Upgrade State")]),r.$scope.appEvents=r.data.createApplicationEventList(null),r.refresh(),r}return __extends(i,t),i.prototype.refreshCommon=function(e){var t=this;return this.data.getApps(!0,e).then(function(e){t.$scope.apps=e,t.$scope.apps.upgradingAppCount>0?t.tabs.upgrades.superscriptInHtml=function(){return t.$scope.apps.upgradingAppCount.toString()}:t.tabs.upgrades.superscriptInHtml=null})},i.prototype.refreshUpgradesTab=function(e){var t=this,n=_.map(_.filter(this.$scope.apps.collection,function(e){return e.isUpgrading}),function(t){return t.upgradeProgress.refresh(e)})
;return this.$q.all(n).then(function(){t.$scope.upgradeProgresses=_.map(_.filter(t.$scope.apps.collection,function(e){return e.isUpgrading}),function(e){return e.upgradeProgress})})},i.prototype.setupActions=function(e){e.add(new n(this.data))},i.prototype.refreshEvents=function(t){return this.$scope.appEvents.refresh(new e.EventsStoreResponseMessageHandler(t))},i}(e.MainViewController);e.AppsViewController=t;var n=function(t){function n(n){var i=t.call(this,n.$uibModal,n.$q,"createComposeApplication","Create compose application","Creating",function(){return n.restClient.createComposeDeployment(i.createComposeDeploymentDescription())},function(){return!0},{templateUrl:"partials/create-compose-application-dialog.html",controller:e.ActionController,resolve:{action:function(){return i}}},null)||this;return i.reset(),i}return __extends(n,t),n.prototype.loadComposeFile=function(e){},n.prototype.reset=function(){this.applicationName="",this.composeFileContent="",this.hasRepositoryCredential=!1,this.repositoryUserName="",this.repositoryPassword="",this.passwordEncrypted=!1},n.prototype.createComposeDeploymentDescription=function(){var e={DeploymentName:this.applicationName,ComposeFileContent:this.composeFileContent};return this.hasRepositoryCredential&&(e.RepositoryCredential={RepositoryUserName:this.repositoryUserName,RepositoryPassword:this.repositoryPassword,PasswordEncrypted:this.passwordEncrypted}),e},n}(e.ActionWithDialog);e.ActionCreateComposeApplication=n,function(){angular.module("appsViewController",["ngRoute","dataService"]).controller("AppsViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"},details:{name:"Details"}})||this;return r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.systemAppGroup()]),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("systemServices",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("raw.TypeName","Service Type"),new e.ListColumnSetting("raw.ManifestVersion","Version"),new e.ListColumnSettingWithFilter("raw.ServiceKind","Service Kind"),new e.ListColumnSettingForBadge("healthState","Health State"),new e.ListColumnSettingWithFilter("raw.ServiceStatus","Status")]),r.$scope.healthEventsListSettings=r.settings.getNewOrExistingHealthEventsListSettings(),r.$scope.unhealthyEvaluationsListSettings=r.settings.getNewOrExistingUnhealthyEvaluationsListSettings(),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getSystemApp(!0,e).then(function(e){t.$scope.systemApp=e})},n.prototype.refreshEssentials=function(e){return this.$scope.systemApp.services.refresh(e)},n}(e.MainViewController);e.SystemAppsViewController=t,function(){angular.module("systemAppsViewController",["dataService","filters"]).controller("SystemAppsViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t,n,i){var r=this;this.$scope=t,this.$timeout=n,this.settings=i,this.$scope.fileListSettings=this.settings.getNewOrExistingListSettings("imagestore",["name"],[new e.ListColumnSetting("","",null,!0,function(e,t){return r.$scope.imagestoreroot.data.actionsEnabled()?'<sfx-image-store-file-view item="item"></sfx-image-store-file-view>':""}),new e.ListColumnSetting("displayName","name",["isFolder","displayName"],!1,function(e,t){return e.fileCount?'<div class="image-store-item-name" style="display: inline-block; cursor: pointer; white-space: nowrap;">\n                        <a href="" role="button" class="list-item-name" style="display: table-cell;">\n                            <span class="bowtie-icon bowtie-folder"></span>\n                            <span title="'+e.path+'">'+e.displayName+"</span>\n                        </a>":'<div class="image-store-item-name" style="display: inline-block; cursor: initial; white-space: nowrap;">\n                            <span class="bowtie-icon bowtie-file"></span>\n                            <span title="'+e.path+'">'+e.displayName+"</span>"},1,function(e){-1===e.isFolder&&r.openFolder(e.path)}),new e.ListColumnSetting("displayedSize","Size",["isFolder","size","displayName"],!1,function(t,n){if(1===t.isFolder)return'<span style="cursor: initial"> '+t.displayedSize+" </span>";var i=r.$scope.imagestoreroot.getCachedFolderSize(t.path),a=i.size>-1?e.Utils.getFriendlyFileSize(i.size):"",o=i.loading?"rotate":"";return"<span style='white-space: nowrap;'>"+(i.date?'<span  class="dark-background-link bowtie-icon bowtie-status-waiting-fill" aria-label="timestamp" title="Last checked '+i.date.toLocaleString()+'"></span>':"")+'<span style="cursor: initial; padding-right: 3px;"> '+a+" </span>"+(0!==a.length||o?'<a href class="bowtie-icon bowtie-navigate-refresh dark-background-link '+o+'" title="Reload folder size"></a>':'<button type="button" style="background-color: #262626;border: 1px solid #0075c9;"\n                                                                                class="checkbox-push">\n                                                                                Load Size\n                                                                            </button>')+"</span>"},1,function(t){if(-1===t.isFolder){var n=r.$scope.imagestoreroot.getCachedFolderSize(t.path);if(n.loading)return;r.$scope.imagestoreroot.cachedCurrentDirectoryFolderSizes[t.path].loading=!0,n.loading=!0,r.$scope.imagestoreroot.getFolderSize(t.path).then(function(n){r.$scope.imagestoreroot.cachedCurrentDirectoryFolderSizes[t.path]={size:+n.FolderSize,loading:!1,date:new Date},t.size=+n.FolderSize,t.displayedSize=e.Utils.getFriendlyFileSize(+n.FolderSize),r.$scope.imagestoreroot.currentFolder.childrenFolders.find(function(e){return e.path===t.path}).size=+n.FolderSize,r.$scope.imagestoreroot.allChildren=[].concat(r.$scope.imagestoreroot.allChildren)}).catch(function(){r.$scope.imagestoreroot.cachedCurrentDirectoryFolderSizes[t.path].loading=!1})}}),new e.ListColumnSetting("modifiedDate","Date modified"),new e.ListColumnSetting("fileCount","Count of Files",["isFolder","fileCount"])])}return t.prototype.openFolder=function(e){this.$scope.imagestoreroot.expandFolder(e)},t.$inject=["$scope","$timeout","settings"],t}();e.ImageStoreViewController=t;var n=function(){function e(e,t){this.$scope=e,this.data=t}return e.prototype.deleteSelected=function(e){this.$scope.showDeleteConfirmation=!0,this.$scope.confirmationKeyword=e},e.prototype.deleteCanceled=function(){this.$scope.showDeleteConfirmation=!1,this.$scope.imageStoreTreeSearchTerm="",this.$scope.usertypedkeyword=""},e.prototype.deleteConfirmed=function(){this.data.imageStore.deleteContent(this.$scope.confirmationKeyword),this.$scope.usertypedkeyword="",this.$scope.showDeleteConfirmation=!1},e.$inject=["$scope","data"],e}();e.ImageStoreFileViewController=n}(Sfx||(Sfx={}));var Sfx;!function(e){function t(){angular.element(document).ready(function(){angular.bootstrap(document,[e.Constants.sfxAppName],{strictDi:!0})})}!function(){if(e.StandaloneIntegration.isStandalone())return angular.module("authenticationBootstrap",["AdalAngular"]).constant("authenticationData",new e.AadMetadata(null)),t();var n=/[&?#](error=.*)/i.exec(window.location.href);if(n&&n[1])return void(window.top.location.href="/Explorer/error.html?"+n[1]);var i=angular.injector(["ng"]);i.get("$http").get(e.StandaloneIntegration.clusterUrl+e.AuthenticationBootstrapConstants.GetAadMetadataUriPart).then(function(t){if(t.status>=300)return i.get("$q").reject();var n=t.data,r=angular.module("authenticationBootstrap",["AdalAngular"]);r.constant("authenticationData",new e.AadMetadata(n)),r.config(["$httpProvider","adalAuthenticationServiceProvider","authenticationData",function(t,n,i){if(i.metadata&&i.isAadAuthType&&""!==i.metadata.tenant){var r=i.metadata,a={clientId:r.cluster,tenant:r.tenant,cacheLocation:e.AuthenticationBootstrapConstants.AdalCacheType};if(""!==e.StandaloneIntegration.clusterUrl&&(a.redirectUri=e.StandaloneIntegration.clusterUrl+"/Explorer/index.html",a.postLogoutRedirectUri=e.StandaloneIntegration.clusterUrl+"/Explorer/index.html"),r.login)a.instance=e.StringUtils.EnsureEndsWith(r.login,"/");else if(r.authority){var o=document.createElement("a");o.href=r.authority,a.instance=o.protocol+"//"+o.host+"/"}n.init(a,t)}}])}).catch(function(){angular.module("authenticationBootstrap",["AdalAngular"]).constant("authenticationData",new e.AadMetadata(null))}).finally(function(){return t()})}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e,t){this.data=e,this.$scope=t,this.clusterUpgradeProgress=this.data.clusterUpgradeProgress}return e.prototype.getUpgradeDomainProgress=function(){return"("+this.clusterUpgradeProgress.getCompletedUpgradeDomains()+" / "+this.clusterUpgradeProgress.upgradeDomains.length+" UDs completed)"},e.$inject=["$scope","dataService"],e}();e.HeaderAlertController=t,function(){angular.module("headerAlertController",[]).controller("HeaderAlertController",["data","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n,i){var r=t.call(this,n,{essentials:{name:"Essentials"}})||this;return r.$scope=i,r.tabs.essentials.refresh=function(e){return r.refreshEssentials(e)},r.networkName=e.IdUtils.getNetworkName(r.routeParams),r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.networkGroup(),e.IdGenerator.network(r.networkName)]),r.$scope.appListSettings=r.settings.getNewOrExistingListSettings("apps",["appDetail.raw.Name"],[new e.ListColumnSettingForLink("appDetail.raw.Name","Application Name",function(e){return e.viewPath}),new e.ListColumnSetting("appDetail.raw.TypeName","Application Type"),new e.ListColumnSettingForBadge("appDetail.healthState","Health State"),new e.ListColumnSetting("appDetail.raw.Status","Status")]),r.$scope.apps=new e.AppOnNetworkCollection(r.data,r.networkName),r.$scope.nodeListSettings=r.settings.getNewOrExistingListSettings("nodes",["nodeDetails.name"],[new e.ListColumnSettingForLink("nodeDetails.name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("nodeDetails.raw.IpAddressOrFQDN","Address"),new e.ListColumnSettingWithFilter("nodeDetails.raw.Type","Node Type"),new e.ListColumnSettingWithFilter("nodeDetails.raw.UpgradeDomain","Upgrade Domain"),new e.ListColumnSettingWithFilter("nodeDetails.raw.FaultDomain","Fault Domain"),new e.ListColumnSettingWithFilter("nodeDetails.raw.IsSeedNode","Is Seed Node"),new e.ListColumnSettingForBadge("nodeDetails.healthState","Health State"),new e.ListColumnSettingWithFilter("nodeDetails.nodeStatus","Status")]),r.$scope.nodes=new e.NodeOnNetworkCollection(r.data,r.networkName),r.$scope.containerListSettings=r.settings.getNewOrExistingListSettings("containers",["nodeName","raw.CodePackageName"],[new e.ListColumnSettingForLink("raw.CodePackageName","Code Package Name",function(e){return e.viewPath}),new e.ListColumnSetting("nodeName","Node Name"),new e.ListColumnSetting("raw.NetworkName","Network"),new e.ListColumnSetting("raw.ApplicationName","Application"),new e.ListColumnSetting("raw.CodePackageVersion","Version"),new e.ListColumnSetting("raw.ServiceManifestName","Service"),new e.ListColumnSetting("raw.ServicePackageActivationId","Activation Id"),new e.ListColumnSetting("raw.ContainerAddress","Container addresses"),new e.ListColumnSetting("raw.ContainerId","Container Id")]),r.$scope.containers=new e.DeployedContainerOnNetworkCollection(r.data,r.networkName),r.refresh(),r}return __extends(n,t),n.prototype.refreshCommon=function(e){var t=this;return this.data.getNetwork(this.networkName,!0,e).then(function(e){t.$scope.network=e})},n.prototype.refreshEssentials=function(e){return this.$q.all([this.$scope.apps.refresh(e),this.$scope.nodes.refresh(e),this.$scope.containers.refresh(e)])},n}(e.MainViewController);e.NetworkViewController=t,function(){angular.module("networkViewController",["ngRoute","dataService"]).controller("NetworkViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function i(n,i){var r=t.call(this,n)||this;return r.$scope=i,r.selectTreeNode([e.IdGenerator.cluster(),e.IdGenerator.networkGroup()]),r.$scope.listSettings=r.settings.getNewOrExistingListSettings("networks",["name"],[new e.ListColumnSettingForLink("name","Name",function(e){return e.viewPath}),new e.ListColumnSetting("type","Type"),new e.ListColumnSetting("addressPrefix","NetworkAddressPrefix"),new e.ListColumnSetting("status","NetworkStatus")]),r.$scope.actions=new e.ActionCollection(r.data.telemetry,r.$q),r.data.actionsEnabled&&r.addActions(r.$scope.actions),r.refresh(),r}return __extends(i,t),i.prototype.refreshCommon=function(e){var t=this;return this.data.getNetworks(!0,e).then(function(e){t.$scope.networks=e})},i.prototype.addActions=function(e){e.add(new n(this.data))},i}(e.MainViewController);e.NetworksViewController=t;var n=function(t){function n(n){var i=t.call(this,n.$uibModal,n.$q,"createIsolatednetwork","Create Isolated Network","Creating",function(){return n.restClient.createNetwork(i.networkName,i.networkAddressPrefix)},function(){return!0},{templateUrl:"partials/create-network-dialog.html",controller:e.ActionController,resolve:{action:function(){return i}}},null)||this;return i.reset(),i}return __extends(n,t),n.prototype.reset=function(){this.networkName="",this.networkAddressPrefix=""},n}(e.ActionWithDialog);e.ActionCreateIsolatedNetwork=n,function(){angular.module("networksViewController",[]).controller("NetworksViewController",["$injector","$scope",t])}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.controller=n,this.controllerAs="ctrl",this.templateUrl="partials/date-picker.html",this.scope={ngModel:"=",minDate:"=?",maxDate:"=?",initDate:"=?",readOnly:"=?",placeHolderText:"=?"}}return e.prototype.link=function(e,t,n){e.initDate=e.initDate||new Date,e.readOnly=e.readOnly||!0,e.placeHolderText=e.placeHolderText||"",e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0]},e}();e.DatePickerDirective=t;var n=function(){function e(e){this.$scope=e}return e.prototype.popupClick=function(e){e.stopPropagation(),this.$scope.opened=!this.$scope.opened},e.prototype.popupFocus=function(e){this.$scope.opened||(this.$scope.opened=!0)},e.$inject=["$scope"],e}();e.DatePickerController=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.controller=n,this.controllerAs="ctrl",this.templateUrl="partials/date-time-picker.html",this.scope={ngModel:"=",minDate:"=?",maxDate:"=?",initDate:"=?",readOnly:"=?",placeHolderText:"=?"}}return e.prototype.link=function(e,t,n){e.initDate=e.initDate||new Date,e.readOnly=e.readOnly||!0,e.placeHolderText=e.placeHolderText||"",e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0]},e}();e.DateTimePickerDirective=t;var n=function(){function e(e){this.$scope=e}return e.prototype.popupClick=function(e){e.stopPropagation(),this.$scope.opened=!this.$scope.opened},e.prototype.popupFocus=function(e){this.$scope.opened||(this.$scope.opened=!0)},e.$inject=["$scope"],e}();e.DateTimePickerController=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.templateUrl="partials/detail-list-details-view.html",this.scope={detailsListSettings:"="},this.require="^sfxDetailList"}return e.prototype.link=function(e,t,n,i){i.$scope.showDetails=function(t){var n=i.$scope.list;if(n&&n.getDetailsList){var r=n.collection||n,a=r.filter(function(e){return e.uniqueId===t||e.id===t});1===a.length&&(e.itemName=a[0].name||null,e.detailsList=n.getDetailsList(a[0]),e.detailsList.refresh())}},e.reset=function(){e.itemName=null,e.detailsList=null},e.goBack=function(){e.reset()}},e}();e.DetailListDetailsViewDirective=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){this.restrict="E",this.replace=!0,this.templateUrl="partials/double-slider-directive.html",this.scope={startDate:"=",endDate:"="}}return t.prototype.link=function(t,n,i){var r=function(){_.defer(function(){t.$apply()})};t.$watchGroup(["startDate","endDate"],function(){t.startDate&&t.endDate&&(t.slider||(t.slider=noUiSlider.create(n[0],{format:{to:function(e){return new Date(e).toLocaleString("en-us")},from:Number},tooltips:!0,connect:!0,range:{min:e.TimeUtils.AddDays(new Date,-30).getTime(),max:(new Date).getTime()},step:6e4,start:[new Date(t.startDate).getTime(),new Date(t.endDate).getTime()]}),t.slider.on("set",function(e){var n=new Date(e[1]),i=new Date(e[0]);t.endDate.toUTCString()!==n.toUTCString()&&(t.endDate=n,r()),t.startDate.toUTCString()!==i.toUTCString()&&(t.startDate=i,r())})),t.slider.set([new Date(t.startDate).getTime(),new Date(t.endDate).getTime()]))})},t}();e.DoubleSliderDirective=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.templateUrl="partials/events-view.html",this.scope={eventsList:"=",timelineGenerator:"=?"}}return e.prototype.link=function(e,t,i){e.dwSelector=new n(e.eventsList,e.timelineGenerator),e.resetClick=function(){e.dwSelector.reset()}},e}();e.EventsViewDirective=t;var n=function(){function t(e,t){this.isResetEnabled=!1,this.transformText="Category,Kind",this._startDate=null,this._endDate=null,this._showAllEvents=!1,this.eventsList=e,t?this._timelineGenerator=t:this._showAllEvents=!0,this.resetSelectionProperties(),this.setTimelineData()}return Object.defineProperty(t.prototype,"startDate",{get:function(){return this._startDate},set:function(n){this._startDate=n,this.isEndSelected||(this.endDateMin=this._startDate,this.endDateMax=e.TimeUtils.AddDays(this._startDate,t.MaxWindowInDays),this.endDateMax>new Date&&(this.endDateMax=new Date),this.endDateInit=this._startDate,this.isStartSelected=!0),this.setNewDateWindow()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endDate",{get:function(){return this._endDate},set:function(n){this._endDate=n,this.isStartSelected||(this.startDateMax=this._endDate,this.startDateMin=e.TimeUtils.AddDays(this._endDate,-7*t.MaxWindowInDays),this.startDateInit=this._endDate,this.isEndSelected=!0),this.setNewDateWindow()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showAllEvents",{get:function(){return this._showAllEvents},set:function(e){this._showAllEvents=e,this.setTimelineData()},enumerable:!0,configurable:!0}),t.prototype.reset=function(){var e=this;this.isResetEnabled=!1,this.eventsList.resetDateWindow()?(this.resetSelectionProperties(),this.eventsList.reload().then(function(t){e.setTimelineData()})):this.resetSelectionProperties()},t.prototype.resetSelectionProperties=function(){this._startDate=this.eventsList.startDate,this._endDate=this.eventsList.endDate,this.startDateMin=this.endDateMin=e.TimeUtils.AddDays(new Date,-30),this.startDateMax=this.endDateMax=new Date,this.startDateInit=this.endDateInit=new Date,this.isStartSelected=this.isEndSelected=!1},t.prototype.setNewDateWindow=function(){var e=this;this.eventsList.setDateWindow(this._startDate,this._endDate)?(this.resetSelectionProperties(),this.isResetEnabled=!0,this.eventsList.reload().then(function(t){e.setTimelineData()})):this.resetSelectionProperties()},t.prototype.setTimelineData=function(){var t=this;this.eventsList.ensureInitialized().then(function(){try{if(t._showAllEvents){var n=e.parseEventsGenerically(t.eventsList.collection.map(function(e){return e.raw}),t.transformText);t.timeLineEventsData={groups:n.groups,items:n.items,start:t.startDate,end:t.endDate}}else if(t._timelineGenerator){var n=t._timelineGenerator.generateTimeLineData(t.eventsList.collection.map(function(e){return e.raw}),t.startDate,t.endDate);t.timeLineEventsData={groups:n.groups,items:n.items,start:t.startDate,end:t.endDate}}}catch(e){}})},t.MaxWindowInDays=7,t}()}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(){this.restrict="E",this.replace=!0,this.controller=e.ImageStoreViewController,this.controllerAs="imageStoreCtrl",this.templateUrl="partials/image-store-view.html",this.scope={imagestoreroot:"="}}return t.prototype.link=function(e,t,n,i){e.$watch("imagestoreroot",function(){e.content&&angular.isDefined(e.content.isRefreshing)})},t}();e.ImageStoreViewDirective=t;var n=function(){function t(){this.restrict="E",this.controller=e.ImageStoreFileViewController,this.controllerAs="imageStoreFileCtrl",this.templateUrl="partials/image-store-file-view.html",this.scope={item:"="}}return t}();e.ImageStoreOptionsViewDirective=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.templateUrl="partials/status-warnings.html",this.controller=n,this.controllerAs="ctrl",this.scope={dataService:"="}}return e.prototype.link=function(e,t,n){},e}();e.StatusWarningsDirective=t;var n=function(){function t(e,t){this.$scope=e,this.data=t,this.displayAll=!1,this.alerts=this.data.warnings}return t.prototype.toggleViewed=function(){this.displayAll=!this.displayAll},t.prototype.remove=function(e,t){void 0===t&&(t=!1),this.alerts.removeNotificationById(e.id,t)},t.prototype.removeWithConfirm=function(t){var n=this;new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"","Accept","acknowledge",function(){return n.data.$q.when(n.alerts.removeNotificationById(t.id,!0))},function(){return!0},"Acknowledge",t.confirmText,"Accept").runWithCallbacks(function(){return null},function(){})},t.$inject=["$scope","data"],t}();e.StatusWarningController=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.templateUrl="partials/text-file-input.html",this.scope={ngModel:"=ngModel"}}return e.prototype.link=function(e,t){e.loading=!1,e.required="required"===t.attr("required"),e.accept=t.attr("accept"),$(t).find("input:file").on("change",function(t){e.loading=!0;var n=new FileReader;n.onload=function(t){e.$apply(function(){e.ngModel=t.target.result,e.loading=!1})},n.readAsText(t.target.files[0])})},e}();e.TextFileInputDirective=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(){this.restrict="E",this.replace=!0,this.controller=n,this.controllerAs="ctrl",this.templateUrl="partials/timeline.html",this.scope={events:"="},this.transclude=!0}return e.prototype.link=function(e,t,n,i){e.$watchCollection("events",function(){e.events&&i.updateList(e.events)})},e}();e.TimeLineChartDirective=t;var n=function(){function e(e){this.$scope=e;var t=new vis.DataSet,n=new vis.DataSet,i=document.getElementById("visualization");this._timeline=new vis.Timeline(i,n,t)}return e.prototype.fitData=function(){this._timeline.fit()},e.prototype.fitWindow=function(){this._timeline.setWindow(this._start,this._end)},e.prototype.moveStart=function(){this._timeline.moveTo(this._start)},e.prototype.moveEnd=function(){this._timeline.moveTo(this._end)},e.prototype.moveToOldestEvent=function(){this._oldestEvent&&this._timeline.setWindow(this._oldestEvent.start,this._oldestEvent.end)},e.prototype.moveToNewestEvent=function(){this._mostRecentEvent&&this._timeline.setWindow(this._mostRecentEvent.start,this._mostRecentEvent.end)},e.prototype.updateList=function(e){if(e){if(this._timeline.setData({groups:e.groups,items:e.items}),this._timeline.setOptions({selectable:!1,min:e.start,max:e.end,margin:{item:{horizontal:-1}},stack:!0,stackSubgroups:!0,maxHeight:"700px",verticalScroll:!0,width:"95%",tooltip:{overflowMethod:"flip"}}),this._timeline.fit(),this._start=e.start,this._end=e.end,e.items.length>0){var t=null,n=null;e.items.forEach(function(e){t||n||(t=e,n=e),t.start>e.start&&(t=e),n.end<e.end&&(n=e)}),this._mostRecentEvent=n,this._oldestEvent=t}}else this._mostRecentEvent=null,this._oldestEvent=null},e.$inject=["$scope"],e}();e.TimeLineChartController=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),n.prototype.retrieveNewData=function(t){var n=this;return this.data.restClient.getApplication(e.IdUtils.nameToId(this.raw.ApplicationName),t).then(function(t){return n.appDetail=new e.Application(n.data,t.data),n.appDetail.refresh().then(function(){return n.appDetail})})},Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getAppViewPath(this.appDetail.raw.TypeName,this.appDetail.raw.Id)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.AppOnNetwork=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n,i){var r=t.call(this,e,i)||this;return r.nodeName=n,r}return __extends(n,t),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getCodePackageViewPath(this.nodeName,e.IdUtils.nameToId(this.raw.ApplicationName),this.raw.ServiceManifestName,this.raw.ServicePackageActivationId,this.raw.CodePackageName)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.DeployedContainerOnNetwork=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(n){var r=t.call(this,n)||this;r.data=n,r.isAvailable=!0,r.isNative=!0,r.root=new i,r.cachedCurrentDirectoryFolderSizes={},r.pathBreadcrumbItems=[],r.isLoadingFolderContent=!1,r.initialized=!1,r.root.path="",r.root.displayName="Image Store",r.currentFolder=r.root,r.pathBreadcrumbItems=[{path:r.root.path,name:r.root.displayName}];var a=new e.ClusterManifest(n);return a.refresh().then(function(){r.connectionString=a.imageStoreConnectionString,r.isNative="fabric:imagestore"===r.connectionString.toLowerCase(),r.isNative&&r.expandFolder(r.currentFolder.path).then(function(){r.isAvailable=!0}).catch(function(e){r.isAvailable=!1}).finally(function(){r.initialized=!0})}),r}return __extends(n,t),n.slashDirection=function(e){return e.indexOf("\\")>-1},n.chopPath=function(e){return n.slashDirection(e)?e.split("\\"):e.split("/")},n.prototype.retrieveNewData=function(e){return this.isNative&&!this.isLoadingFolderContent&&this.initialized?this.expandFolder(this.currentFolder.path):this.data.$q.resolve(null)},n.prototype.updateInternal=function(){return this.data.$q.when(!0)},n.prototype.expandFolder=function(t,n){var i=this;if(void 0===n&&(n=!1),!this.isLoadingFolderContent)return this.isLoadingFolderContent=!0,this.loadFolderContent(t).then(function(e){i.setCurrentFolder(t,e,n);var r=_.findIndex(i.pathBreadcrumbItems,function(e){return e.path===i.currentFolder.path});return r>-1?i.pathBreadcrumbItems=i.pathBreadcrumbItems.slice(0,r+1):i.pathBreadcrumbItems.push({path:i.currentFolder.path,name:i.currentFolder.displayName}),i.isLoadingFolderContent=!1,e}).catch(function(n){return i.isLoadingFolderContent=!1,400===n.status?n:404===n.status?(i.data.message.showMessage("Directory "+t+" does not appear to exist anymore. Navigating back to the base of the image store directory.",e.MessageSeverity.Warn),i.expandFolder(i.root.path)):void 0})},n.prototype.deleteContent=function(t){var n=this;if(!t)return this.data.$q.resolve();var i=_.find(this.currentFolder.childrenFolders,function(e){return e.path===t});return i||(i=_.find(this.currentFolder.childrenFiles,function(e){return e.path===t})),!i||i.isReserved?this.data.$q.resolve():e.Utils.getHttpResponseData(this.data.restClient.deleteImageStoreContent(t)).then(function(){return n.refresh()})},n.prototype.getCachedFolderSize=function(e){var t=this.cachedCurrentDirectoryFolderSizes[e];return t||(t={size:-1,loading:!1},this.cachedCurrentDirectoryFolderSizes[e]=t),t},n.prototype.getFolderSize=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getImageStoreFolderSize(t)).then(function(e){return e})},n.prototype.setCurrentFolder=function(e,t,a){var o=this;a&&(this.cachedCurrentDirectoryFolderSizes={});var s=new i;s.path=e;var c=n.chopPath(e);s.displayName=_.last(c),s.childrenFolders=_.map(t.StoreFolders,function(e){var t=new i(e);return t.path in o.cachedCurrentDirectoryFolderSizes&&(t.size=o.cachedCurrentDirectoryFolderSizes[t.path].size),t}),s.childrenFiles=_.map(t.StoreFiles,function(e){return new r(e)}),s.allChildren=[].concat(s.childrenFiles).concat(s.childrenFolders),s.fileCount=s.childrenFiles.length,this.currentFolder=s},n.prototype.loadFolderContent=function(t,n){var i=this;return void 0===n&&(n=!1),this.data.$q(function(r,a){e.Utils.getHttpResponseData(i.data.restClient.getImageStoreContent(t)).then(function(e){n&&i.setCurrentFolder(t,e,!1),r(e)}).catch(function(e){404===e.status&&t===i.root.path?r({StoreFiles:[],StoreFolders:[]}):a(e)})})},n.reservedFileName="_.dir",n}(e.DataModelBase);e.ImageStore=t;var n=function(){function e(e){this.uniqueId=e,this.path=e;var n=t.chopPath(e);this.displayName=_.last(n),this.isReserved="Store"===n[0]||"WindowsFabricStore"===n[0]||this.displayName===t.reservedFileName}return e}();e.ImageStoreItem=n;var i=function(e){function t(t){var n=e.call(this,t?t.StoreRelativePath:"")||this;return n.isFolder=-1,n.size=-1,n.isExpanded=!1,t?(n.path=t.StoreRelativePath,n.fileCount=+t.FileCount,n):n}return __extends(t,e),t}(n);e.ImageStoreFolder=i;var r=function(t){function n(n){var i=t.call(this,n?n.StoreRelativePath:"")||this;return i.isFolder=1,i.size=0,n?(i.path=n.StoreRelativePath,i.size=Number(n.FileSize),i.displayedSize=e.Utils.getFriendlyFileSize(i.size),i.version=n.FileVersion?n.FileVersion.VersionNumber:"",i.modifiedDate=n.ModifiedDate,i):i}return __extends(n,t),n}(n);e.ImageStoreFile=r}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.data.actionsEnabled()&&i.setUpActions(),i}return __extends(n,t),Object.defineProperty(n.prototype,"name",{get:function(){return this.raw.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this.raw.properties.kind},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"addressPrefix",{get:function(){return this.raw.properties.networkAddressPrefix},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this.raw.properties.networkStatus},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getNetworkViewPath(this.name)},enumerable:!0,configurable:!0}),n.prototype.retrieveNewData=function(e){return this.data.restClient.getNetwork(this.name,e).then(function(e){return e.data})},n.prototype.setUpActions=function(){var t=this;this.actions.add(new e.ActionWithConfirmationDialog(this.data.$uibModal,this.data.$q,"deleteNetwork","Delete","Deleting",function(){return t.delete()},function(){return"Ready"===t.raw.properties.networkStatus},"Confirm Network Deletion","Delete network '"+this.name+"' from cluster? ",this.name))},n.prototype.delete=function(){return this.data.restClient.deleteNetwork(this.name)},n}(e.DataModelBase);e.Network=t;var n=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t}(e.DataModelBase);e.NetworkProperties=n}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),n.prototype.retrieveNewData=function(t){var n=this;return this.data.restClient.getNetwork(this.raw.networkName,t).then(function(t){n.networkDetail=new e.Network(n.data,t.data)})},Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getNetworkViewPath(this.raw.networkName)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.NetworkOnApp=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n){return t.call(this,e,n)||this}return __extends(n,t),n.prototype.retrieveNewData=function(t){var n=this;return this.data.restClient.getNetwork(this.raw.NetworkName,t).then(function(t){n.networkDetail=new e.Network(n.data,t.data)})},Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getNetworkViewPath(this.raw.NetworkName)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.NetworkOnNode=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(t){function n(e,n){return t.call(this,e,n)||this}
return __extends(n,t),n.prototype.retrieveNewData=function(t){var n=this;return this.data.restClient.getNode(this.raw.nodeName,t).then(function(t){n.nodeDetails=new e.Node(n.data,t.data)})},Object.defineProperty(n.prototype,"viewPath",{get:function(){return this.data.routes.getNodeViewPath(this.raw.nodeName)},enumerable:!0,configurable:!0}),n}(e.DataModelBase);e.NodeOnNetwork=t}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function t(t,a){this.parent=a,this.partitionBackupConfigurationInfo=new n(t,this),this.partitionBackupProgress=new i(t,this),this.partitionRestoreProgress=new r(t,this),this.partitionBackupList=new e.PartitionBackupCollection(t,this),this.latestPartitionBackup=new e.SinglePartitionBackupCollection(t,this),this.cleanBackup=!1}return t}();e.PartitionBackupInfo=t;var n=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i.decorators={hideList:["ServiceName","PartitionId"]},i}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getPartitionBackupConfigurationInfo(this.parent.parent.id,t))},n}(e.DataModelBase);e.PartitionBackupConfigurationInfo=n;var i=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getPartitionBackupProgress(this.parent.parent.id,t))},n}(e.DataModelBase);e.PartitionBackupProgress=i;var r=function(t){function n(e,n){var i=t.call(this,e,null,n)||this;return i.parent=n,i}return __extends(n,t),n.prototype.retrieveNewData=function(t){return e.Utils.getHttpResponseData(this.data.restClient.getPartitionRestoreProgress(this.parent.parent.id,t))},n}(e.DataModelBase);e.PartitionRestoreProgress=r;var a=function(t){function n(n,i,r){var a=t.call(this,n,i,r)||this;return a.parent=r,a.decorators={hideList:["ApplicationName","ServiceName","PartitionInformation"]},a.action=i?new e.ActionWithDialog(n.$uibModal,n.$q,i.BackupId,i.BackupId,"Creating",null,function(){return!0},{templateUrl:"partials/partitionBackup.html",controller:e.ActionController,resolve:{action:function(){return a}}},null):null,a}return __extends(n,t),n}(e.DataModelBase);e.PartitionBackup=a}(Sfx||(Sfx={}));var Sfx;!function(e){var t=function(){function e(e){this.notifications=[],this.storage=e}return e.prototype.addNotification=function(e){this.notifications.push(e),this.notifications.sort(function(e,t){return e.priority>t.priority?-1:1})},e.prototype.getIndex=function(e){for(var t=-1,n=0;n<this.notifications.length;n++)this.notifications[n].id===e&&(t=n);return t},e.prototype.addOrUpdateNotification=function(e){if(this.storage.getValueBoolean(this.getStorageId(e.id),!0)){var t=this.getIndex(e.id);t>-1?this.notifications[t]=e:this.notifications.push(e),this.notifications.sort(function(e,t){return e.priority>t.priority?-1:1})}},e.prototype.removeNotificationById=function(e,t){void 0===t&&(t=!1);var n=this.getIndex(e);n>-1&&this.notifications.splice(n,1),t&&this.storage.setValue(this.getStorageId(e),!1)},e.prototype.getStorageId=function(e){return"sfx-statuswarning-"+e+"-noshow"},e}();e.StatusWarningService=t,function(){angular.module("StatusWarningService",["storageService"]).factory("warnings",["storage",function(e){return new t(e)}])}()}(Sfx||(Sfx={}));